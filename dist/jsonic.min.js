!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},t=e((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modlist=t.findTokenSet=t.log_lex=t.log_stack=t.log_parse=t.log_node=t.log_rule=t.values=t.keys=t.omap=t.str=t.prop=t.parserwrap=t.trimstk=t.tokenize=t.srcfmt=t.snip=t.regexp=t.mesc=t.makelog=t.isarr=t.filterRules=t.extract=t.escre=t.errinject=t.errdesc=t.entries=t.defprop=t.deep=t.configure=t.clone=t.clean=t.charset=t.badlex=t.assign=t.S=t.JsonicError=void 0;const l=n({}),i=e=>null==e?[]:Object.keys(e);t.keys=i;const s=e=>null==e?[]:Object.values(e);t.values=s;const o=e=>null==e?[]:Object.entries(e);t.entries=o;const a=(e,...t)=>Object.assign(null==e?{}:e,...t);t.assign=a,t.isarr=e=>Array.isArray(e);const u=Object.defineProperty;t.defprop=u;const c=(e,t)=>Object.entries(e||{}).reduce((e,n)=>{let r=t?t(n):n;void 0===r[0]?delete e[n[0]]:e[r[0]]=r[1];let l=2;for(;void 0!==r[l];)e[r[l]]=r[l+1],l+=2;return e},{});t.omap=c;const p={indent:". ",logindent:"  ",space:" ",gap:"  ",Object:"Object",Array:"Array",object:"object",string:"string",function:"function",unexpected:"unexpected",map:"map",list:"list",elem:"elem",pair:"pair",val:"val",node:"node",no_re_flags:r.EMPTY,unprintable:"unprintable",invalid_ascii:"invalid_ascii",invalid_unicode:"invalid_unicode",invalid_lex_state:"invalid_lex_state",unterminated_string:"unterminated_string",unterminated_comment:"unterminated_comment",lex:"lex",parse:"parse",error:"error",none:"none",imp_map:"imp,map",imp_list:"imp,list",imp_null:"imp,null",end:"end",open:"open",close:"close",rule:"rule",stack:"stack",nUll:"null",name:"name",make:"make",colon:":"};t.S=p;class d extends SyntaxError{constructor(e,t,n,r,l){let i=x(e,t=g({},t),n,r,l);super(i.message),a(this,i),v(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}function m(e,t,n){let l=t.t,i=l[e];return null==i&&r.STRING===typeof e&&(i=t.tI++,l[i]=e,l[e]=i,l[e.substring(1)]=i,null!=n&&a(n.token,t.t)),i}function h(e,...t){return new RegExp(t.map(e=>e.esc?f(e.toString()):e).join(r.EMPTY),null==e?"":e)}function f(e){return null==e?"":e.replace(/[-\\|\]{}()[^$+*?.!=]/g,"\\$&").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function g(e,...t){let n=p.function===typeof e,r=null!=e&&(p.object===typeof e||n);for(let l of t){let t,i=p.function===typeof l,s=null!=l&&(p.object===typeof l||i);if(r&&s&&!i&&Array.isArray(e)===Array.isArray(l))for(let n in l)e[n]=g(e[n],l[n]);else e=void 0===l?e:i?l:s?p.function===typeof(t=l.constructor)&&p.Object!==t.name&&p.Array!==t.name?l:g(Array.isArray(l)?[]:{},l):l,n=p.function===typeof e,r=null!=e&&(p.object===typeof e||n)}return e}function k(e,t,n,r,l,i){let s={code:t,details:n,token:r,rule:l,ctx:i};return null==e?"":e.replace(/\$([\w_]+)/g,(e,t)=>{let o=JSON.stringify(null!=s[t]?s[t]:null!=n[t]?n[t]:i.meta&&null!=i.meta[t]?i.meta[t]:null!=r[t]?r[t]:null!=l[t]?l[t]:null!=i.opts[t]?i.opts[t]:null!=i.cfg[t]?i.cfg[t]:null!=i[t]?i[t]:"$"+t);return null==o?"":o})}function v(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function b(e,t,n){let l=0<n.sI?n.sI:0,i=0<n.rI?n.rI:1,s=0<n.cI?n.cI:1,o=null==n.src?r.EMPTY:n.src,a=e.substring(Math.max(0,l-333),l).split("\n"),u=e.substring(l,l+333).split("\n"),c=2+(r.EMPTY+(i+2)).length,p=i<3?1:i-2,d=e=>"\x1b[34m"+(r.EMPTY+p++).padStart(c," ")+" | \x1b[0m"+(null==e?r.EMPTY:e),m=a.length;return[2<m?d(a[m-3]):null,1<m?d(a[m-2]):null,d(a[m-1]+u[0])," ".repeat(c)+"   "+" ".repeat(s-1)+"\x1b[31m"+"^".repeat(o.length||1)+" "+t+"\x1b[0m",d(u[1]),d(u[2])].filter(e=>null!=e).join("\n")}function x(e,t,n,r,l){var i,s,o;try{let a=l.cfg,u=l.meta,c=k(a.error[e]||(null===(i=null==t?void 0:t.use)||void 0===i?void 0:i.err)&&(t.use.err.code||t.use.err.message)||a.error.unknown,e,t,n,r,l);p.function===typeof a.hint&&(a.hint={...a.hint(),...a.hint});let d=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+c,"  \x1b[34m--\x3e\x1b[0m "+(u&&u.fileName||"<no-file>")+":"+n.rI+":"+n.cI,b(l.src(),c,n),"",k((a.hint[e]||(null===(o=null===(s=t.use)||void 0===s?void 0:s.err)||void 0===o?void 0:o.message)||a.hint.unknown||"").trim().split("\n").map(e=>"  "+e).join("\n"),e,t,n,r,l),"","  \x1b[2mhttps://jsonic.senecajs.org\x1b[0m","  \x1b[2m--internal: rule="+r.name+"~"+r.state+"; token="+m(n.tin,l.cfg)+(null==n.why?"":"~"+n.why)+"; plugins="+l.plgn().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),h={internal:{token:n,ctx:l}};return h={...Object.create(h),message:d,code:e,details:t,meta:u,fileName:u?u.fileName:void 0,lineNumber:n.rI,columnNumber:n.cI},h}catch(a){return console.log(a),{}}}function y(e){return"function"==typeof e.debug.print.src?e.debug.print.src:t=>{let n=null==t?r.EMPTY:Array.isArray(t)?JSON.stringify(t).replace(/]$/,o(t).filter(e=>isNaN(e[0])).map((e,t)=>(0===t?", ":"")+e[0]+": "+JSON.stringify(e[1]))+"]"):JSON.stringify(t);return n=n.substring(0,e.debug.maxlen)+(e.debug.maxlen<n.length?"...":r.EMPTY),n}}function j(e,t=44){let n;try{n="object"==typeof e?JSON.stringify(e):""+e}catch(r){n=""+e}return S(t<n.length?n.substring(0,t-3)+"...":n,t)}function S(e,t=5){return void 0===e?"":(""+e).substring(0,t).replace(/[\r\n\t]/g,".")}function E(...e){return null==e?{}:e.filter(e=>!1!==e).map(e=>"object"==typeof e?i(e).join(r.EMPTY):e).join(r.EMPTY).split(r.EMPTY).reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{})}function O(e){for(let t in e)null==e[t]&&delete e[t];return e}function I(e,t){return"["+(e.s||[]).map(e=>"number"==typeof e?m(e,t):Array.isArray(e)?"["+e.map(e=>m(e,t))+"]":"").join(" ")+"] "}function N(e,t,n){return e.F(e.src().substring(n.pnt.sI,n.pnt.sI+16)).padEnd(18," ")+" "+function(e){return"["+(e.NOTOKEN===e.t0?"":e.F(e.t0.src))+(e.NOTOKEN===e.t1?"":" "+e.F(e.t1.src))+"]~["+(e.NOTOKEN===e.t0?"":m(e.t0.tin,e.cfg))+(e.NOTOKEN===e.t1?"":" "+m(e.t1.tin,e.cfg))+"]"}(e).padEnd(34," ")+" "+(""+t.d).padStart(4," ")}function T(e,t){let n=o(t.n),r=o(t.use),l=o(t.keep);return(0===n.length?"":" N<"+n.filter(e=>e[1]).map(e=>e[0]+"="+e[1]).join(";")+">")+(0===r.length?"":" U<"+r.map(t=>t[0]+"="+e.F(t[1])).join(";")+">")+(0===l.length?"":" K<"+l.map(t=>t[0]+"="+e.F(t[1])).join(";")+">")}t.JsonicError=d,t.configure=function(e,t,n){var r,l,u,p,d,g,k,v,b,x,y,j,S,I,N,T,M,P,C,R,_,w,A,L,F,Y,U,$,J,K,D,B,V,z,G,Z,H,W,X,q,Q,ee;const te=t||{};te.t=te.t||{},te.tI=te.tI||1;const ne=e=>m(e,te);!1!==n.standard$&&(ne("#BD"),ne("#ZZ"),ne("#UK"),ne("#AA"),ne("#SP"),ne("#LN"),ne("#CM"),ne("#NR"),ne("#ST"),ne("#TX"),ne("#VL")),te.fixed={lex:!!(null===(r=n.fixed)||void 0===r?void 0:r.lex),token:n.fixed?c(O(n.fixed.token),([e,t])=>[t,m(e,te)]):{},ref:void 0},te.fixed.ref=c(te.fixed.token,([e,t])=>[e,t]),te.fixed.ref=Object.assign(te.fixed.ref,c(te.fixed.ref,([e,t])=>[t,e])),te.match={lex:!!(null===(l=n.match)||void 0===l?void 0:l.lex),value:n.match?c(O(n.match.value),([e,t])=>[e,t]):{},token:n.match?c(O(n.match.token),([e,t])=>[m(e,te),t]):{}},c(te.match.token,([e,t])=>[e,(t.tin$=+e,t)]);const re=n.tokenSet?Object.keys(n.tokenSet).reduce((e,t)=>(e[t]=n.tokenSet[t].filter(e=>null!=e).map(e=>ne(e)),e),{}):{};te.tokenSet=te.tokenSet||{},o(re).map(e=>{let t=e[0],n=e[1];te.tokenSet[t]?(te.tokenSet[t].length=0,te.tokenSet[t].push(...n)):te.tokenSet[t]=n}),te.tokenSetTins=o(te.tokenSet).reduce((e,t)=>(e[t[0]]=e[t[0]]||{},t[1].map(n=>e[t[0]][n]=!0),e),{}),te.tokenSetTins.IGNORE=te.tokenSetTins.IGNORE||{},te.space={lex:!!(null===(u=n.space)||void 0===u?void 0:u.lex),chars:E(null===(p=n.space)||void 0===p?void 0:p.chars)},te.line={lex:!!(null===(d=n.line)||void 0===d?void 0:d.lex),chars:E(null===(g=n.line)||void 0===g?void 0:g.chars),rowChars:E(null===(k=n.line)||void 0===k?void 0:k.rowChars),single:!!(null===(v=n.line)||void 0===v?void 0:v.single)},te.text={lex:!!(null===(b=n.text)||void 0===b?void 0:b.lex),modify:((null===(x=te.text)||void 0===x?void 0:x.modify)||[]).concat(([null===(y=n.text)||void 0===y?void 0:y.modify]||[]).flat()).filter(e=>null!=e)},te.number={lex:!!(null===(j=n.number)||void 0===j?void 0:j.lex),hex:!!(null===(S=n.number)||void 0===S?void 0:S.hex),oct:!!(null===(I=n.number)||void 0===I?void 0:I.oct),bin:!!(null===(N=n.number)||void 0===N?void 0:N.bin),sep:null!=(null===(T=n.number)||void 0===T?void 0:T.sep)&&""!==n.number.sep,exclude:null===(M=n.number)||void 0===M?void 0:M.exclude,sepChar:null===(P=n.number)||void 0===P?void 0:P.sep},te.value={lex:!!(null===(C=n.value)||void 0===C?void 0:C.lex),def:o((null===(R=n.value)||void 0===R?void 0:R.def)||{}).reduce((e,t)=>(null==t[1]||!1===t[1]||t[1].match||(e[t[0]]=t[1]),e),{}),defre:o((null===(_=n.value)||void 0===_?void 0:_.def)||{}).reduce((e,t)=>(t[1]&&t[1].match&&(e[t[0]]=t[1],e[t[0]].consume=!!e[t[0]].consume),e),{})},te.rule={start:null==(null===(w=n.rule)||void 0===w?void 0:w.start)?"val":n.rule.start,maxmul:null==(null===(A=n.rule)||void 0===A?void 0:A.maxmul)?3:n.rule.maxmul,finish:!!(null===(L=n.rule)||void 0===L?void 0:L.finish),include:(null===(F=n.rule)||void 0===F?void 0:F.include)?n.rule.include.split(/\s*,+\s*/).filter(e=>""!==e):[],exclude:(null===(Y=n.rule)||void 0===Y?void 0:Y.exclude)?n.rule.exclude.split(/\s*,+\s*/).filter(e=>""!==e):[]},te.map={extend:!!(null===(U=n.map)||void 0===U?void 0:U.extend),merge:null===($=n.map)||void 0===$?void 0:$.merge},te.list={property:!!(null===(J=n.list)||void 0===J?void 0:J.property)};let le=Object.keys(te.fixed.token).sort((e,t)=>t.length-e.length).map(e=>f(e)).join("|"),ie=(null===(K=n.comment)||void 0===K?void 0:K.lex)?(n.comment.def?s(n.comment.def):[]).filter(e=>e&&e.lex).map(e=>f(e.start)).join("|"):"",se=["([",f(i(E(te.space.lex&&te.space.chars,te.line.lex&&te.line.chars)).join("")),"]",("string"==typeof n.ender?n.ender.split(""):Array.isArray(n.ender)?n.ender:[]).map(e=>"|"+f(e)).join(""),""===le?"":"|",le,""===ie?"":"|",ie,"|$)"];return te.rePart={fixed:le,ender:se,commentStart:ie},te.re={ender:h(null,...se),rowChars:h(null,f(null===(D=n.line)||void 0===D?void 0:D.rowChars)),columns:h(null,"["+f(null===(B=n.line)||void 0===B?void 0:B.chars)+"]","(.*)$")},te.lex={empty:!!(null===(V=n.lex)||void 0===V?void 0:V.empty),emptyResult:null===(z=n.lex)||void 0===z?void 0:z.emptyResult,match:(null===(G=n.lex)||void 0===G?void 0:G.match)?o(n.lex.match).reduce((e,t)=>{let r=t[0],l=t[1];if(l){let t=l.make(te,n);t&&(t.matcher=r,t.make=l.make,t.order=l.order),e.push(t)}return e},[]).filter(e=>null!=e&&!1!==e&&-1<+e.order).sort((e,t)=>e.order-t.order):[]},te.debug={get_console:(null===(Z=n.debug)||void 0===Z?void 0:Z.get_console)||(()=>console),maxlen:null==(null===(H=n.debug)||void 0===H?void 0:H.maxlen)?99:n.debug.maxlen,print:{config:!!(null===(X=null===(W=n.debug)||void 0===W?void 0:W.print)||void 0===X?void 0:X.config),src:null===(Q=null===(q=n.debug)||void 0===q?void 0:q.print)||void 0===Q?void 0:Q.src}},te.error=n.error||{},te.hint=n.hint||{},(null===(ee=n.config)||void 0===ee?void 0:ee.modify)&&i(n.config.modify).forEach(e=>n.config.modify[e](te,n)),te.debug.print.config&&te.debug.get_console().dir(te,{depth:null}),te.result={fail:[]},n.result&&(te.result.fail=[...n.result.fail]),a(e.options,n),a(e.token,te.t),a(e.tokenSet,te.tokenSet),a(e.fixed,te.fixed.ref),te},t.tokenize=m,t.findTokenSet=function(e,t){return t.tokenSet[e]},t.mesc=function(e,t){return(t=new String(e)).esc=!0,t},t.regexp=h,t.escre=f,t.deep=g,t.errinject=k,t.trimstk=v,t.extract=b,t.errdesc=x,t.badlex=function(e,t,n){let r=e.next.bind(e);return e.next=(e,l,i,s)=>{let o=r(e,l,i,s);if(t===o.tin){let t={};throw null!=o.use&&(t.use=o.use),new d(o.why||p.unexpected,t,o,e,n)}return o},e},t.makelog=function(e,t){var n,r,l;let i=null===(l=null===(r=null===(n=e.opts)||void 0===n?void 0:n.plugin)||void 0===r?void 0:r.debug)||void 0===l?void 0:l.trace;if(t||i)if("number"==typeof(null==t?void 0:t.log)||i){let n=!1,r=null==t?void 0:t.log;(-1===r||i)&&(r=1,n=!0),e.log=(...t)=>{if(n){let n=t.filter(e=>p.object!=typeof e).map(e=>p.function==typeof e?e.name:e).join(p.gap);e.cfg.debug.get_console().log(n)}else e.cfg.debug.get_console().dir(t,{depth:r})}}else"function"==typeof t.log&&(e.log=t.log);return e.log},t.srcfmt=y,t.str=j,t.snip=S,t.clone=function(e){return g(Object.create(Object.getPrototypeOf(e)),e)},t.charset=E,t.clean=O,t.filterRules=function(e,t){let n=["open","close"];for(let r of n)e.def[r]=e.def[r].map(e=>(e.g="string"==typeof e.g?(e.g||"").split(/\s*,+\s*/):e.g||[],e)).filter(e=>t.rule.include.reduce((t,n)=>t||null!=e.g&&-1!==e.g.indexOf(n),0===t.rule.include.length)).filter(e=>t.rule.exclude.reduce((t,n)=>t&&(null==e.g||-1===e.g.indexOf(n)),!0));return e},t.prop=function(e,t,n){let r=e;try{let r,l=t.split(".");for(let t=0;t<l.length;t++)r=l[t],t<l.length-1&&(e=e[r]=e[r]||{});return void 0!==n&&(e[r]=n),e[r]}catch(l){throw new Error("Cannot "+(void 0===n?"get":"set")+" path "+t+" on object: "+j(r)+(void 0===n?"":" to value: "+j(n,22)))}},t.modlist=function(e,t){if(t&&e&&0<e.length){if(t.delete&&0<t.delete.length)for(let r=0;r<t.delete.length;r++){let n=t.delete[r];(n<0?-1*n<=e.length:n<e.length)&&(e[(e.length+n)%e.length]=null)}if(t.move)for(let r=0;r<t.move.length;r+=2){let n=(e.length+t.move[r])%e.length,l=(e.length+t.move[r+1])%e.length,i=e[n];e.splice(n,1),e.splice(l,0,i)}let n=e.filter(e=>null!=e);n.length!==e.length&&(e.length=0,e.push(...n))}return e},t.parserwrap=function(e){return{start:function(t,n,i,s){try{return e.start(t,n,i,s)}catch(o){if("SyntaxError"===o.name){let e=0,s=0,a=0,u=r.EMPTY,c=o.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(c){u=c[1],e=parseInt(c[2]),s=t.substring(0,e).replace(/[^\n]/g,r.EMPTY).length;let n=e-1;for(;-1<n&&"\n"!==t.charAt(n);)n--;a=Math.max(t.substring(n,e).length,0)}let p=o.token||(0,l.makeToken)("#UK",m("#UK",n.internal().config),void 0,u,(0,l.makePoint)(u.length,e,o.lineNumber||s,o.columnNumber||a));throw new d(o.code||"json",o.details||{msg:o.message},p,{},o.ctx||{uI:-1,opts:n.options,cfg:n.internal().config,token:p,meta:i,src:()=>t,root:()=>{},plgn:()=>n.internal().plugins,rule:{name:"no-rule"},sub:{},xs:-1,v2:p,v1:p,t0:p,t1:p,tC:-1,kI:-1,rs:[],rsI:0,rsm:{},n:{},log:i?i.log:void 0,F:y(n.internal().config),use:{},NORULE:{name:"no-rule"},NOTOKEN:{name:"no-token"}})}throw o}}}};const M={RuleState:{o:p.open.toUpperCase(),c:p.close.toUpperCase()}};t.log_rule=function(e,t,n){e.log(t,e,n,p.logindent+p.rule+p.space,N(e,t,n),p.indent.repeat(t.d)+(t.name+"~"+t.i+p.colon+M.RuleState[t.state]).padEnd(16),("prev="+t.prev.i+" parent="+t.parent.i+" child="+t.child.i).padEnd(28),T(e,t))},t.log_node=function(e,t,n,r){e.log(t,e,n,r,p.logindent+p.node+p.space,N(e,t,n),p.indent.repeat(t.d)+("why="+r.why+p.space+"<"+e.F(t.node)+">").padEnd(46),T(e,t))},t.log_parse=function(e,t,n,l,i,s,a,u){let c=l&&u.n?o(u.n):null,d=l&&u.u?o(u.u):null,m=l&&u.k?o(u.k):null;e.log&&e.log(e,t,n,p.logindent+p.parse,N(e,t,n),p.indent.repeat(t.d)+(l?"alt="+s:"no-alt"),l&&a?I(a,e.cfg):"",l&&u.g?"g:"+u.g+" ":"",(l&&u.p?"p:"+u.p+" ":"")+(l&&u.r?"r:"+u.r+" ":"")+(l&&u.b?"b:"+u.b+" ":""),a&&a.c?"c:"+i:r.EMPTY,null==c?"":"n:"+c.map(e=>e[0]+"="+e[1]).join(";"),null==d?"":"u:"+d.map(e=>e[0]+"="+e[1]).join(";"),null==m?"":"k:"+m.map(e=>e[0]+"="+e[1]).join(";"))},t.log_stack=function(e,t,n){e.log(p.logindent+p.stack,N(e,t,n),p.indent.repeat(t.d)+"/"+e.rs.slice(0,t.d).map(e=>e.name+"~"+e.i).join("/"),"~","/"+e.rs.slice(0,t.d).map(t=>e.F(t.node)).join("/"),e,t,n)},t.log_lex=function(e,t,n,r,l,i,s,o,a,u){e.log(p.logindent+p.lex+p.space+p.space,N(e,t,n),p.indent.repeat(t.d)+m(s.tin,e.cfg),e.F(s.src),r.sI,r.rI+":"+r.cI,(null==i?void 0:i.name)||"",o?"on:alt="+a+";"+o.g+";t="+u+";"+I(o,e.cfg):"",e.F(n.src.substring(l,l+16)),e,t,n)}})),n=e((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeTextMatcher=n.makeNumberMatcher=n.makeCommentMatcher=n.makeStringMatcher=n.makeLineMatcher=n.makeSpaceMatcher=n.makeFixedMatcher=n.makeMatchMatcher=n.makeToken=n.makePoint=n.makeLex=n.makeNoToken=void 0;const l=t({});class i{constructor(e,t,n,r){this.len=-1,this.sI=0,this.rI=1,this.cI=1,this.token=[],this.len=e,null!=t&&(this.sI=t),null!=n&&(this.rI=n),null!=r&&(this.cI=r)}toString(){return"Point["+[this.sI+"/"+this.len,this.rI,this.cI]+(0<this.token.length?" "+this.token:"")+"]"}[r.INSPECT](){return this.toString()}}const s=(...e)=>new i(...e);n.makePoint=s;class o{constructor(e,t,n,l,i,s,o){this.isToken=!0,this.name=r.EMPTY,this.tin=-1,this.val=void 0,this.src=r.EMPTY,this.sI=-1,this.rI=-1,this.cI=-1,this.len=-1,this.name=e,this.tin=t,this.src=l,this.val=n,this.sI=i.sI,this.rI=i.rI,this.cI=i.cI,this.use=s,this.why=o,this.len=null==l?0:l.length}resolveVal(e,t){return"function"==typeof this.val?this.val(e,t):this.val}bad(e,t){return this.err=e,null!=t&&(this.use=(0,l.deep)(this.use||{},t)),this}toString(){return"Token["+this.name+"="+this.tin+" "+(0,l.snip)(this.src)+(void 0===this.val||"#ST"===this.name||"#TX"===this.name?"":"="+(0,l.snip)(this.val))+" "+[this.sI,this.rI,this.cI]+(null==this.use?"":" "+(0,l.snip)(""+JSON.stringify(this.use).replace(/"/g,""),22))+(null==this.err?"":" "+this.err)+(null==this.why?"":" "+(0,l.snip)(""+this.why,22))+"]"}[r.INSPECT](){return this.toString()}}const a=(...e)=>new o(...e);function u(e,t,n){let r=e.pnt,l=t;if(e.cfg.fixed.lex&&null!=n&&0<n.length){let i,s=e.cfg.fixed.token[n];null!=s&&(i=e.token(s,void 0,n,r)),null!=i&&(r.sI+=i.src.length,r.cI+=i.src.length,null==t?l=i:r.token.push(i))}return l}n.makeToken=a,n.makeNoToken=()=>a("",-1,void 0,r.EMPTY,s(-1)),n.makeFixedMatcher=(e,t)=>{let n=(0,l.regexp)(null,"^(",e.rePart.fixed,")");return function(t){let r=e.fixed;if(!r.lex)return;let l=t.pnt,i=t.src.substring(l.sI).match(n);if(i){let e=i[1],n=e.length;if(0<n){let i,s=r.token[e];return null!=s&&(i=t.token(s,void 0,e,l),l.sI+=n,l.cI+=n),i}}}},n.makeMatchMatcher=(e,t)=>{let n=(0,l.values)(e.match.value),r=(0,l.values)(e.match.token);return 0===n.length&&0===r.length?null:function(t,l,i=0){if(!e.match.lex)return;let s=t.pnt,o=t.src.substring(s.sI),a="o"===l.state?0:1;for(let e of n)if(e.match instanceof RegExp){let n=o.match(e.match);if(n){let r=n[0],l=r.length;if(0<l){let i,o=e.val?e.val(n):r;return i=t.token("#VL",o,r,s),s.sI+=l,s.cI+=l,i}}}else{let n=e.match(t,l);if(null!=n)return n}for(let e of r)if(!e.tin$||l.spec.def.tcol[a][i].includes(e.tin$))if(e instanceof RegExp){let n=o.match(e);if(n){let r=n[0],l=r.length;if(0<l){let n,i=e.tin$;return n=t.token(i,r,r,s),s.sI+=l,s.cI+=l,n}}}else{let n=e(t,l);if(null!=n)return n}}},n.makeCommentMatcher=(e,t)=>{let n=t.comment;e.comment={lex:!!n&&!!n.lex,def:((null==n?void 0:n.def)?(0,l.entries)(n.def):[]).reduce((e,[t,n])=>{if(null==n||!1===n)return e;let r={name:t,start:n.start,end:n.end,line:!!n.line,lex:!!n.lex,suffixMatch:void 0,getSuffixMatch:void 0};return e[t]=r,e},{})};let r=e.comment.lex?(0,l.values)(e.comment.def).filter(e=>e.lex&&e.line):[],i=e.comment.lex?(0,l.values)(e.comment.def).filter(e=>e.lex&&!e.line):[];return function(t,n){if(!e.comment.lex)return;let s=t.pnt,o=t.src.substring(s.sI),a=s.rI,u=s.cI;for(let l of r)if(o.startsWith(l.start)){let n=o.length,r=l.start.length;for(u+=l.start.length;r<n&&!e.line.chars[o[r]];)u++,r++;let i=o.substring(0,r),a=t.token("#CM",void 0,i,s);return s.sI+=i.length,s.cI=u,a}for(let r of i)if(o.startsWith(r.start)){let n=o.length,i=r.start.length,c=r.end;for(u+=r.start.length;i<n&&!o.substring(i).startsWith(c);)e.line.rowChars[o[i]]&&(a++,u=0),u++,i++;if(o.substring(i).startsWith(c)){u+=c.length;let e=o.substring(0,i+c.length),n=t.token("#CM",void 0,e,s);return s.sI+=e.length,s.rI=a,s.cI=u,n}return t.bad(l.S.unterminated_comment,s.sI,s.sI+9*r.start.length)}}},n.makeTextMatcher=(e,t)=>{let n=(0,l.regexp)(e.line.lex?null:"s","^(.*?)",...e.rePart.ender);return function(r){let l=e.text,i=r.pnt,s=r.src.substring(i.sI),o=e.value.def,a=e.value.defre,c=s.match(n);if(c){let n,p=c[1],d=c[2];if(null!=p){let t=p.length;if(0<t){let u;if(e.value.lex)if(void 0!==(u=o[p]))n=r.token("#VL",u.val,p,i),i.sI+=t,i.cI+=t;else for(let e in a){let t=a[e];if(t.match){let e=t.match.exec(t.consume?s:p);if(e&&(t.consume||e[0].length===p.length)){let l=e[0];if(null==t.val)n=r.token("#VL",l,l,i);else{let s=t.val(e);n=r.token("#VL",s,l,i)}i.sI+=l.length,i.cI+=l.length}}}null==n&&l.lex&&(n=r.token("#TX",p,p,i),i.sI+=t,i.cI+=t)}}if(n&&(n=u(r,n,d)),n&&0<e.text.modify.length){const l=e.text.modify;for(let i=0;i<l.length;i++)n.val=l[i](n.val,r,e,t)}return n}}},n.makeNumberMatcher=(e,t)=>{let n=e.number,r=(0,l.regexp)(null,["^([-+]?(0(",[n.hex?"x[0-9a-fA-F_]+":null,n.oct?"o[0-7_]+":null,n.bin?"b[01_]+":null].filter(e=>null!=e).join("|"),")|[.0-9]+([0-9_]*[0-9])?)","(\\.[0-9]?([0-9_]*[0-9])?)?","([eE][-+]?[0-9]+([0-9_]*[0-9])?)?"].join("").replace(/_/g,n.sep?(0,l.escre)(n.sepChar):""),")",...e.rePart.ender),i=n.sep?(0,l.regexp)("g",(0,l.escre)(n.sepChar)):void 0;return function(t){if(n=e.number,!n.lex)return;let l=t.pnt,s=t.src.substring(l.sI),o=e.value.def,a=s.match(r);if(a){let n,r=a[1],s=a[9],c=!0;if(null!=r&&(c=!e.number.exclude||!r.match(e.number.exclude))){let s=r.length;if(0<s){let a;if(e.value.lex&&void 0!==(a=o[r]))n=t.token("#VL",a.val,r,l);else{let e=i?r.replace(i,""):r,o=+e;if(isNaN(o)){let t=e[0];"-"!==t&&"+"!==t||(o=("-"===t?-1:1)*+e.substring(1))}isNaN(o)||(n=t.token("#NR",o,r,l),l.sI+=s,l.cI+=s)}}}return c&&(n=u(t,n,s)),n}}},n.makeStringMatcher=(e,t)=>{let n=t.string||{};return e.string=e.string||{},e.string=(0,l.deep)(e.string,{lex:!!(null==n?void 0:n.lex),quoteMap:(0,l.charset)(n.chars),multiChars:(0,l.charset)(n.multiChars),escMap:(0,l.clean)({...n.escape}),escChar:n.escapeChar,escCharCode:null==n.escapeChar?void 0:n.escapeChar.charCodeAt(0),allowUnknown:!!n.allowUnknown,replaceCodeMap:(0,l.omap)((0,l.clean)({...n.replace}),([e,t])=>[e.charCodeAt(0),t]),hasReplace:!1}),e.string.hasReplace=0<(0,l.keys)(e.string.replaceCodeMap).length,function(t){let n=e.string;if(!n.lex)return;let{quoteMap:i,escMap:s,escChar:o,escCharCode:a,multiChars:u,allowUnknown:c,replaceCodeMap:p,hasReplace:d}=n,{pnt:m,src:h}=t,{sI:f,rI:g,cI:k}=m,v=h.length;if(i[h[f]]){const n=h[f],i=f,b=g,x=u[n];++f,++k;let y,j=[];for(;f<v;f++){k++;let r=h[f];if(y=void 0,n===r){f++;break}if(o===r){f++,k++;let e=s[h[f]];if(null!=e)j.push(e);else if("x"===h[f]){f++;let e=parseInt(h.substring(f,f+2),16);if(isNaN(e))return f-=2,k-=2,m.sI=f,m.cI=k,t.bad(l.S.invalid_ascii,f,f+4);let n=String.fromCharCode(e);j.push(n),f+=1,k+=2}else if("u"===h[f]){f++;let e="{"===h[f]?(f++,1):0,n=e?6:4,r=parseInt(h.substring(f,f+n),16);if(isNaN(r))return f=f-2-e,k-=2,m.sI=f,m.cI=k,t.bad(l.S.invalid_unicode,f,f+n+2+2*e);let i=String.fromCodePoint(r);j.push(i),f+=n-1+e,k+=n+e}else{if(!c)return m.sI=f,m.cI=k-1,t.bad(l.S.unexpected,f,f+1);j.push(h[f])}}else if(d&&void 0!==(y=p[h.charCodeAt(f)]))j.push(y),k++;else{let r=f,i=n.charCodeAt(0),s=h.charCodeAt(f);for(;(!d||void 0===(y=p[s]))&&f<v&&32<=s&&i!==s&&a!==s;)s=h.charCodeAt(++f),k++;if(k--,void 0===y&&s<32){if(!x||!e.line.chars[h[f]])return m.sI=f,m.cI=k,t.bad(l.S.unprintable,f,f+1);e.line.rowChars[h[f]]&&(m.rI=++g),k=1,j.push(h.substring(r,f+1))}else j.push(h.substring(r,f)),f--}}if(h[f-1]!==n||m.sI===f-1)return m.rI=b,t.bad(l.S.unterminated_string,i,f);const S=t.token("#ST",j.join(r.EMPTY),h.substring(m.sI,f),m);return m.sI=f,m.rI=g,m.cI=k,S}}},n.makeLineMatcher=(e,t)=>function(t){if(!e.line.lex)return;let n,{chars:r,rowChars:l}=e.line,{pnt:i,src:s}=t,{sI:o,rI:a}=i,u=e.line.single;for(u&&(n={});r[s[o]]&&!(n&&(n[s[o]]=(n[s[o]]||0)+1,u&&1<n[s[o]]));)a+=l[s[o]]?1:0,o++;if(i.sI<o){let e=s.substring(i.sI,o);const n=t.token("#LN",void 0,e,i);return i.sI+=e.length,i.rI=a,i.cI=1,n}},n.makeSpaceMatcher=(e,t)=>function(t){if(!e.space.lex)return;let{chars:n}=e.space,{pnt:r,src:l}=t,{sI:i,cI:s}=r;for(;n[l[i]];)i++,s++;if(r.sI<i){let e=l.substring(r.sI,i);const n=t.token("#SP",void 0,e,r);return r.sI+=e.length,r.cI=s,n}};class c{constructor(e){this.src=r.EMPTY,this.ctx={},this.cfg={},this.pnt=s(-1),this.ctx=e,this.src=e.src(),this.cfg=e.cfg,this.pnt=s(this.src.length)}token(e,t,n,r,i,s){let o,u;return"string"==typeof e?(u=e,o=(0,l.tokenize)(u,this.cfg)):(o=e,u=(0,l.tokenize)(e,this.cfg)),a(u,o,t,n,r||this.pnt,i,s)}next(e,t,n,r){let i,s,o=this.pnt,a=o.sI;if(o.end)i=o.end;else if(0<o.token.length)i=o.token.shift();else if(o.len<=o.sI)o.end=this.token("#ZZ",void 0,"",o),i=o.end;else{try{for(let t of this.cfg.lex.match)if(i=t(this,e,r)){s=t;break}}catch(u){i=i||this.token("#BD",void 0,this.src[o.sI],o,{err:u},u.code||l.S.unexpected)}i=i||this.token("#BD",void 0,this.src[o.sI],o,void 0,l.S.unexpected)}return this.ctx.log&&(0,l.log_lex)(this.ctx,e,this,o,a,s,i,t,n,r),this.ctx.sub.lex&&this.ctx.sub.lex.map(t=>t(i,e,this.ctx)),i}tokenize(e){return(0,l.tokenize)(e,this.cfg)}bad(e,t,n){return this.token("#BD",void 0,0<=t&&t<=n?this.src.substring(t,n):this.src[this.pnt.sI],void 0,void 0,e)}}n.makeLex=(...e)=>new c(...e)})),r={};Object.defineProperty(r,"__esModule",{value:!0}),r.STRING=r.INSPECT=r.EMPTY=r.AFTER=r.BEFORE=r.CLOSE=r.OPEN=void 0,r.OPEN="o",r.CLOSE="c",r.BEFORE="b",r.AFTER="a",r.EMPTY="",r.INSPECT=Symbol.for("nodejs.util.inspect.custom"),r.STRING="string";var l={};Object.defineProperty(l,"__esModule",{value:!0}),l.defaults=void 0;const i=n({}),s={tag:"-",fixed:{lex:!0,token:{"#OB":"{","#CB":"}","#OS":"[","#CS":"]","#CL":":","#CA":","}},match:{lex:!0,token:{}},tokenSet:{IGNORE:["#SP","#LN","#CM"],VAL:["#TX","#NR","#ST","#VL"],KEY:["#TX","#NR","#ST","#VL"]},space:{lex:!0,chars:" \t"},line:{lex:!0,chars:"\r\n",rowChars:"\n",single:!1},text:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,sep:"_",exclude:void 0},comment:{lex:!0,def:{hash:{line:!0,start:"#",lex:!0},slash:{line:!0,start:"//",lex:!0},multi:{line:!1,start:"/*",end:"*/",lex:!0}}},string:{lex:!0,chars:"'\"`",multiChars:"`",escapeChar:"\\",escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",'"':'"',"'":"'","`":"`","\\":"\\","/":"/"},allowUnknown:!0},map:{extend:!0,merge:void 0},list:{property:!0},value:{lex:!0,def:{true:{val:!0},false:{val:!1},null:{val:null}}},ender:[],plugin:{},debug:{get_console:()=>console,maxlen:99,print:{config:!1,src:void 0}},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated_string:"unterminated string: $src",unterminated_comment:"unterminated comment: $src",unknown_rule:"unknown rule: $rulename"},hint:function(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!\n\n~code: $code,~details: \n$details|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~thisStringHasNoEndQuote.|~thisCommentIsNeverClosed.|~noRuleNamed $rulenameIsDefined.~thisIsProbablyAnErrorInThe\ngrammarOfAPlugin.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated_string|unterminated_comment|unknown_rule".split("|").reduce((n,r,l)=>(n[r]=e(t[l]),n),{})},lex:{match:{match:{order:1e6,make:i.makeMatchMatcher},fixed:{order:2e6,make:i.makeFixedMatcher},space:{order:3e6,make:i.makeSpaceMatcher},line:{order:4e6,make:i.makeLineMatcher},string:{order:5e6,make:i.makeStringMatcher},comment:{order:6e6,make:i.makeCommentMatcher},number:{order:7e6,make:i.makeNumberMatcher},text:{order:8e6,make:i.makeTextMatcher}},empty:!0,emptyResult:void 0},rule:{start:"val",finish:!0,maxmul:3,include:"",exclude:""},result:{fail:[]},config:{modify:{}},parser:{start:void 0}};l.defaults=s;var o={};Object.defineProperty(o,"__esModule",{value:!0}),o.makeRuleSpec=o.makeNoRule=o.makeRule=void 0;const a=t({});class u{constructor(e,t,n){this.i=-1,this.name=r.EMPTY,this.node=null,this.state=r.OPEN,this.n=Object.create(null),this.d=-1,this.use=Object.create(null),this.keep=Object.create(null),this.bo=!1,this.ao=!1,this.bc=!1,this.ac=!1,this.os=0,this.cs=0,this.need=0,this.i=t.uI++,this.name=e.name,this.spec=e,this.child=t.NORULE,this.parent=t.NORULE,this.prev=t.NORULE,this.o0=t.NOTOKEN,this.o1=t.NOTOKEN,this.c0=t.NOTOKEN,this.c1=t.NOTOKEN,this.node=n,this.d=t.rsI,this.bo=null!=e.def.bo,this.ao=null!=e.def.ao,this.bc=null!=e.def.bc,this.ac=null!=e.def.ac}process(e,t){return this.spec.process(this,e,t,this.state)}toString(){return"[Rule "+this.name+"~"+this.i+"]"}}const c=(...e)=>new u(...e);o.makeRule=c,o.makeNoRule=e=>c(g(e.cfg,{}),e);class p{constructor(){this.p=r.EMPTY,this.r=r.EMPTY,this.b=0}}const d=(...e)=>new p(...e),m=d(),h=d();class f{constructor(e,t){this.name=r.EMPTY,this.def={open:[],close:[],bo:[],bc:[],ao:[],ac:[],tcol:[]},this.cfg=e,this.def=Object.assign(this.def,t),this.def.open=(this.def.open||[]).filter(e=>null!=e),this.def.close=(this.def.close||[]).filter(e=>null!=e);for(let n of[...this.def.open,...this.def.close])k(n)}tin(e){return(0,a.tokenize)(e,this.cfg)}add(e,t,n){let r=(null==n?void 0:n.append)?"push":"unshift",l=((0,a.isarr)(t)?t:[t]).filter(e=>null!=e&&"object"==typeof e).map(e=>k(e)),i="o"===e?"open":"close",s=this.def[i];return s[r](...l),(0,a.modlist)(s,n),(0,a.filterRules)(this,this.cfg),this.norm(),this}open(e,t){return this.add("o",e,t)}close(e,t){return this.add("c",e,t)}action(e,t,n,r){let l=this.def[t+n];return e?l.push(r):l.unshift(r),this}bo(e,t){return this.action(!t||!!e,r.BEFORE,r.OPEN,t||e)}ao(e,t){return this.action(!t||!!e,r.AFTER,r.OPEN,t||e)}bc(e,t){return this.action(!t||!!e,r.BEFORE,r.CLOSE,t||e)}ac(e,t){return this.action(!t||!!e,r.AFTER,r.CLOSE,t||e)}clear(){return this.def.open.length=0,this.def.close.length=0,this.def.bo.length=0,this.def.ao.length=0,this.def.bc.length=0,this.def.ac.length=0,this}norm(){this.def.open.map(e=>k(e)),this.def.close.map(e=>k(e));const e=[];function t(e,t,n){return n[e]=n[e]||[],[function(e,n){if(n.s&&n.s[t]){let r=[...new Set(e.concat(n.s[t]))];e.length=0,e.push(...r)}return e},n[e][t]=n[e][t]||[]]}return this.def.open.reduce(...t(0,0,e)),this.def.open.reduce(...t(0,1,e)),this.def.close.reduce(...t(1,0,e)),this.def.close.reduce(...t(1,1,e)),this.def.tcol=e,this}process(e,t,n,l){t.log&&(0,a.log_rule)(t,e,n);let i="o"===l,s=i?e:t.NORULE,o=i?"O":"C",u=this.def,p=i?u.open:u.close,d=i?e.bo?u.bo:null:e.bc?u.bc:null;if(d){let n;for(let r=0;r<d.length;r++)if(n=d[r].call(this,e,t,s,n),(null==n?void 0:n.isToken)&&(null==n?void 0:n.err))return this.bad(n,e,t,{is_open:i})}let f=0<p.length?function(e,t,n,l,i){let s=m;s.b=0,s.p=r.EMPTY,s.r=r.EMPTY,s.n=void 0,s.h=void 0,s.a=void 0,s.u=void 0,s.k=void 0,s.e=void 0;let o=null,u=0,c=!0,p=1<<i.cfg.t.AA-1,d=i.cfg.tokenSetTins.IGNORE;function h(e,t,r,l){let s;do{s=n.next(e,t,r,l),i.tC++}while(d[s.tin]);return s}let f=t.length;for(u=0;u<f;u++){o=t[u];let n=!1,r=!1;if(c=!0,o.S0){let e=(i.t0=i.NOTOKEN!==i.t0?i.t0:i.t0=h(l,o,u,0)).tin;if(n=!0,c=!!(o.S0[e/31|0]&(1<<e%31-1|p)),c&&(r=null!=o.S1,o.S1)){let e=(i.t1=i.NOTOKEN!==i.t1?i.t1:i.t1=h(l,o,u,1)).tin;r=!0,c=!!(o.S1[e/31|0]&(1<<e%31-1|p))}}if(e?(l.o0=n?i.t0:i.NOTOKEN,l.o1=r?i.t1:i.NOTOKEN,l.os=(n?1:0)+(r?1:0)):(l.c0=n?i.t0:i.NOTOKEN,l.c1=r?i.t1:i.NOTOKEN,l.cs=(n?1:0)+(r?1:0)),c&&o.c&&(c=c&&o.c(l,i,s)),c)break;o=null}c||(s.e=i.t0),o&&(s.n=null!=o.n?o.n:s.n,s.h=null!=o.h?o.h:s.h,s.a=null!=o.a?o.a:s.a,s.u=null!=o.u?o.u:s.u,s.k=null!=o.k?o.k:s.k,s.g=null!=o.g?o.g:s.g,s.e=o.e&&o.e(l,i,s)||void 0,s.p=null!=o.p&&!1!==o.p?"string"==typeof o.p?o.p:o.p(l,i,s):s.p,s.r=null!=o.r&&!1!==o.r?"string"==typeof o.r?o.r:o.r(l,i,s):s.r,s.b=null!=o.b&&!1!==o.b?"number"==typeof o.b?o.b:o.b(l,i,s):s.b);let g=u<t.length;return i.log&&(0,a.log_parse)(i,l,n,g,c,u,o,s),s}(i,p,n,e,t):h;if(f.h&&(f=f.h(e,t,f,s)||f,o+="H"),f.e)return this.bad(f.e,e,t,{is_open:i});if(f.n)for(let r in f.n)e.n[r]=0===f.n[r]?0:(null==e.n[r]?0:e.n[r])+f.n[r];if(f.u&&(e.use=Object.assign(e.use,f.u)),f.k&&(e.keep=Object.assign(e.keep,f.k)),f.a){o+="A";let n=f.a(e,t,f);if(n&&n.isToken&&n.err)return this.bad(n,e,t,{is_open:i})}if(f.p){t.rs[t.rsI++]=e;let n=t.rsm[f.p];if(!n)return this.bad(this.unknownRule(t.t0,f.p),e,t,{is_open:i});s=e.child=c(n,t,e.node),s.parent=e,s.n={...e.n},0<Object.keys(e.keep).length&&(s.keep={...e.keep}),o+="P`"+f.p+"`"}else if(f.r){let n=t.rsm[f.r];if(!n)return this.bad(this.unknownRule(t.t0,f.r),e,t,{is_open:i});s=c(n,t,e.node),s.parent=e.parent,s.prev=e,s.n={...e.n},0<Object.keys(e.keep).length&&(s.keep={...e.keep}),o+="R`"+f.r+"`"}else i||(s=t.rs[--t.rsI]||t.NORULE);let g=i?e.ao?u.ao:null:e.ac?u.ac:null;if(g){let n;for(let r=0;r<g.length;r++)if(n=g[r](e,t,s,n),(null==n?void 0:n.isToken)&&(null==n?void 0:n.err))return this.bad(n,e,t,{is_open:i})}s.why=o,t.log&&(0,a.log_node)(t,e,n,s),r.OPEN===e.state&&(e.state=r.CLOSE);let k=e[i?"os":"cs"]-(f.b||0);return 1===k?(t.v2=t.v1,t.v1=t.t0,t.t0=t.t1,t.t1=t.NOTOKEN):2==k&&(t.v2=t.t1,t.v1=t.t0,t.t0=t.NOTOKEN,t.t1=t.NOTOKEN),s}bad(e,t,n,r){throw new a.JsonicError(e.err||a.S.unexpected,{...e.use,state:r.is_open?a.S.open:a.S.close},e,t,n)}unknownRule(e,t){return e.err="unknown_rule",e.use=e.use||{},e.use.rulename=t,e}}const g=(...e)=>new f(...e);function k(e){if(null!=e.c){let t=e.c.n,n=e.c.d;null==t&&null==n||(e.c=function(e){let r=!0;if(null!=t)for(let n in t)r=r&&(null==e.n[n]||e.n[n]<=(null==t[n]?0:t[n]));return null!=n&&(r=r&&e.d<=n),r},null!=t&&(e.c.n=t),null!=n&&(e.c.d=n))}if(r.STRING===typeof e.g&&(e.g=e.g.split(/\s*,\s*/)),e.s&&0!==e.s.length){const t=e=>e.flat().filter(e=>"number"==typeof e),n=(e,t)=>e.filter(e=>31*t<=e&&e<31*(t+1)),r=(e,t)=>e.reduce((e,n)=>1<<n-(31*t+1)|e,0),l=t([e.s[0]]),i=t([e.s[1]]),s=e;s.S0=0<l.length?new Array(Math.max(...l.map(e=>1+e/31|0))).fill(null).map((e,t)=>t).map(e=>r(n(l,e),e)):null,s.S1=0<i.length?new Array(Math.max(...i.map(e=>1+e/31|0))).fill(null).map((e,t)=>t).map(e=>r(n(i,e),e)):null}else e.s=null;return e.p||(e.p=null),e.r||(e.r=null),e.b||(e.b=null),e}o.makeRuleSpec=g;var v={};Object.defineProperty(v,"__esModule",{value:!0}),v.makeParser=v.makeRuleSpec=v.makeRule=void 0;const b=t({}),x=n({});Object.defineProperty(v,"makeRule",{enumerable:!0,get:function(){return o.makeRule}}),Object.defineProperty(v,"makeRuleSpec",{enumerable:!0,get:function(){return o.makeRuleSpec}});class y{constructor(e,t){this.rsm={},this.options=e,this.cfg=t}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];if(null===t)delete this.rsm[e];else if(void 0!==t)return n=this.rsm[e]=this.rsm[e]||(0,o.makeRuleSpec)(this.cfg,{}),n=this.rsm[e]=t(this.rsm[e],this)||this.rsm[e],void(n.name=e);return n}start(e,t,n,l){let i,s=(0,x.makeToken)("#ZZ",(0,b.tokenize)("#ZZ",this.cfg),void 0,r.EMPTY,(0,x.makePoint)(-1)),a=(0,x.makeNoToken)(),u={uI:0,opts:this.options,cfg:this.cfg,meta:n||{},src:()=>e,root:()=>i,plgn:()=>t.internal().plugins,rule:{},sub:t.internal().sub,xs:-1,v2:s,v1:s,t0:a,t1:a,tC:-2,kI:-1,rs:[],rsI:0,rsm:this.rsm,log:void 0,F:(0,b.srcfmt)(this.cfg),use:{},NOTOKEN:a,NORULE:{}};u=(0,b.deep)(u,l);let c=(0,o.makeNoRule)(u);if(u.NORULE=c,u.rule=c,(0,b.makelog)(u,n),""===e){if(this.cfg.lex.empty)return this.cfg.lex.emptyResult;throw new b.JsonicError(b.S.unexpected,{src:e},u.t0,c,u)}let p=(0,b.badlex)((0,x.makeLex)(u),(0,b.tokenize)("#BD",this.cfg),u),d=this.rsm[this.cfg.rule.start];if(null==d)return;let m=(0,o.makeRule)(d,u);i=m;let h=2*(0,b.keys)(this.rsm).length*p.src.length*2*u.cfg.rule.maxmul,f=0;for(;c!==m&&f<h;)u.kI=f,u.rule=m,u.log&&u.log(u.kI+":"),u.sub.rule&&u.sub.rule.map(e=>e(m,u)),m=m.process(u,p),u.log&&(0,b.log_stack)(u,m,p),f++;if(s.tin!==p.next(m).tin)throw new b.JsonicError(b.S.unexpected,{},u.t0,c,u);const g=u.root().node;if(this.cfg.result.fail.includes(g))throw new b.JsonicError(b.S.unexpected,{},u.t0,c,u);return g}clone(e,t){let n=new y(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=(0,b.filterRules)(this.rsm[t],this.cfg),e),{}),n.norm(),n}norm(){(0,b.values)(this.rsm).map(e=>e.norm())}}v.makeParser=(...e)=>new y(...e);var j={};function S(e){const{deep:t}=e.util,{OB:n,CB:r,OS:l,CS:i,CL:s,CA:o,TX:a,ST:u,ZZ:c}=e.token,{VAL:p,KEY:d}=e.tokenSet,m=(e,t)=>{if(!t.cfg.rule.finish)return t.t0.src="END_OF_SOURCE",t.t0},h=e=>{const t=e.o0,n=u===t.tin||a===t.tin?t.val:t.src;e.use.key=n};e.rule("val",e=>{e.bo(e=>e.node=void 0).open([{s:[n],p:"map",b:1,g:"map,json"},{s:[l],p:"list",b:1,g:"list,json"},{s:[p],g:"val,json"}]).close([{s:[c],g:"end,json"},{b:1,g:"more,json"}]).bc((e,t)=>{e.node=void 0===e.node?void 0===e.child.node?0===e.os?void 0:e.o0.resolveVal(e,t):e.child.node:e.node})}),e.rule("map",e=>{e.bo(e=>{e.node={}}).open([{s:[n,r],b:1,n:{pk:0},g:"map,json"},{s:[n],p:"pair",n:{pk:0},g:"map,json,pair"}]).close([{s:[r],g:"end,json"}])}),e.rule("list",e=>{e.bo(e=>{e.node=[]}).open([{s:[l,i],b:1,g:"list,json"},{s:[l],p:"elem",g:"list,elem,json"}]).close([{s:[i],g:"end,json"}])}),e.rule("pair",e=>{e.open([{s:[d,s],p:"val",u:{pair:!0},a:h,g:"map,pair,key,json"}]).bc((e,t)=>{e.use.pair&&(e.use.prev=e.node[e.use.key],e.node[e.use.key]=e.child.node)}).close([{s:[o],r:"pair",g:"map,pair,json"},{s:[r],b:1,g:"map,pair,json"}])}),e.rule("elem",e=>{e.open([{p:"val",g:"list,elem,val,json"}]).bc(e=>{!0!==e.use.done&&e.node.push(e.child.node)}).close([{s:[o],r:"elem",g:"list,elem,json"},{s:[i],b:1,g:"list,elem,json"}])});const f=(e,n)=>{let r=e.use.key,l=e.child.node;const i=e.use.prev;l=void 0===l?null:l,e.node[r]=null==i?l:n.cfg.map.merge?n.cfg.map.merge(i,l,e,n):n.cfg.map.extend?t(i,l):l};e.rule("val",e=>{e.open([{s:[d,s],p:"map",b:2,n:{pk:1},g:"pair,jsonic"},{s:[p],g:"val,json"},{s:[[r,i]],b:1,c:e=>0<e.d,g:"val,imp,null,jsonic"},{s:[o],c:e=>0===e.d,p:"list",b:1,g:"list,imp,jsonic"},{s:[o],b:1,g:"list,val,imp,null,jsonic"},{s:[c],g:"jsonic"}],{append:!0,delete:[2]}).close([{s:[[r,i]],b:1,g:"val,json,close",e:(e,t)=>0===e.d?t.t0:void 0},{s:[o],c:{n:{dlist:0,dmap:0}},r:"list",u:{implist:!0},g:"list,val,imp,comma,jsonic"},{c:{n:{dlist:0,dmap:0}},r:"list",u:{implist:!0},g:"list,val,imp,space,jsonic",b:1},{s:[c],g:"jsonic"}],{append:!0,move:[1,-1]})}),e.rule("map",e=>{e.bo(e=>{e.n.dmap=1+(e.n.dmap?e.n.dmap:0)}).open([{s:[n,c],b:1,e:m,g:"end,jsonic"}]).open([{s:[d,s],p:"pair",b:2,g:"pair,list,val,imp"}],{append:!0}).close([{s:[r],c:{n:{pk:0}},g:"end,json"},{s:[r],b:1,g:"path,jsonic"},{s:[[o,i,...p]],b:1,g:"end,path,jsonic"},{s:[c],e:m,g:"end,jsonic"}],{append:!0,delete:[0]})}),e.rule("list",e=>{e.bo(e=>{e.n.dlist=1+(e.n.dlist?e.n.dlist:0),e.prev.use.implist&&(e.node.push(e.prev.node),e.prev.node=e.node)}).open({c:e=>e.prev.use.implist,p:"elem"}).open([{s:[o],p:"elem",b:1,g:"list,elem,val,imp"},{p:"elem",g:"list,elem"}],{append:!0}).close([{s:[c],e:m,g:"end,jsonic"}],{append:!0})}),e.rule("pair",(e,t)=>{e.open([{s:[o],g:"map,pair,comma"}],{append:!0}).bc((e,t)=>{e.use.pair&&f(e,t)}).close([{s:[r],c:{n:{pk:0}},b:1,g:"map,pair,json"},{s:[o,r],c:{n:{pk:0}},b:1,g:"map,pair,comma,jsonic"},{s:[o,c],g:"end,jsonic"},{s:[o],c:{n:{pk:0}},r:"pair",g:"map,pair,json"},{s:[o],c:{n:{dmap:1}},r:"pair",g:"map,pair,jsonic"},{s:[d],c:{n:{dmap:1}},r:"pair",b:1,g:"map,pair,imp,jsonic"},{s:[[r,o,i,...d]],b:1,g:"map,pair,imp,path,jsonic",c:e=>0<e.n.pk},{s:[i],e:e=>e.c0,g:"end,jsonic"},{s:[c],e:m,g:"map,pair,json"},{r:"pair",b:1,g:"map,pair,imp,jsonic"}],{append:!0,delete:[0,1]})}),e.rule("elem",(e,t)=>{e.open([{s:[o,o],b:2,u:{done:!0},a:e=>e.node.push(null),g:"list,elem,imp,null,jsonic"},{s:[o],u:{done:!0},a:e=>e.node.push(null),g:"list,elem,imp,null,jsonic"},{s:[d,s],e:t.cfg.list.property?void 0:(e,t)=>t.t0,p:"val",n:{pk:1,dmap:1},u:{done:!0,pair:!0},a:h,g:"elem,pair,jsonic"}]).bc((e,t)=>{!0===e.use.pair&&(e.use.prev=e.node[e.use.key],f(e,t))}).close([{s:[o,[i,c]],b:1,g:"list,elem,comma,jsonic"},{s:[o],r:"elem",g:"list,elem,json"},{s:[i],b:1,g:"list,elem,json"},{s:[c],e:m,g:"list,elem,json"},{s:[r],e:e=>e.c0,g:"end,jsonic"},{r:"elem",b:1,g:"list,elem,imp,jsonic"}],{delete:[-1,-2]})})}Object.defineProperty(j,"__esModule",{value:!0}),j.makeJSON=j.grammar=void 0,j.grammar=S,j.makeJSON=function(e){let t=e.make({grammar$:!1,text:{lex:!1},number:{hex:!1,oct:!1,bin:!1,sep:null,exclude:/^00+/},string:{chars:'"',multiChars:"",allowUnknown:!1,escape:{v:null}},comment:{lex:!1},map:{extend:!1},lex:{empty:!1},rule:{finish:!1,include:"json"},result:{fail:[void 0,NaN]},tokenSet:{KEY:["#ST",null,null,null]}});return S(t),t};var E={};Object.defineProperty(E,"__esModule",{value:!0}),E.Debug=void 0;const O=(e,t)=>{const{keys:n,values:r,entries:l}=e.util;e.debug={describe:function(){let t=e.internal().config.lex.match,i=e.rule();return["========= RULES =========",N(e,n(i),i),"\n","========= ALTS =========",r(i).map(t=>"  "+t.name+":\n"+I(e,t,"open")+I(e,t,"close")).join("\n\n"),"\n","========= LEXER =========","  "+(t&&t.map(e=>e.order+": "+e.matcher+" ("+e.make.name+")")||[]).join("\n  "),"\n","\n","========= PLUGIN =========","  "+e.internal().plugins.map(e=>e.name+(e.options?l(e.options).reduce((e,t)=>e+"\n    "+t[0]+": "+JSON.stringify(t[1]),""):"")).join("\n  "),"\n"].join("\n")}};const i=e.use.bind(e);e.use=(...e)=>{let n=i(...e);return t.print&&n.internal().config.debug.get_console().log(n.debug.describe()),n},t.trace};function I(e,t,n){const{entries:r}=e.util;return 0===t.def[n].length?"":"    "+n.toUpperCase()+":\n"+t.def[n].map((t,n)=>{var l,i;return"      "+(""+n).padStart(5," ")+" "+("["+(t.s||[]).map(t=>null==t?"***INVALID***":"number"==typeof t?e.token[t]:"["+t.map(t=>e.token[t])+"]").join(" ")+"] ").padEnd(32," ")+(t.r?" r="+("string"==typeof t.r?t.r:"<F>"):"")+(t.p?" p="+("string"==typeof t.p?t.p:"<F>"):"")+(t.r||t.p?"":"\t")+"\t"+(null==t.b?"":"b="+t.b)+"\t"+(null==t.n?"":"n="+r(t.n).map(([e,t])=>e+":"+t))+"\t"+(null==t.a?"":"A")+(null==t.c?"":"C")+(null==t.h?"":"H")+"\t"+(null==(null===(l=t.c)||void 0===l?void 0:l.n)?"\t":" CN="+r(t.c.n).map(([e,t])=>e+":"+t))+(null==(null===(i=t.c)||void 0===i?void 0:i.d)?"":" CD="+t.c.d)+(t.g?"\tg="+t.g:"")}).join("\n")+"\n"}function N(e,t,n){const{values:r,omap:l}=e.util;return t.reduce((e,t)=>e+="  "+t+":\n    "+r(l({op:T(n,t,"open","p"),or:T(n,t,"open","r"),cp:T(n,t,"close","p"),cr:T(n,t,"close","r")},([e,t])=>[1<t.length?e:void 0,e+": "+t])).join("\n    ")+"\n","")}function T(e,t,n,r){return[...new Set(e[t].def[n].filter(e=>e[r]).map(e=>e[r]).map(e=>"string"==typeof e?e:"<F>"))].join(" ")}E.Debug=O,O.defaults={print:!0,trace:!1};var M={exports:{}};Object.defineProperty(M.exports,"__esModule",{value:!0}),M.exports.EMPTY=M.exports.AFTER=M.exports.BEFORE=M.exports.CLOSE=M.exports.OPEN=M.exports.makeTextMatcher=M.exports.makeNumberMatcher=M.exports.makeCommentMatcher=M.exports.makeStringMatcher=M.exports.makeLineMatcher=M.exports.makeSpaceMatcher=M.exports.makeFixedMatcher=M.exports.makeParser=M.exports.makeLex=M.exports.makeRuleSpec=M.exports.makeRule=M.exports.makePoint=M.exports.makeToken=M.exports.make=M.exports.util=M.exports.Debug=M.exports.JsonicError=M.exports.Jsonic=void 0,Object.defineProperty(M.exports,"OPEN",{enumerable:!0,get:function(){return r.OPEN}}),Object.defineProperty(M.exports,"CLOSE",{enumerable:!0,get:function(){return r.CLOSE}}),Object.defineProperty(M.exports,"BEFORE",{enumerable:!0,get:function(){return r.BEFORE}}),Object.defineProperty(M.exports,"AFTER",{enumerable:!0,get:function(){return r.AFTER}}),Object.defineProperty(M.exports,"EMPTY",{enumerable:!0,get:function(){return r.EMPTY}});const P=t({});Object.defineProperty(M.exports,"JsonicError",{enumerable:!0,get:function(){return P.JsonicError}});const C=n({});Object.defineProperty(M.exports,"makePoint",{enumerable:!0,get:function(){return C.makePoint}}),Object.defineProperty(M.exports,"makeToken",{enumerable:!0,get:function(){return C.makeToken}}),Object.defineProperty(M.exports,"makeLex",{enumerable:!0,get:function(){return C.makeLex}}),Object.defineProperty(M.exports,"makeFixedMatcher",{enumerable:!0,get:function(){return C.makeFixedMatcher}}),Object.defineProperty(M.exports,"makeSpaceMatcher",{enumerable:!0,get:function(){return C.makeSpaceMatcher}}),Object.defineProperty(M.exports,"makeLineMatcher",{enumerable:!0,get:function(){return C.makeLineMatcher}}),Object.defineProperty(M.exports,"makeStringMatcher",{enumerable:!0,get:function(){return C.makeStringMatcher}}),Object.defineProperty(M.exports,"makeCommentMatcher",{enumerable:!0,get:function(){return C.makeCommentMatcher}}),Object.defineProperty(M.exports,"makeNumberMatcher",{enumerable:!0,get:function(){return C.makeNumberMatcher}}),Object.defineProperty(M.exports,"makeTextMatcher",{enumerable:!0,get:function(){return C.makeTextMatcher}}),Object.defineProperty(M.exports,"makeRule",{enumerable:!0,get:function(){return v.makeRule}}),Object.defineProperty(M.exports,"makeRuleSpec",{enumerable:!0,get:function(){return v.makeRuleSpec}}),Object.defineProperty(M.exports,"makeParser",{enumerable:!0,get:function(){return v.makeParser}}),Object.defineProperty(M.exports,"Debug",{enumerable:!0,get:function(){return E.Debug}});const R={tokenize:P.tokenize,srcfmt:P.srcfmt,clone:P.clone,charset:P.charset,trimstk:P.trimstk,makelog:P.makelog,badlex:P.badlex,extract:P.extract,errinject:P.errinject,errdesc:P.errdesc,configure:P.configure,parserwrap:P.parserwrap,mesc:P.mesc,escre:P.escre,regexp:P.regexp,prop:P.prop,str:P.str,clean:P.clean,deep:P.deep,omap:P.omap,keys:P.keys,values:P.values,entries:P.entries};function _(e,t){let n=!0;if("jsonic"===e)n=!1;else if("json"===e)return(0,j.makeJSON)(w);e="string"==typeof e?{}:e;let r={parser:null,config:null,plugins:[],sub:{lex:void 0,rule:void 0},mark:Math.random()},i=(0,P.deep)({},t?{...t.options}:!1===(null==e?void 0:e.defaults$)?{}:l.defaults,e||{}),s=function(e,t,n){var r;if(P.S.string===typeof e){let l=s.internal();return((null===(r=o.parser)||void 0===r?void 0:r.start)?(0,P.parserwrap)(o.parser):l.parser).start(e,s,t,n)}return e},o=e=>{if(null!=e&&P.S.object===typeof e){(0,P.deep)(i,e),(0,P.configure)(s,r.config,i);let t=s.internal().parser;r.parser=t.clone(i,r.config)}return{...s.options}},a={token:e=>(0,P.tokenize)(e,r.config,s),tokenSet:e=>(0,P.findTokenSet)(e,r.config),fixed:e=>r.config.fixed.ref[e],options:(0,P.deep)(o,i),config:()=>(0,P.deep)(r.config),parse:s,use:function(e,t){const n=e.name.toLowerCase(),r=(0,P.deep)({},e.defaults||{},t||{});s.options({plugin:{[n]:r}});let l=s.options.plugin[n];return s.internal().plugins.push(e),e.options=l,e(s,l)||s},rule:(e,t)=>s.internal().parser.rule(e,t)||s,make:e=>_(e,s),empty:e=>_({defaults$:!1,standard$:!1,grammar$:!1,...e||{}}),id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+(null==o.tag?"":"/"+o.tag),toString:()=>a.id,sub:e=>(e.lex&&(r.sub.lex=r.sub.lex||[],r.sub.lex.push(e.lex)),e.rule&&(r.sub.rule=r.sub.rule||[],r.sub.rule.push(e.rule)),s),util:R};if((0,P.defprop)(a.make,P.S.name,{value:P.S.make}),n?(0,P.assign)(s,a):(0,P.assign)(s,{empty:a.empty,parse:a.parse,sub:a.sub,id:a.id,toString:a.toString}),(0,P.defprop)(s,"internal",{value:()=>r}),t){for(let n in t)void 0===s[n]&&(s[n]=t[n]);s.parent=t;let e=t.internal();r.config=(0,P.deep)({},e.config),(0,P.configure)(s,r.config,i),(0,P.assign)(s.token,r.config.t),r.plugins=[...e.plugins],r.parser=e.parser.clone(i,r.config)}else{let e={...s,...a};r.config=(0,P.configure)(e,void 0,i),r.plugins=[],r.parser=(0,v.makeParser)(i,r.config),!1!==i.grammar$&&(0,j.grammar)(e)}return s}let w;M.exports.util=R,M.exports.make=_;let A=w=_("jsonic");return M.exports.Jsonic=A,w.Jsonic=w,w.JsonicError=P.JsonicError,w.Debug=E.Debug,w.makeLex=C.makeLex,w.makeParser=v.makeParser,w.makeToken=C.makeToken,w.makePoint=C.makePoint,w.makeRule=v.makeRule,w.makeRuleSpec=v.makeRuleSpec,w.makeFixedMatcher=C.makeFixedMatcher,w.makeSpaceMatcher=C.makeSpaceMatcher,w.makeLineMatcher=C.makeLineMatcher,w.makeStringMatcher=C.makeStringMatcher,w.makeCommentMatcher=C.makeCommentMatcher,w.makeNumberMatcher=C.makeNumberMatcher,w.makeTextMatcher=C.makeTextMatcher,w.OPEN=r.OPEN,w.CLOSE=r.CLOSE,w.BEFORE=r.BEFORE,w.AFTER=r.AFTER,w.EMPTY=r.EMPTY,w.util=R,w.make=_,M.exports.default=A,M.exports=M.exports.Jsonic,M=M.exports}));