!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const n="object",t="string",r="function",s="unexpected",o="map",l="list",i="elem",c="pair",a="val",u="node";class p extends SyntaxError{constructor(e,n,t,r,s){n=k.deep({},n);let o=k.deep({},{rI:s.rI,opts:s.opts,config:s.config,meta:s.meta,src:()=>s.src(),root:()=>s.root(),plugins:()=>s.plugins(),node:s.node,t0:s.t0,t1:s.t1,tI:s.tI,next:()=>s.next(),log:s.log,use:s.use}),l=p.make_desc(e,n,t,r,o);super(l.message),Object.assign(this,l),this.stack&&(this.stack=this.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}static make_desc(e,n,t,s,o){t={...t};let l=o.opts,i=o.meta,c=k.errinject(l.error[e]||l.error.unknown,e,n,t,s,o);r===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let a=["[31m[jsonic/"+e+"]:[0m "+(i&&i.mode?"[35m[mode:"+i.mode+"]:[0m ":"")+c,"  [34m--\x3e[0m "+(i.fileName||"<no-file>")+":"+t.row+":"+t.col,k.extract(o.src(),c,t),k.errinject((l.hint[e]||l.hint.unknown).split("\n").map((e,n)=>(0===n?" ":"  ")+e).join("\n"),e,n,t,s,o),"  [2mhttps://jsonic.richardrodger.com[0m","  [2m--internal: rule="+s.name+"~"+m[s.state]+"; token="+o.config.token[t.pin]+"; plugins="+o.plugins().map(e=>e.name).join(",")+"--[0m\n"].join("\n"),u={internal:{token:t,ctx:o}};return{...Object.create(u),message:a,code:e,details:n,meta:i,fileName:i.fileName,lineNumber:t.row,columnNumber:t.col}}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=p;class d{constructor(e){this.match={},this.match[k.token("@LTP",e)]=[],this.match[k.token("@LTX",e)]=[],this.match[k.token("@LCS",e)]=[],this.match[k.token("@LML",e)]=[],this.end={pin:k.token("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const n=e.opts,t=e.config;let r=e=>k.token(e,t),s=e=>k.token(e,t),o=e.F,l=r("@LTP"),i=r("@LTX"),c=r("@LCS"),a=r("@LML"),u=r("#ZZ"),p=r("#SP"),d=r("#CM"),m=r("#NR"),h=r("#ST"),f=r("#TX"),g=r("#VL");r("#LN");let b={pin:u,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},v=0,x=0,_=0,y=e.src(),C=y.length,w=null!=e&&null!=e.log?(...n)=>e.log("lex",...n):void 0,S=this;function j(n,t,r,s){return S.bad(e,w,n,b,v,t,x,_,r,r,s)}function N(n,t){let r=S.match[n];if(null!=r){b.loc=v;for(let n of r){let r=n(v,y,b,e,t,j);if(r)return v=r.sI,x=r.rD?x+r.rD:x,_=r.cD?_+r.cD:_,w&&w(s(b.pin),o(b.src),{...b}),b}}}let A=function(e){b.len=0,b.val=void 0,b.src=void 0,b.row=x;let r=l,k=null,S="",A=0,I=[],T=-1;e:for(;v<C;){let u=y[v],L=y.charCodeAt(v);if(l!==r){if(i===r){if(N(i,e))return b;let r=n.text.hoover?t.hoover_ender:t.text_ender;for(;null!=y[A]&&(!r.includes(y[A])||t.cmk0.includes(y[A])&&!t.cmk1.includes(y[A+1]));)_++,A++;if(b.len=A-v,b.pin=f,b.val=y.substring(v,A),b.src=b.val,n.text.hoover&&t.multi.SP.includes(b.val[b.val.length-1])){let e=b.val.length-2;for(;0<e&&t.multi.SP.includes(b.val[e]);)e--;b.val=b.val.substring(0,e+1),b.src=b.val,_-=b.len-e-1,b.len=b.val.length,v+=b.len}else v=A;return w&&w(s(b.pin),o(b.src),{...b}),b}if(c===r){if(N(c,e))return b;for(A=v;A<C&&!S.includes(y[A]);)A++,_++;return b.val+=y.substring(v,A),b.src=b.val,b.len=b.val.length,v=A,r=l,w&&w(s(b.pin),o(b.src),{...b}),b}if(a===r){if(N(a,e))return b;A=v;let i=1,c=k[0],u=k[1],p=n.balance[k[2]],d=!!k[3],m="",h=c.length,f=u.length;if(d){let e=v-1;for(;-1<e&&t.multi.SP.includes(y[e--]););m=t.multi.SP[0].repeat(v-e-2)}for(A+=c.length;A<C&&0<i;)u[0]===y[A]&&u===y.substring(A,A+f)?(A+=f,_+=f,i--):p&&c[0]===y[A]&&c===y.substring(A,A+h)?(A+=h,_+=f,i++):(n.char.row===y[A]?(x++,_=0):_++,A++);return b.val=y.substring(v,A),b.src=b.val,b.len=b.val.length,d&&(b.val=b.val.substring(h,b.val.length-f),b.val=b.val.replace(new RegExp(n.char.row+m,"g"),"\n"),b.val=b.val.substring(1,b.val.length-1)),v=A,r=l,w&&w(s(b.pin),o(b.src),{...b}),b}}else{if(N(l,e))return b;if(t.start.SP.includes(L)){for(b.pin=p,b.loc=v,b.col=_++,A=v+1;t.multi.SP.includes(y[A]);)_++,A++;return b.len=A-v,b.val=y.substring(v,A),b.src=b.val,v=A,w&&w(s(b.pin),o(b.src),{...b}),b}if(t.start.LN.includes(L)){for(b.pin=t.lex.core.LN,b.loc=v,b.col=_,A=v,_=0;t.multi.LN.includes(y[A]);)x+=n.char.row===y[A]?1:0,A++;return b.len=A-v,b.val=y.substring(v,A),b.src=b.val,v=A,w&&w(s(b.pin),o(b.src),{...b}),b}if(null!=t.single[L])return b.pin=t.single[L],b.loc=v,b.col=_++,b.len=1,b.src=u,v++,w&&w(s(b.pin),o(b.src),{...b}),b;if(t.start.NR.includes(L)){for(b.pin=m,b.loc=v,b.col=_,A=v;n.number.digital.includes(y[++A]););if((null==y[A]||t.value_ender.includes(y[A]))&&(b.len=A-v,1<b.len&&"0"===y[v]&&"x"!=y[v+1]?(b.val=void 0,A--):(b.val=+y.substring(v,A),n.number.underscore&&isNaN(b.val)&&(b.val=+y.substring(v,A).replace(/_/g,"")),isNaN(b.val)&&(b.val=void 0,A--))),null!=b.val)return b.src=y.substring(v,A),_+=b.len,v=A,w&&w(s(b.pin),o(b.src),{...b}),b}if(t.start_bm.includes(L)){let e=y.substring(v,v+t.bmk_maxlen);for(let s of t.bmk)if(e.startsWith(s)){b.pin=h,b.loc=v,b.col=_,r=a,k=[s,n.string.block[s],null,!0];continue e}}if(t.start.ST.includes(L)){b.pin=h,b.loc=v,b.col=_++;let e=u.charCodeAt(0),r=n.string.multiline.includes(u);for(I=[],T=-1,A=v+1;A<C;A++)if(_++,e===(T=y.charCodeAt(A))){if(!n.string.escapedouble||e!==y.charCodeAt(A+1)){A++;break}I.push(y[A]),A++}else if(92===T){let e=y.charCodeAt(++A);_++;let r=t.escape[e];if(null!=r)I.push(r);else if(120===e){A++;let e=String.fromCharCode("0x"+y.substring(A,A+2));if(n.char.bad_unicode===e)return j("invalid_ascii",A,y.substring(A-2,A+2));I.push(e),A+=1,_+=2}else if(117===e){A++;let e=String.fromCharCode("0x"+y.substring(A,A+4));if(n.char.bad_unicode===e)return j("invalid_unicode",A,y.substring(A-2,A+4));I.push(e),A+=3,_+=4}else I.push(y[A])}else if(T<32){if(!r||!t.start.LN.includes(T))return j("unprintable",A,"char-code="+y[A].charCodeAt(0));I.push(y[A])}else{let n=A;do{T=y.charCodeAt(++A),_++}while(32<=T&&e!==T&&92!==T);_--,I.push(y.substring(n,A)),A--}return e!==T?(_=v,j("unterminated",A-1,I.join(""))):(b.val=I.join(""),b.src=y.substring(v,A),b.len=A-v,v=A,w&&w(s(b.pin),o(b.src),{...b}),b)}if(t.start_cm.includes(L)){let e=t.cm_single.includes(u),s=y.substring(v,v+t.cmk_maxlen);for(let o of t.cmk)if(s.startsWith(o)){if(!0!==n.comment[o]){b.pin=d,b.loc=v,b.col=_,b.val="",r=a,k=[o,n.comment[o],"comment"];continue e}e=!0;break}if(e){b.pin=d,b.loc=v,b.col=_,b.val="",r=c,S=t.multi.LN;continue e}}b.loc=v,b.col=_,A=v;do{_++,A++}while(null!=y[A]&&!t.value_ender.includes(y[A]));let f=y.substring(v,A),O=n.value[f];if(void 0!==O)return b.pin=g,b.val=O,b.src=f,b.len=A-v,v=A,w&&w(s(b.pin),o(b.src),{...b}),b;r=i}}return b.pin=u,b.loc=C,b.col=_,w&&w(s(b.pin),o(b.src),{...b}),b};return A.src=y,A}bad(e,n,t,r,s,o,l,i,c,a,u){return r.why=t,r.pin=k.token("#BD",e.config),r.loc=o,r.row=l,r.col=i,r.len=o-s+1,r.val=c,r.src=a,r.use=u,n&&n(k.token(r.pin,e.config),e.F(r.src),{...r},"error",t),r}lex(e,n){if(null==e&&null==n)return this.match;if(null==this.match[e])throw new Error("jsonic: unknown lex state:"+e);return null!=n&&this.match[e].push(n),this.match[e]}clone(e){let n=new d(e);return k.deep(n.match,this.match),n}}var m;e.exports.Lexer=d,function(e){e[e.open=0]="open",e[e.close=1]="close"}(m||(m={}));class h{constructor(e,n,t){this.id=n.rI++,this.name=e.name,this.spec=e,this.node=t,this.state=m.open,this.child=f,this.open=[],this.close=[],this.n={}}process(e){let n=f;return m.open===this.state?n=this.spec.open(this,e):m.close===this.state&&(n=this.spec.close(this,e)),n}}e.exports.Rule=h;let f={id:0,spec:{name:"norule"}};class g{constructor(e,n){function t(e){return"object"==typeof e&&e.n?(n,t,r)=>{let s=!0;for(let o in e.n)s=s&&(null==t.n[o]||t.n[o]<=e.n[o]);return s}:e}this.name=e,this.def=n;for(let r of this.def.open)null!=r.c&&(r.c=t(r.c));for(let r of this.def.close)null!=r.c&&(r.c=t(r.c))}open(e,n){let t,r=e,o="",l=n.F;this.def.before_open&&(t=this.def.before_open.call(this,e,n),e.node=t&&t.node||e.node);let i=null!=t&&t.done?{m:[]}:this.parse_alts(this.def.open,e,n);if(i.e)throw new p(s,{open:!0},i.e,e,n);if(e.open=i.m,i.n)for(let s in i.n)e.n[s]=0===i.n[s]?0:(null==e.n[s]?0:e.n[s])+i.n[s],e.n[s]=0<e.n[s]?e.n[s]:0;return i.p?(n.rs.push(e),(r=e.child=new h(n.rsm[i.p],n,e.node)).parent=e,r.n={...e.n},o+="U"):i.r?((r=new h(n.rsm[i.r],n,e.node)).parent=e.parent,r.n={...e.n},o+="R"):o+="Z",this.def.after_open&&this.def.after_open.call(this,e,n,r),n.log&&n.log(u,e.name+"/"+e.id,m[e.state],o,l(e.node)),e.state=m.close,r}close(e,n){let t=f,r="";this.def.before_close&&this.def.before_close.call(this,e,n);let o=0<this.def.close.length?this.parse_alts(this.def.close,e,n):{};if(o.e)throw new p(s,{close:!0},o.e,e,n);if(o.n)for(let s in o.n)e.n[s]=0===o.n[s]?0:(null==e.n[s]?0:e.n[s])+o.n[s],e.n[s]=0<e.n[s]?e.n[s]:0;return o.h&&(t=o.h(this,e,n)||t,r+="H"),o.p?(n.rs.push(e),(t=e.child=new h(n.rsm[o.p],n,e.node)).parent=e,t.n={...e.n},r+="U"):o.r?((t=new h(n.rsm[o.r],n,e.node)).parent=e.parent,t.n={...e.n},r+="R"):(t=n.rs.pop()||f,r+="O"),this.def.after_close&&this.def.after_close.call(this,e,n,t),t.why=r,n.log&&n.log(u,e.name+"/"+e.id,m[e.state],r,n.F(e.node)),t}parse_alts(e,n,t){let r,s=void 0,o=0,l=t.config.token;if(l.ZZ===t.t0.pin)s={m:[]};else if(0<e.length){for(o=0;o<e.length;o++)if(!(r=e[o]).c||r.c(r,n,t)){if(null==r.s||0===r.s.length){s={...r,m:[]};break}if(r.s[0]===t.t0.pin){if(1===r.s.length){s={...r,m:[t.t0]};break}if(r.s[1]===t.t1.pin){s={...r,m:[t.t0,t.t1]};break}}else if(l.AA===r.s[0]){s={...r,m:[t.t0]};break}}s=s||{e:t.t0,m:[]}}if(s=s||{m:[]},t.log&&t.log("parse",n.name+"/"+n.id,m[n.state],o<e.length?"alt="+o:"no-alt",o<e.length&&r&&r.s?"["+r.s.map(e=>l[e]).join(" ")+"]":"[]",t.tI,"p="+(s.p||""),"r="+(s.r||""),"b="+(s.b||""),s.m.map(e=>l[e.pin]).join(" "),t.F(s.m.map(e=>e.src)),"n:"+Object.entries(n.n).join(";"),s),s.m){let e=0,n=s.m.length-(s.b||0);for(;e++<n;)t.next()}return s}}e.exports.RuleSpec=g;class b{constructor(e,n){this.rsm={},this.opts=e,this.config=n}init(){let e=this.config.token,n=e.OB,t=e.CB,r=e.OS,s=e.CS,u=e.CL,p=e.CA,d=e.TX,m=e.NR,h=e.ST,f=e.VL,b=e.AA,v={val:{open:[{s:[n,p],p:o,n:{im:0}},{s:[n],p:o,n:{im:0}},{s:[r],p:l},{s:[p],p:l,b:1},{s:[d,u],p:o,b:2,n:{im:1}},{s:[h,u],p:o,b:2,n:{im:1}},{s:[m,u],p:o,b:2,n:{im:1}},{s:[f,u],p:o,b:2,n:{im:1}},{s:[d]},{s:[m]},{s:[h]},{s:[f]}],close:[{s:[p],c:(e,n,t)=>0===t.rs.length,r:i,h:(e,n,t)=>{n.node=[n.node]}},{s:[b],b:1}],before_close:e=>{var n,t;e.node=null!==(n=e.child.node)&&void 0!==n?n:null===(t=e.open[0])||void 0===t?void 0:t.val}},map:{before_open:()=>({node:{}}),open:[{s:[t]},{p:c}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[s]},{p:i}],close:[]},pair:{open:[{s:[h,u],p:a},{s:[d,u],p:a},{s:[m,u],p:a},{s:[f,u],p:a},{s:[t],b:1}],close:[{s:[t]},{s:[p],c:{n:{im:1}},r:c},{s:[p],n:{im:-1},b:1},{s:[h,u],c:{n:{im:1}},r:c,b:2},{s:[d,u],c:{n:{im:1}},r:c,b:2},{s:[m,u],c:{n:{im:1}},r:c,b:2},{s:[f,u],c:{n:{im:1}},r:c,b:2},{s:[h,u],n:{im:-1},b:2},{s:[d,u],n:{im:-1},b:2},{s:[m,u],n:{im:-1},b:2},{s:[f,u],n:{im:-1},b:2}],before_close:(e,n)=>{let r=e.open[0];if(r&&t!==r.pin){let t=h===r.pin?r.val:r.src,s=e.node[t];e.node[t]=null==s?e.child.node:n.opts.object.extend?k.deep(s,e.child.node):e.child.node}}},elem:{open:[{s:[n],p:o,n:{im:0}},{s:[r],p:l},{s:[d]},{s:[m]},{s:[h]},{s:[f]},{s:[p,p],b:2},{s:[p]}],close:[{s:[p,s]},{s:[p],r:i},{s:[s]},{s:[n],p:o,n:{im:0}},{s:[r],p:l},{s:[d,u],p:o,n:{im:0},b:2},{s:[m,u],p:o,n:{im:0},b:2},{s:[h,u],p:o,n:{im:0},b:2},{s:[f,u],p:o,n:{im:0},b:2},{s:[d],r:i,b:1},{s:[m],r:i,b:1},{s:[h],r:i,b:1},{s:[f],r:i,b:1}],after_open:(e,n,t)=>{if(e===t&&e.open[0]){let n=e.open[0].val;e.node.push(null!=n?n:null)}},before_close:e=>{e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(v).reduce((e,n)=>(e[n]=new g(n,v[n]),e),{})}rule(e,n){return this.rsm[e]=null==n?this.rsm[e]:n(this.rsm[e],this.rsm)||this.rsm[e],this.rsm[e]}start(e,n,t,r,s){let o,l=this.opts,i=this.config,c={rI:1,opts:l,config:i,meta:r||{},src:()=>n,root:()=>o.node,plugins:()=>t.internal().plugins,node:void 0,u2:e.end,u1:e.end,t0:e.end,t1:e.end,tI:-2,next:g,rs:[],rsm:this.rsm,log:r&&r.log||void 0,F:k.make_src_format(i),use:{}};null!=s&&(c=k.deep(c,s)),k.make_log(c);let a=e=>k.token(e,this.config),u=k.wrap_bad_lex(e.start(c),k.token("#BD",this.config),c),p=new h(this.rsm.val,c);o=p;let d=2*Object.keys(this.rsm).length*u.src.length*2*l.rule.maxmul;function g(e=!0){let n;c.u2=c.u1,c.u1=c.t0,c.t0=c.t1;do{n=u(p),c.tI++}while(e&&i.tokenset.IGNORE.includes(n.pin));return c.t1={...n},c.t0}g(),g();let b=0;for(;f!==p&&b<d;)c.log&&c.log("rule",p.name+"/"+p.id,m[p.state],c.rs.length,c.tI,"["+a(c.t0.pin)+" "+a(c.t1.pin)+"]","["+c.F(c.t0.src)+" "+c.F(c.t1.src)+"]",p,c),p=p.process(c),c.log&&c.log("stack",c.rs.length,c.rs.map(e=>e.name+"/"+e.id).join(";"),p,c),b++;return o.node}clone(e,n){let t=new b(e,n);return t.rsm=Object.keys(this.rsm).reduce((e,n)=>(e[n]=k.clone(this.rsm[n]),e),{}),t}}e.exports.Parser=b;let k={token:function(e,n,r){let s=n.token,o=s[e];return null==o&&t===typeof e&&(o=n.tokenI++,s[o]=e,s[e]=o,s[e.substring(1)]=o,null!=r&&Object.assign(r.token,n.token)),o},deep:function(e,...t){let s=r===typeof e,o=null!=e&&(n===typeof e||s);for(let l of t){let t=r===typeof l,i=null!=l&&(n===typeof l||t);if(o&&i&&!t&&Array.isArray(e)===Array.isArray(l))for(let n in l)e[n]=k.deep(e[n],l[n]);else e=void 0===l?e:t?l:i?k.deep(Array.isArray(l)?[]:{},l):l,s=r===typeof e,o=null!=e&&(n===typeof e||s)}return e},clone:function(e){return k.deep(Object.create(Object.getPrototypeOf(e)),e)},s2cca:function(e){return e.split("").map(e=>e.charCodeAt(0))},longest:e=>e.reduce((e,n)=>e<n.length?n.length:e,0),make_src_format:e=>(n,t)=>null==n?"":(t=JSON.stringify(n)).substring(0,e.debug.maxlen)+(e.debug.maxlen<t.length?"...":""),make_log:e=>{if("number"==typeof e.log){let t=!1,r=e.log;-1===r&&(r=1,t=!0),e.log=(...s)=>{if(t){let t=s.filter(e=>n!=typeof e).join("\t");e.opts.debug.get_console().log(t)}else e.opts.debug.get_console().dir(s,{depth:r})}}},wrap_bad_lex:(e,n,t)=>{let r=r=>{let o=e(r);if(n===o.pin){let e={};throw null!=o.use&&(e.use=o.use),new p(o.why||s,e,o,r,t)}return o};return r.src=e.src,r},errinject:(e,n,t,r,s,o)=>e.replace(/\$([\w_]+)/g,(e,l)=>JSON.stringify("code"===l?n:t[l]||o.meta[l]||r[l]||s[l]||o[l]||o.opts[l]||o.config[l]||"$"+l)),extract:(e,n,t)=>{let r=0<t.loc?t.loc:0,s=0<t.row?t.row:0,o=0<t.col?t.col:0,l=null==t.src?"":t.src,i=e.substring(Math.max(0,r-333),r).split("\n"),c=e.substring(r,r+333).split("\n"),a=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"[34m"+(""+u++).padStart(a," ")+" | [0m"+(null==e?"":e),d=i.length;return[2<d?p(i[d-3]):null,1<d?p(i[d-2]):null,p(i[d-1]+c[0])," ".repeat(a)+"   "+" ".repeat(o)+"[31m"+"^".repeat(l.length||1)+" "+n+"[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")},handle_meta_mode:(e,n,t)=>{let s=e.options;if(r!==typeof s.mode[t.mode])return[!1];try{return s.mode[t.mode].call(e,n,t)}catch(o){if("SyntaxError"===o.name){let r=0,l=0,i=0,c="",a=o.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(a){c=a[1],r=parseInt(a[2]),l=n.substring(0,r).replace(/[^\n]/g,"").length;let e=r-1;for(;-1<e&&"\n"!==n.charAt(e);)e--;i=e<r?n.substring(e,r).length-1:0}let u=o.token||{pin:e.token.UK,loc:r,len:c.length,row:o.lineNumber||l,col:o.columnNumber||i,val:void 0,src:c};throw new p(o.code||"json",o.details||{msg:o.message},u,{},o.ctx||{rI:-1,opts:s,config:{token:{}},token:{},meta:t,src:()=>n,root:()=>{},plugins:()=>[],node:void 0,u2:u,u1:u,t0:u,t1:u,tI:-1,rs:[],next:()=>u,rsm:{},n:{},log:t.log,F:k.make_src_format(e.internal().config),use:{}})}throw o}},build_config_from_options:function(e,n){let r=Object.keys(n.token);r.forEach(n=>k.token(n,e));let s=r.filter(e=>null!=n.token[e].c);e.single=s.reduce((t,r)=>{return t[(s=n.token[r].c,s.charCodeAt(0))]=e.token[r],t;var s},[]);let o=r.filter(e=>t===typeof n.token[e]);e.start=o.reduce((e,t)=>(e[t.substring(1)]=k.s2cca(n.token[t]),e),{}),e.multi=o.reduce((e,t)=>(e[t.substring(1)]=n.token[t],e),{});let l=r.filter(e=>null!=n.token[e].s);if(e.tokenset=l.reduce((t,r)=>(t[r.substring(1)]=n.token[r].s.split(",").map(n=>e.token[n]),t),{}),n.escape=n.escape||{},e.escape=Object.keys(n.escape).reduce((e,t)=>(e[t.charCodeAt(0)]=n.escape[t],e),[]),e.start_cm=[],e.cm_single="",e.cmk=[],e.cmk0="",e.cmk1="",n.comment){let t=Object.keys(n.comment);t.forEach(n=>{1===n.length?(e.start_cm.push(n.charCodeAt(0)),e.cm_single+=n):(e.start_cm.push(n.charCodeAt(0)),e.cmk.push(n),e.cmk0+=n[0],e.cmk1+=n[1])}),e.cmk_maxlen=k.longest(t)}e.start_cm_char=e.start_cm.map(e=>String.fromCharCode(e)).join(""),e.start_bm=[],e.bmk=[];let i=Object.keys(n.string.block);i.forEach(n=>{e.start_bm.push(n.charCodeAt(0)),e.bmk.push(n)}),e.bmk_maxlen=k.longest(i),e.single_char=e.single.map((e,n)=>String.fromCharCode(n)).join(""),e.value_ender=e.multi.SP+e.multi.LN+e.single_char+e.start_cm_char,e.text_ender=e.value_ender,e.hoover_ender=e.multi.LN+e.single_char+e.start_cm_char,e.lex={core:{LN:k.token(n.lex.core.LN,e)}},e.debug=n.debug}};function v(e,s){let o,l,i,c,a=e;r===typeof e&&(a={},s=e);let u=k.deep({},s?{...s.options}:{escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},char:{row:"\n",bad_unicode:String.fromCharCode("0x0000")},comment:{"#":!0,"//":!0,"/*":"*/"},balance:{comment:!0},number:{digital:"-1023456789._xeEaAbBcCdDfF+",underscore:!0},string:{multiline:"`",block:{"'''":"'''"},escapedouble:!1},text:{hoover:!0,endofline:!1},object:{extend:!0},value:{null:null,true:!0,false:!1},mode:{},plugin:{},debug:{get_console:()=>console,maxlen:33},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:x,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},lex:{core:{LN:"#LN"}},rule:{maxmul:3}},a),p=function(e,n,r){if(t===typeof e){let t=p.internal(),[s,o]=null!=n&&null!=n.mode?k.handle_meta_mode(p,e,n):[!1];return s||(o=t.parser.start(t.lexer,e,p,n,r)),o}return e};if(p.token=function(e){return k.token(e,i,p)},s){for(let n in s)p[n]=s[n];p.parent=s;let e=s.internal();i=k.deep({},e.config),k.build_config_from_options(i,u),Object.assign(p.token,i.token),c=[...e.plugins],o=e.lexer.clone(i),l=e.parser.clone(u,i)}else i={tokenI:1,token:{}},k.build_config_from_options(i,u),c=[],o=new d(i),(l=new b(u,i)).init();return Object.assign(p.token,i.token),p.internal=()=>({lexer:o,parser:l,config:i,plugins:c}),p.options=k.deep(e=>{if(null!=e&&n===typeof e){k.build_config_from_options(i,k.deep(u,e));for(let e in u)p.options[e]=u[e]}return p},u),p.parse=p,p.use=function(e,n){return p.options({plugin:{[e.name]:n||{}}}),p.internal().plugins.push(e),e(p)||p},p.rule=function(e,n){let t=p.internal().parser.rule(e,n);return null==n?t:p},p.lex=function(e,n){let t=p.internal().lexer.lex(e,n);return null==n?t:p},p.make=function(e){return v(e,p)},Object.defineProperty(p.make,"name",{value:"make"}),p}function x(e=((e,n="replace")=>e[n](/[A-Z]/g,e=>" "+e.toLowerCase())[n](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),n="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcShouldNotOccurAtThisPointAsItIsNot\nvalid %j%s%o%nSyntax,EvenUnderTheRelaxedJsonicRules.~ifItIs\nnotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsOrModesYouAre\nusingExpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((t,r,s)=>(t[r]=e(n[s]),t),{})}e.exports.util=k,e.exports.make=v;let _=v();return e.exports.Jsonic=_,_.Jsonic=_,_.JsonicError=p,_.Lexer=d,_.Parser=b,_.Rule=h,_.RuleSpec=g,_.util=k,_.make=v,e.exports.default=_,e.exports=e.exports.Jsonic,e=e.exports}));
