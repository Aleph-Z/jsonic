!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.Alt=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const t=Object.keys,n=Object.assign,r=Object.defineProperty,s="object",l="string",i="function",o="unexpected",c="map",a="list",u="elem",p="pair",h="val",d="node",f="",m="unprintable",g="invalid_ascii",b="invalid_unicode",x="invalid_lex_state",v="unterminated",k="lex",y="parse",w="block_indent_",C="error",S="none",A="END_OF_SOURCE",j="imp,map",N="imp,list",_="imp,null",T="end",I="open",E="close",L="rule",O="stack",P="null",R="name",M="make";class $ extends SyntaxError{constructor(e,t,r,s,l){let i=ue(e,t=z({},t),r,s,l);super(i.message),n(this,i),te(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=$;class U{constructor(e){this.match={},q("@LTP",e),q("@LTX",e),q("@LCS",e),q("@LML",e),this.end={tin:q("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const n=e.opts,r=e.cnfg;let s=e=>q(e,r),l=e=>q(e,r),i=e.F,c=s("@LTP"),a=s("@LTX"),u=s("@LCS"),p=s("@LML"),h=s("#ZZ"),d=s("#SP"),y=s("#CM"),C=s("#NR"),S=s("#ST"),A=s("#TX"),j=s("#VL"),N=s("#LN"),_={tin:h,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},T=0,I=0,E=0,L=c,O=null,P=e.src(),R=P.length,M=null!=e.log?(...t)=>e.log(k,l(_.tin),i(_.src),T,I+":"+E,l(L),{..._},...t):void 0,$=(t,n,r,s)=>this.bad(e,M,t,_,T,n,I,E,r,r,s),U=t=>{let n=this.match[L];if(null!=n)for(let r of n){let n=r({sI:T,rI:I,cI:E,src:P,token:_,ctx:e,rule:t,bad:$});if(n)return T=n.sI?n.sI:T,I=n.rI?n.rI:I,E=n.cI?n.cI:E,L=null==n.state?L:n.state,O=null==n.state_param?O:n.state_param,M&&M(_,r),_}},B=function(s){_.len=0,_.val=void 0,_.src=void 0,_.row=I,_.use=void 0;let l={},i=0,k=[];e:for(;T<R;){let h=P[T];if(_.loc=T,_.col=E,e.xs=L,c!==L){if(a===L){if(U(s))return _;i=T;let e=P.substring(T).match(r.re.te);if(e){let t=e[0].length;i+=t,E+=t}return _.len=i-T,_.tin=A,_.val=P.substring(T,i),_.src=_.val,T=i,L=c,M&&M(_),_}if(u===L){if(U(s))return _;for(i=T;i<R&&!l[P[i]];)i++,E++;return _.val+=P.substring(T,i),_.src=_.val,_.len=_.val.length,T=i,L=c,M&&M(_),_}if(p===L){if(U(s))return _;i=T;let e=1,l=O[0],o=O[1],a=O[2],u=!!O[3],p="",h=0,d=l.length,m=o.length;if(u){let e=T-1;for(;-1<e&&r.m.SP[P[e]];)e--;0<(h=T-e-1)&&(p=t(r.m.SP)[0].repeat(h))}for(i+=l.length;i<R&&0<e;)o[0]===P[i]&&o===P.substring(i,i+m)?(i+=m,E+=m,e--):a&&l[0]===P[i]&&l===P.substring(i,i+d)?(i+=d,E+=m,e++):(n.line.row===P[i]?(I++,E=0):E++,i++);if(_.val=P.substring(T,i),_.src=_.val,_.len=_.val.length,u){_.val=_.val.substring(d,_.val.length-m),null==r.re.block_prefix&&(r.re.block_prefix=le(f,"^[",se(n.token["#SP"]),"]*(",n.line.sep,")")),_.val=_.val.replace(r.re.block_prefix,""),null==r.re.block_suffix&&(r.re.block_suffix=le(f,n.line.sep,"[",se(n.token["#SP"]),"]*$")),_.val=_.val.replace(r.re.block_suffix,"");let e=r.re[w+p]=r.re[w+p]||le("g","^(",se(p),")|((",n.line.sep,")",se(p),")");_.val=_.val.replace(e,"$3")}return T=i,L=c,M&&M(_),_}return $(x,T,P[T],{state:L})}if(U(s))return _;if(n.space.lex&&r.m.SP[h]){for(_.tin=d,E++,i=T+1;r.m.SP[P[i]];)E++,i++;return _.len=i-T,_.val=P.substring(T,i),_.src=_.val,T=i,M&&M(_),_}if(n.line.lex&&r.m.LN[h]){for(_.tin=N,i=T,E=0;r.m.LN[P[i]];)I+=n.line.row===P[i]?1:0,i++;return _.len=i-T,_.val=P.substring(T,i),_.src=_.val,T=i,M&&M(_),_}if(n.number.lex&&r.m.NR[h]){let e=P.substring(T).match(r.re.nm);if(null!=e){let t=e[0];if(i=T+t.length,null==P[i]||r.cs.vend[P[i]]){let e=+(r.re.ns?t.replace(r.re.ns,""):t);if(!isNaN(e))return _.tin=C,_.src=t,_.val=e,_.len=t.length,T+=_.len,E+=_.len,M&&M(_),_}}}if(null!=r.sm[h])return _.tin=r.sm[h],_.len=1,_.src=h,T++,E++,M&&M(_),_;if(n.block.lex&&r.cs.bs[h]){let e=P.substring(T,T+r.bmx);for(let t of r.bmk)if(e.startsWith(t)){_.tin=S,L=p,O=[t,n.block.marker[t],null,!0];continue e}}if(n.string.lex&&r.m.ST[h]){_.tin=S,E++;let e=r.cs.mln[h];k=[];let t="";for(i=T+1;i<R;i++)if(E++,h===(t=P[i])){if(!n.string.escapedouble||h!==P[i+1]){i++;break}k.push(P[i]),i++}else if("\\"===t){i++,E++;let e=r.esc[P[i]];if(null!=e)k.push(e);else if("x"===P[i]){i++;let e=parseInt(P.substring(i,i+2),16);if(isNaN(e))return T=i-2,E-=2,$(g,i+2,P.substring(i-2,i+2));let t=String.fromCharCode(e);k.push(t),i+=1,E+=2}else if("u"===P[i]){let e="{"===P[++i]?(i++,1):0,t=e?6:4,n=parseInt(P.substring(i,i+t),16);if(isNaN(n))return T=i-2-e,E-=2,$(b,i+t+1,P.substring(i-2-e,i+t+e));let r=String.fromCodePoint(n);k.push(r),i+=t-1+e,E+=t+e}else k.push(P[i])}else{let s=i,l=h.charCodeAt(0),o="\\".charCodeAt(0),c=P.charCodeAt(i);for(;i<R&&32<=c&&l!==c&&o!==c;)c=P.charCodeAt(++i),E++;if(E--,t=P[i],c<32){if(!e||!r.m.LN[t])return $(m,i,"char-code="+P[i].charCodeAt(0));t===n.line.row&&(I++,E=0),k.push(P.substring(s,i+1))}else k.push(P.substring(s,i)),i--}return h!==t?$(v,i,k.join("")):(_.val=k.join(""),_.src=P.substring(T,i),_.len=i-T,T=i,M&&M(_),_)}if(n.comment.lex&&r.cs.cs[h]){let e=P.substring(T,T+r.cmx);for(let t of r.cmk)if(e.startsWith(t)){if(!0!==r.cm[t]){_.tin=y,_.val="",L=p,O=[t,r.cm[t],n.comment.balance];continue e}break}_.tin=y,_.val="",L=u,l=r.m.LN}else{if(n.value.lex&&r.vs[h]){i=T;do{i++}while(null!=P[i]&&!r.cs.vend[P[i]]);let e=P.substring(T,i),t=r.vm[e];if(void 0!==t)return _.tin=j,_.val=t,_.src=e,_.len=i-T,E+=_.len,T=i,M&&M(_),_}if(!n.text.lex)return $(o,T,P[T]);L=a}}return _.tin=h,_.loc=R,_.col=E,M&&M(_),_};return B.src=P,B}bad(e,t,n,r,s,l,i,o,c,a,u){return r.why=n,r.tin=q("#BD",e.cnfg),r.loc=s,r.row=i,r.col=o,r.len=l-s,r.val=c,r.src=a,r.use=u,t&&t(q(r.tin,e.cnfg),e.F(r.src),s,i+":"+o,{...r},C,n),r}lex(e,t){if(null==e)return this.match;let n=this.match[e];return null!=t?(null==n&&(n=this.match[e]=[]),n.push(t)):null===t&&(n=this.match[e],delete this.match[e]),n}clone(e){let t=new U(e);return z(t.match,this.match),t}}var B;e.exports.Lexer=U,function(e){e[e.open=0]="open",e[e.close=1]="close"}(B||(B={}));class D{constructor(e,t,n){this.id=t.uI++,this.name=e.name,this.spec=e,this.node=n,this.state=B.open,this.child=F,this.open=[],this.close=[],this.n={},this.use={},this.bo=!1!==e.bo,this.ao=!1!==e.ao,this.bc=!1!==e.bc,this.ac=!1!==e.ac}process(e){return this.spec.process(this,e,this.state)}}e.exports.Rule=D;const F={name:S,state:0};class J{constructor(){this.m=[],this.p="",this.r="",this.b=0}}e.exports.Alt=J;const Z=new J,V=new J;class Y{constructor(e){function t(e){let t=null!=e.c&&e.c.n;t&&(e.c=e=>{let n=!0;for(let r in t)n=n&&(null==e.n[r]||e.n[r]<=t[r]);return n}),l===typeof e.g&&(e.g=e.g.split(/\s*,\s*/))}this.name="-",this.bo=!0,this.ao=!0,this.bc=!0,this.ac=!0,this.def=e||{},this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let n of[...this.def.open,...this.def.close])t(n)}process(e,t,n){let r,s="",l=t.F,i=n===B.open,c=i?e:F,a=this.def,u=i?a.open:a.close,p=i?e.bo&&a.bo:e.bc&&a.bc;if(p&&(r=p.call(this,e,t))){if(r.err)throw new $(r.err,{...r,state:i?I:E},t.t0,e,t);e.node=r.node||e.node}let h=r&&r.alt?{...V,...r.alt}:0<u.length?this.parse_alts(u,e,t):V;if(h.h&&(h=h.h(e,t,h,c)||h,s+="H"),i?e.open=h.m:e.close=h.m,h.e)throw new $(o,{...h.e.use,state:i?I:E},h.e,e,t);if(h.n)for(let o in h.n)e.n[o]=0===h.n[o]?0:(null==e.n[o]?0:e.n[o])+h.n[o],e.n[o]=0<e.n[o]?e.n[o]:0;h.u&&(e.use=Object.assign(e.use,h.u)),h.a&&(s+="A",h.a.call(this,e,t,h,c)),h.p?(t.rs.push(e),(c=e.child=new D(t.rsm[h.p],t,e.node)).parent=e,c.n={...e.n},s+="U"):h.r?((c=new D(t.rsm[h.r],t,e.node)).parent=e.parent,c.n={...e.n},s+="R"):(i||(c=t.rs.pop()||F),s+="Z");let f=i?e.ao&&a.ao:e.ac&&a.ac;if(f){let n=f.call(this,e,t,h,c);if(n){if(n.err)throw t.t0.why=s,new $(n.err,{...n,state:i?I:E},t.t0,e,t);c=n.next||c}}c.why=s,t.log&&t.log(d,e.name+"~"+e.id,B[e.state],"w="+s,l(e.node));let m=0,g=h.m.length-(h.b||0);for(;m++<g;)t.next();return B.open===e.state&&(e.state=B.close),c}parse_alts(e,t,n){let r,s=Z;s.m=[],s.b=0,s.p="",s.r="",s.n=void 0,s.h=void 0,s.a=void 0,s.u=void 0,s.e=void 0;let l,i=0,o=n.cnfg.t,c=e.length;for(i=0;i<c&&(l=!1,null==(r=e[i]).s||0===r.s.length?l=!0:(r.s[0]===n.t0.tin||r.s[0]===o.AA||Array.isArray(r.s[0])&&r.s[0].includes(n.t0.tin))&&(1===r.s.length?(s.m=[n.t0],l=!0):(r.s[1]===n.t1.tin||r.s[1]===o.AA||Array.isArray(r.s[1])&&r.s[1].includes(n.t1.tin))&&(s.m=[n.t0,n.t1],l=!0)),!(l=(l=l&&(!r.c||r.c(t,n,s)))&&(null==r.d||r.d===n.rs.length)));i++)r=null;return null==r&&o.ZZ!==n.t0.tin&&(s.e=n.t0),null!=r&&(s.e=r.e&&r.e(t,n,s)||void 0,s.b=r.b?r.b:s.b,s.p=r.p?r.p:s.p,s.r=r.r?r.r:s.r,s.n=r.n?r.n:s.n,s.h=r.h?r.h:s.h,s.a=r.a?r.a:s.a,s.u=r.u?r.u:s.u),n.log&&n.log(y,t.name+"~"+t.id,B[t.state],i<e.length?"alt="+i:"no-alt",i<e.length&&r.s?"["+r.s.map(e=>o[e]).join(" ")+"]":"[]",n.tC,"p="+(s.p||""),"r="+(s.r||""),"b="+(s.b||""),s.m.map(e=>o[e.tin]).join(" "),n.F(s.m.map(e=>e.src)),"c:"+(r&&r.c?l:""),"n:"+Object.entries(t.n).join(";"),"u:"+Object.entries(t.use).join(";"),s),s}}e.exports.RuleSpec=Y;class W{constructor(e,t){this.rsm={},this.options=e,this.config=t}init(){let e=this.config.t,n=e.OB,r=e.CB,s=e.OS,l=e.CS,i=e.CL,o=e.CA,d=e.TX,f=e.NR,m=e.ST,g=e.VL,b=e.AA,x=e.ZZ,v=(e,t)=>{if(!this.options.rule.finish)return t.t0.src=A,t.t0},k={val:{open:[{s:[n,o],p:c,n:{im:0},g:j},{s:[n],p:c,n:{im:0}},{s:[s],p:a},{s:[o],d:0,p:a,b:1,g:N},{s:[o],b:1,g:N},{s:[[d,f,m,g],i],p:c,b:2,n:{im:1},g:j},{s:[[d,f,m,g]]},{s:[r],b:1,g:_},{s:[l],b:1,g:_}],close:[{s:[o],d:0,r:u,a:e=>e.node=[e.node],g:N},{c:(e,t,n)=>(d===t.t0.tin||f===t.t0.tin||m===t.t0.tin||g===t.t0.tin)&&0===t.rs.length,r:u,a:e=>e.node=[e.node],g:N},{s:[b],b:1}],bc:e=>{e.node=void 0===e.child.node?null==e.open[0]?void 0:e.open[0].val:e.child.node}},map:{bo:()=>({node:{}}),open:[{s:[r]},{p:p}],close:[]},list:{bo:()=>({node:[]}),open:[{s:[l]},{p:u}],close:[]},pair:{open:[{s:[[d,f,m,g],i],p:h,u:{key:!0}},{s:[r],b:1}],close:[{s:[r]},{s:[o],c:{n:{im:1}},r:p},{s:[o],b:1},{s:[[d,f,m,g],i],c:{n:{im:1}},r:p,b:2},{s:[[d,f,m,g],i],b:2},{s:[l],b:1},{s:[x],e:v,g:T}],bc:(e,t)=>{if(e.use.key){let n=e.open[0],r=m===n.tin?n.val:n.src,s=e.child.node,l=e.node[r];void 0===s&&i===t.v1.tin&&(s=null),e.node[r]=null==l?s:t.opts.map.extend?z(l,s):s}}},elem:{open:[{s:[n],p:c,n:{im:0}},{s:[s],p:a},{s:[o,o],b:2,g:P,a:e=>e.node.push(null)},{s:[o],g:P,a:e=>e.node.push(null)},{p:h,n:{im:1}}],close:[{s:[o,l]},{s:[o],r:u},{s:[l]},{s:[n],p:c,n:{im:0}},{s:[s],p:a},{s:[[d,f,m,g]],r:u,b:1},{s:[x],e:v,g:T}],bc:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=t(k).reduce((e,t)=>(e[t]=new Y(k[t]),e[t].name=t,e),{})}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];return null===t?delete this.rsm[e]:void 0!==t&&((n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e),n}start(e,n,r,s,l){let i,c={uI:1,opts:this.options,cnfg:this.config,meta:s||{},src:()=>n,root:()=>i.node,plgn:()=>r.internal().plugins,rule:F,xs:-1,v2:e.end,v1:e.end,t0:e.end,t1:e.end,tC:-2,next:f,rs:[],rsm:this.rsm,log:s&&s.log||void 0,F:X(this.config),use:{}};null!=l&&(c=z(c,l)),ne(c);let a=e=>q(e,this.config),u=re(e.start(c),q("#BD",this.config),c),p=this.rsm[this.options.rule.start];if(null==p)return;let h=new D(p,c);i=h;let d=2*t(this.rsm).length*u.src.length*2*this.options.rule.maxmul;function f(){let e;c.v2=c.v1,c.v1=c.t0,c.t0=c.t1;do{e=u(h),c.tC++}while(c.cnfg.ts.IGNORE[e.tin]);return c.t1={...e},c.t0}f(),f();let m=0;for(;F!==h&&m<d;)c.log&&c.log(L,h.name+"~"+h.id,B[h.state],c.rs.length,c.tC,"["+a(c.t0.tin)+" "+a(c.t1.tin)+"]","["+c.F(c.t0.src)+" "+c.F(c.t1.src)+"]",h,c),c.rule=h,h=h.process(c),c.log&&c.log(O,c.rs.length,c.rs.map(e=>e.name+"~"+e.id).join("/"),h,c),m++;if(q("#ZZ",this.config)!==c.t0.tin)throw new $(o,{},c.t0,F,c);return i.node}clone(e,t){let n=new W(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=K(this.rsm[t]),e),{}),n}}e.exports.Parser=W;let H={tokenize:q,srcfmt:X,deep:z,clone:K,charset:Q,longest:ee,marr:function(e,t){return e.length===t.length&&e.reduce((e,n,r)=>e&&n===t[r],!0)},trimstk:te,makelog:ne,badlex:re,extract:ce,errinject:oe,errdesc:ue,configure:pe,parserwrap:ae,regexp:le,mesc:se,ender:ie};function G(e,t){let i,o,c,a,u=z({},t?{...t.options}:{tag:"-",line:{lex:!0,row:"\n",sep:"\r*\n"},comment:{lex:!0,balance:!0,marker:{"#":!0,"//":!0,"/*":"*/"}},space:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},block:{lex:!0,marker:{"'''":"'''"}},string:{lex:!0,escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",escapedouble:!1},text:{lex:!0},map:{extend:!0},value:{lex:!0,src:{null:null,true:!0,false:!1}},plugin:{},debug:{get_console:()=>console,maxlen:99,print:{config:!1}},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:he,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#NR":"-0123456789+","#ST":"\"'`","#TX":!0,"#VL":!0,"#CM":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},rule:{start:h,finish:!0,maxmul:3},config:{modify:{}},parser:{start:void 0}},e||{}),p=function(e,t,n){if(l===typeof e){let r=p.internal();return(d.parser.start?ae(d.parser):r.parser).start(r.lexer,e,p,t,n)}return e},d=e=>{if(null!=e&&s===typeof e){pe(c,z(u,e));for(let e in u)p.options[e]=u[e];n(p.token,c.t)}return{...p.options}},f={token:function(e){return q(e,c,p)},options:z(d,u),parse:p,use:function(e,t){return p.options({plugin:{[e.name]:t||{}}}),p.internal().plugins.push(e),e(p)||p},rule:function(e,t){return p.internal().parser.rule(e,t)},lex:function(e,t){return p.internal().lexer.lex(e,t)},make:function(e){return G(e,p)},id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+"/"+d.tag,toString:function(){return this.id}};if(r(f.make,R,{value:M}),t){for(let n in t)p[n]=t[n];p.parent=t;let e=t.internal();pe(c=z({},e.config),u),n(p.token,c.t),a=[...e.plugins],i=e.lexer.clone(c),o=e.parser.clone(u,c)}else pe(c={tI:1,t:{}},u),a=[],i=new U(c),(o=new W(u,c)).init();return n(p,f),n(p.token,c.t),r(p,"internal",{value:function(){return{lexer:i,parser:o,config:c,plugins:a}}}),p}function X(e){return(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.d.maxlen)+(e.d.maxlen<n.length?"...":"")}function q(e,t,r){let s=t.t,i=s[e];return null==i&&l===typeof e&&(s[i=t.tI++]=e,s[e]=i,s[e.substring(1)]=i,null!=r&&n(r.token,t.t)),i}function z(e,...t){let n=i===typeof e,r=null!=e&&(s===typeof e||n);for(let l of t){let t=i===typeof l,o=null!=l&&(s===typeof l||t);if(r&&o&&!t&&Array.isArray(e)===Array.isArray(l))for(let n in l)e[n]=z(e[n],l[n]);else e=void 0===l?e:t?l:o?z(Array.isArray(l)?[]:{},l):l,n=i===typeof e,r=null!=e&&(s===typeof e||n)}return e}function K(e){return z(Object.create(Object.getPrototypeOf(e)),e)}function Q(...e){return e.filter(e=>!1!==e).map(e=>"object"==typeof e?t(e).join(""):e).join("").split("").reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{})}function ee(e){return e.reduce((e,t)=>e<t.length?t.length:e,0)}function te(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function ne(e){if("number"==typeof e.log){let t=!1,n=e.log;-1===n&&(n=1,t=!0),e.log=(...r)=>{if(t){let t=r.filter(e=>s!=typeof e).map(e=>i==typeof e?e.name:e).join("\t");e.opts.debug.get_console().log(t)}else e.opts.debug.get_console().dir(r,{depth:n})}}return e.log}function re(e,t,n){let r=r=>{let s=e(r);if(t===s.tin){let e={};throw null!=s.use&&(e.use=s.use),new $(s.why||o,e,s,r,n)}return s};return r.src=e.src,r}function se(e,t){return(t=new String(e)).esc=!0,t}function le(e,...t){return new RegExp(t.map(e=>e.esc?e.replace(/[-\\|\]{}()[^$+*?.!=]/g,"\\$&"):e).join(""),e)}function ie(e,n){let r=t(t(n).reduce((e,t)=>(e[t[0]]=1,e),{...e})).join(""),s=Object.entries(t(n).filter(e=>1<e.length).reduce((e,t)=>((e[t[0]]=e[t[0]]||[]).push(t.substring(1)),e),{})).reduce((e,t)=>(e.push([t[0],t[1].map(e=>le("",se(e)).source).join("|")]),e),[]).map(e=>["|(",se(e[0]),"(?!(",e[1],")))"]).flat(1);return le(f,"^(([^",se(r),"]+)",...s,")+")}function oe(e,t,n,r,s,l){return e.replace(/\$([\w_]+)/g,(e,i)=>JSON.stringify("code"===i?t:n[i]||(l.meta?l.meta[i]:void 0)||r[i]||s[i]||l[i]||l.opts[i]||l.cnfg[i]||"$"+i))}function ce(e,t,n){let r=0<n.loc?n.loc:0,s=0<n.row?n.row:0,l=0<n.col?n.col:0,i=null==n.src?"":n.src,o=e.substring(Math.max(0,r-333),r).split("\n"),c=e.substring(r,r+333).split("\n"),a=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"\x1b[34m"+(""+u++).padStart(a," ")+" | \x1b[0m"+(null==e?"":e),h=o.length;return[2<h?p(o[h-3]):null,1<h?p(o[h-2]):null,p(o[h-1]+c[0])," ".repeat(a)+"   "+" ".repeat(l)+"\x1b[31m"+"^".repeat(i.length||1)+" "+t+"\x1b[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")}function ae(e){return{start:function(t,n,r,s,l){try{return e.start(t,n,r,s,l)}catch(i){if("SyntaxError"===i.name){let e=0,t=0,l=0,o="",c=i.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(c){o=c[1],e=parseInt(c[2]),t=n.substring(0,e).replace(/[^\n]/g,"").length;let r=e-1;for(;-1<r&&"\n"!==n.charAt(r);)r--;l=Math.max(n.substring(r,e).length,0)}let a=i.token||{tin:r.token.UK,loc:e,len:o.length,row:i.lineNumber||t,col:i.columnNumber||l,val:void 0,src:o};throw new $(i.code||"json",i.details||{msg:i.message},a,{},i.ctx||{uI:-1,opts:r.options,cnfg:{t:{}},token:a,meta:s,src:()=>n,root:()=>{},plgn:()=>r.internal().plugins,rule:F,xs:-1,v2:a,v1:a,t0:a,t1:a,tC:-1,rs:[],next:()=>a,rsm:{},n:{},log:s?s.log:void 0,F:X(r.internal().config),use:{}})}throw i}}}}function ue(e,t,n,r,s){n={...n};let l=s.opts,o=s.meta,c=oe(l.error[e]||l.error.unknown,e,t,n,r,s);i===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let a=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+c,"  \x1b[34m--\x3e\x1b[0m "+(o&&o.fileName||"<no-file>")+":"+n.row+":"+n.col,ce(s.src(),c,n),oe((l.hint[e]||l.hint.unknown).replace(/^([^ ])/," $1").split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,r,s),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+r.name+"~"+B[r.state]+"; token="+s.cnfg.t[n.tin]+(null==n.why?"":"~"+n.why)+"; plugins="+s.plgn().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:s}};return{...Object.create(u),message:a,code:e,details:t,meta:o,fileName:o?o.fileName:void 0,lineNumber:n.row,columnNumber:n.col}}function pe(e,n){let r=t(n.token);r.forEach(t=>q(t,e));let s=r.filter(e=>null!=n.token[e].c);e.sm=s.reduce((t,r)=>(t[n.token[r].c]=e.t[r],t),{});let i=r.filter(e=>l===typeof n.token[e]);e.m=i.reduce((t,r)=>(t[r.substring(1)]=n.token[r].split("").reduce((t,n)=>(t[n]=e.t[r],t),{}),t),{});let o=r.filter(e=>null!=n.token[e].s);if(e.ts=o.reduce((t,r)=>(t[r.substring(1)]=n.token[r].s.split(",").reduce((t,n)=>(t[e.t[n]]=n,t),{}),t),{}),e.vm=n.value.src,e.vs=t(n.value.src).reduce((e,t)=>(e[t[0]]=!0,e),{}),e.cs={},e.esc=t(n.string.escape).reduce((e,t)=>(e[t]=n.string.escape[t],e),{}),e.cs.cs={},e.cmk=[],n.comment.lex){e.cm=n.comment.marker;let r=t(e.cm);r.forEach(t=>{1===t.length?e.cs.cs[t]=t.charCodeAt(0):(e.cs.cs[t[0]]=t.charCodeAt(0),e.cmk.push(t))}),e.cmx=ee(r)}e.sc=t(e.sm).join(""),e.cs.dig=Q(n.number.digital),e.cs.mln=Q(n.string.multiline),e.cs.vend=Q(n.space.lex&&e.m.SP,n.line.lex&&e.m.LN,e.sc,n.comment.lex&&e.cs.cs,n.block.lex&&e.cs.bs),e.cs.bs={},e.bmk=[];let c=t(n.block.marker);c.forEach(t=>{e.cs.bs[t[0]]=t.charCodeAt(0),e.bmk.push(t)}),e.bmx=ee(c);let a=null!=n.number.sep?new RegExp(n.number.sep,"g"):null;e.re={ns:a,te:ie(Q(n.space.lex&&e.m.SP,n.line.lex&&e.m.LN,e.sc,n.comment.lex&&e.cs.cs,n.block.lex&&e.cs.bs),{...n.comment.lex?e.cm:{},...n.block.lex?n.block.marker:{}}),nm:new RegExp(["^[-+]?(0(",[n.number.hex?"x[0-9a-fA-F_]+":null,n.number.oct?"o[0-7_]+":null,n.number.bin?"b[01_]+":null].filter(e=>null!=e).join("|"),")|[0-9]+([0-9_]*[0-9])?)","(\\.[0-9]+([0-9_]*[0-9])?)?","([eE][-+]?[0-9]+([0-9_]*[0-9])?)?"].filter(e=>e.replace(/_/g,null==a?"":n.number.sep)).join(""))},e.d=n.debug,t(n.config.modify).forEach(t=>n.config.modify[t](e,n)),n.debug.print.config&&n.debug.get_console().dir(e,{depth:null})}function he(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((n,r,s)=>(n[r]=e(t[s]),n),{})}e.exports.util=H,e.exports.make=G;let de=G();e.exports.Jsonic=de;let fe=de;return delete fe.options,delete fe.use,delete fe.rule,delete fe.lex,delete fe.token,de.Jsonic=de,de.JsonicError=$,de.Lexer=U,de.Parser=W,de.Rule=D,de.RuleSpec=Y,de.Alt=J,de.util=H,de.make=G,e.exports.default=de,e.exports=e.exports.Jsonic,e=e.exports}));