!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e,t={};Object.defineProperty(t,"__esModule",{value:!0}),t.make=t.util=t.RuleSpec=t.Rule=t.Parser=t.Lexer=t.JsonicError=t.Jsonic=void 0;class n extends SyntaxError{constructor(e,t,s,r){t=c.deep({},t);let l=c.deep({},{rI:r.rI,opts:r.opts,config:r.config,meta:r.meta,src:()=>r.src(),root:()=>r.root(),node:r.node,t0:r.t0,t1:r.t1,tI:r.tI,next:()=>r.next(),log:r.log,use:r.use}),o=n.make_desc(e,t,s,l);super(o.message),Object.assign(this,o),this.stack&&(this.stack=this.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).join("\n"))}static make_desc(e,t,n,s){n={...n};let r=s.opts,l=s.meta,o=c.errinject(r.error[e]||r.error.unknown,e,t,n,s),i=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+(l&&l.mode?"\x1b[35m[mode:"+l.mode+"]:\x1b[0m ":"")+o,"  \x1b[34m--\x3e\x1b[0m "+(l.fileName||"<no-file>")+":"+n.row+":"+n.col,c.extract(s.src(),o,n),c.errinject((r.hint[e]||r.hint.unknown).split("\n").map(e=>"  "+e).join("\n"),e,t,n,s)].join("\n"),a={internal:{token:n,ctx:s}};return{...Object.create(a),message:i,code:e,details:t,meta:l,fileName:l.fileName,lineNumber:n.row,columnNumber:n.col}}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}t.JsonicError=n;class s{constructor(e){this.match={},c.token("@LS_TOP",e),c.token("@LS_CONSUME",e),c.token("@LS_MULTILINE",e),this.end={pin:c.token("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const t=e.opts,n=e.config;let s=e=>c.token(e,n),r=e=>c.token(e,n),l=e.F,o=s("@LS_TOP"),i=s("@LS_CONSUME"),a=s("@LS_MULTILINE"),u=s("#ZZ"),p=s("#SP"),d=s("#CM"),m=s("#NR"),h=s("#ST"),f=s("#TX"),g=s("#VL");s("#LN");let b={pin:u,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},k=0,_=0,v=0,x=e.src(),y=x.length,w=null!=e&&null!=e.log?(...t)=>e.log("lex",...t):void 0,j=this,N=function(){b.len=0,b.val=void 0,b.src=void 0,b.row=_;let s=o,c=null,N="",S=0,C=[],L=-1;e:for(;k<y;){let u=x[k],O=x.charCodeAt(k);if(o===s){let A=j.match[o];if(null!=A){b.loc=k;for(let t of A){let n=t(k,x,b,e);if(n)return k=n.sI,_=n.rD?_+n.rD:_,v=n.cD?v+n.cD:v,w&&w(r(b.pin),l(b.src),{...b}),b}}if(n.start.SP.includes(O)){for(b.pin=p,b.loc=k,b.col=v++,S=k+1;n.multi.SP.includes(x[S]);)v++,S++;return b.len=S-k,b.val=x.substring(k,S),b.src=b.val,k=S,w&&w(r(b.pin),l(b.src),{...b}),b}if(n.start.LN.includes(O)){for(b.pin=n.lex.core.LN,b.loc=k,b.col=v,S=k,v=0;n.multi.LN.includes(x[S]);)_+=t.char.row===x[S]?1:0,S++;return b.len=S-k,b.val=x.substring(k,S),b.src=b.val,k=S,w&&w(r(b.pin),l(b.src),{...b}),b}if(null!=n.single[O])return b.pin=n.single[O],b.loc=k,b.col=v++,b.len=1,b.src=u,k++,w&&w(r(b.pin),l(b.src),{...b}),b;if(n.start.NR.includes(O)){for(b.pin=m,b.loc=k,b.col=v,S=k;t.number.digital.includes(x[++S]););if((null==x[S]||n.value_ender.includes(x[S]))&&(b.len=S-k,1<b.len&&"0"===x[k]&&"x"!=x[k+1]?(b.val=void 0,S--):(b.val=+x.substring(k,S),t.number.underscore&&isNaN(b.val)&&(b.val=+x.substring(k,S).replace(/_/g,"")),isNaN(b.val)&&(b.val=void 0,S--))),null!=b.val)return b.src=x.substring(k,S),v+=b.len,k=S,w&&w(r(b.pin),l(b.src),{...b}),b}else{if(n.start.ST.includes(O)){b.pin=h,b.loc=k,b.col=v++;let s=u.charCodeAt(0),o=t.string.multiline.includes(u);for(C=[],L=-1,S=k+1;S<y;S++)if(v++,s===(L=x.charCodeAt(S))){if(!t.string.escapedouble||s!==x.charCodeAt(S+1)){S++;break}C.push(x[S]),S++}else if(92===L){let s=x.charCodeAt(++S);v++;let r=n.escape[s];if(null!=r)C.push(r);else if(117===s){S++;let n=String.fromCharCode("0x"+x.substring(S,S+4));if(t.char.bad_unicode===n)return j.bad(e,w,"invalid-unicode",b,k,S,_,v,x.substring(S-2,S+4));C.push(n),S+=3,v+=4}else C.push(x[S])}else if(L<32){if(!o||!n.start.LN.includes(L))return j.bad(e,w,"unprintable",b,k,S,_,v,x.charAt(S));C.push(x[S])}else{let e=S;do{L=x.charCodeAt(++S),v++}while(32<=L&&s!==L&&92!==L);v--,C.push(x.substring(e,S)),S--}return s!==L?(v=k,j.bad(e,w,"unterminated",b,k,S-1,_,v,C.join(""))):(b.val=C.join(""),b.src=x.substring(k,S),b.len=S-k,k=S,w&&w(r(b.pin),l(b.src),{...b}),b)}if(n.start_cm.includes(O)){let e=n.cm_single.includes(u),r=x.substring(k,k+n.cmk_maxlen);for(let l of n.cmk)if(r.startsWith(l)){if(!0!==t.comment[l]){b.pin=d,b.loc=k,b.col=v,b.val="",s=a,c=[l,t.comment[l],"comment"];continue e}e=!0;break}if(e){b.pin=d,b.loc=k,b.col=v,b.val="",s=i,N=n.multi.LN;continue e}}}b.loc=k,b.col=v,S=k;do{v++,S++}while(null!=x[S]&&!n.value_ender.includes(x[S]));let I=x.substring(k,S),P=t.value[I];if(void 0!==P)return b.pin=g,b.val=P,b.src=I,b.len=S-k,k=S,w&&w(r(b.pin),l(b.src),{...b}),b;let E=t.text.hoover?n.hoover_ender:n.text_ender;for(;null!=x[S]&&(!E.includes(x[S])||n.cmk0.includes(x[S])&&!n.cmk1.includes(x[S+1]));)v++,S++;if(b.len=S-k,b.pin=f,b.val=x.substring(k,S),b.src=b.val,t.text.hoover&&n.multi.SP.includes(b.val[b.val.length-1])){let e=b.val.length-2;for(;0<e&&n.multi.SP.includes(b.val[e]);)e--;b.val=b.val.substring(0,e+1),b.src=b.val,v-=b.len-e-1,b.len=b.val.length,k+=b.len}else k=S;return w&&w(r(b.pin),l(b.src),{...b}),b}if(i===s){for(S=k;S<y&&!N.includes(x[S]);)S++,v++;return b.val+=x.substring(k,S),b.src=b.val,b.len=b.val.length,k=S,s=o,w&&w(r(b.pin),l(b.src),{...b}),b}if(a===s){S=k;let e=1,n=c[0],i=c[1],a=t.balance[c[2]],u=n.length,p=i.length;for(S+=n.length;S<y&&0<e;)i[0]===x[S]&&i===x.substring(S,S+p)?(S+=p,v+=p,e--):a&&n[0]===x[S]&&n===x.substring(S,S+u)?(S+=u,v+=p,e++):(t.char.row===x[S]?(_++,v=0):v++,S++);return b.val=x.substring(k,S),b.src=b.val,b.len=b.val.length,k=S,s=o,w&&w(r(b.pin),l(b.src),{...b}),b}}return b.pin=u,b.loc=y,b.col=v,w&&w(r(b.pin),l(b.src),{...b}),b};return N.src=x,N}bad(e,t,n,s,r,l,o,i,a,u,p){return s.why=n,s.pin=c.token("#BD",e.config),s.loc=l,s.row=o,s.col=i,s.len=l-r+1,s.val=a,s.src=u,s.use=p,t&&t(c.token(s.pin,e.config),e.F(s.src),n,{...s}),s}lex(e,t){return null==e?this.match:(this.match[e]=this.match[e]||[],null!=t&&this.match[e].push(t),this.match[e])}clone(e){let t=new s(e);return c.deep(t.match,this.match),t}}t.Lexer=s,function(e){e[e.open=0]="open",e[e.close=1]="close"}(e||(e={}));class r{constructor(t,n,s){this.id=n.rI++,this.name=t.name,this.spec=t,this.node=s,this.state=e.open,this.child=l,this.open=[],this.close=[]}process(t){let n=l;return e.open===this.state?n=this.spec.open(this,t):e.close===this.state&&(n=this.spec.close(this,t)),n}}t.Rule=r;let l={id:0,spec:{name:"norule"}};class o{constructor(e,t){this.name=e,this.def=t}open(t,s){let l=t,o="",i=s.F;if(this.def.before_open){let e=this.def.before_open.call(this,t,s);t.node=e&&e.node||t.node}let c=this.parse_alts(this.def.open,t,s);if(c.e)throw new n("unexpected",{open:!0},c.e,s);return t.open=c.m,c.p?(s.rs.push(t),(l=t.child=new r(s.rsm[c.p],s,t.node)).parent=t,o+="U"):c.r?((l=new r(s.rsm[c.r],s,t.node)).parent=t.parent,o+="R"):o+="Z",this.def.after_open&&this.def.after_open.call(this,t,s,l),s.log&&s.log("node",t.name+"/"+t.id,e[t.state],o,i(t.node)),t.state=e.close,l}close(t,s){let o=l,i="";this.def.before_close&&this.def.before_close.call(this,t,s);let c=0<this.def.close.length?this.parse_alts(this.def.close,t,s):{};if(c.e)throw new n("unexpected",{close:!0},c.e,s);return c.h&&(o=c.h(this,t,s)||o,i+="H"),c.p?(s.rs.push(t),(o=t.child=new r(s.rsm[c.p],s,t.node)).parent=t,i+="U"):c.r?((o=new r(s.rsm[c.r],s,t.node)).parent=t.parent,i+="R"):(o=s.rs.pop()||l,i+="O"),this.def.after_close&&this.def.after_close.call(this,t,s,o),o.why=i,s.log&&s.log("node",t.name+"/"+t.id,e[t.state],i,s.F(t.node)),o}parse_alts(t,n,s){let r,l=void 0,o=0,i=s.config.token;if(i.ZZ===s.t0.pin)l={m:[]};else if(0<t.length){for(o=0;o<t.length;o++)if(!(r=t[o]).c||r.c(r,n,s)){if(null==r.s||0===r.s.length){l={...r,m:[]};break}if(r.s[0]===s.t0.pin){if(1===r.s.length){l={...r,m:[s.t0]};break}if(r.s[1]===s.t1.pin){l={...r,m:[s.t0,s.t1]};break}}else if(i.AA===r.s[0]){l={...r,m:[s.t0]};break}}l=l||{e:s.t0,m:[]}}if(l=l||{m:[]},s.log&&s.log("parse",n.name+"/"+n.id,e[n.state],o<t.length?"alt="+o:"no-alt",o<t.length&&r&&r.s?"["+r.s.map(e=>i[e]).join(" ")+"]":"[]",s.tI,"p="+(l.p||""),"r="+(l.r||""),"b="+(l.b||""),l.m.map(e=>i[e.pin]).join(" "),s.F(l.m.map(e=>e.src)),l),l.m){let e=0,t=l.m.length-(l.b||0);for(;e++<t;)s.next()}return l}}t.RuleSpec=o;class i{constructor(e,t){this.rsm={},this.opts=e,this.config=t}init(){let e=this.config.token,t=e.OB,n=e.CB,s=e.OS,r=e.CS,l=e.CL,i=e.CA,a=e.TX,u=e.NR,p=e.ST,d=e.VL,m=e.AA,h={val:{open:[{s:[t,i],p:"map"},{s:[t],p:"map"},{s:[s],p:"list"},{s:[i],p:"list",b:1},{s:[a,l],p:"map",b:2},{s:[p,l],p:"map",b:2},{s:[u,l],p:"map",b:2},{s:[d,l],p:"map",b:2},{s:[a]},{s:[u]},{s:[p]},{s:[d]}],close:[{s:[i],c:(e,t,n)=>0===n.rs.length,r:"elem",h:(e,t,n)=>{t.node=[t.node]}},{s:[m],b:1}],before_close:e=>{var t,n;e.node=null!==(t=e.child.node)&&void 0!==t?t:null===(n=e.open[0])||void 0===n?void 0:n.val}},map:{before_open:()=>({node:{}}),open:[{s:[n]},{p:"pair"}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[r]},{p:"elem"}],close:[]},pair:{open:[{s:[p,l],p:"val"},{s:[a,l],p:"val"},{s:[u,l],p:"val"},{s:[d,l],p:"val"},{s:[n],b:1}],close:[{s:[n]},{s:[i],r:"pair"},{s:[p,l],r:"pair",b:2},{s:[a,l],r:"pair",b:2},{s:[u,l],r:"pair",b:2},{s:[d,l],r:"pair",b:2}],before_close:(e,t)=>{let s=e.open[0];if(s&&n!==s.pin){let n=p===s.pin?s.val:s.src,r=e.node[n];e.node[n]=null==r?e.child.node:t.opts.object.extend?c.deep(r,e.child.node):e.child.node}}},elem:{open:[{s:[t],p:"map"},{s:[s],p:"list"},{s:[a]},{s:[u]},{s:[p]},{s:[d]},{s:[i,i],b:2},{s:[i]}],close:[{s:[i,r]},{s:[i],r:"elem"},{s:[r]},{s:[t],p:"map"},{s:[s],p:"list"},{s:[a,l],p:"map",b:2},{s:[u,l],p:"map",b:2},{s:[p,l],p:"map",b:2},{s:[d,l],p:"map",b:2},{s:[a],r:"elem",b:1},{s:[u],r:"elem",b:1},{s:[p],r:"elem",b:1},{s:[d],r:"elem",b:1}],after_open:(e,t,n)=>{if(e===n&&e.open[0]){let t=e.open[0].val;e.node.push(null!=t?t:null)}},before_close:e=>{e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(h).reduce((e,t)=>(e[t]=new o(t,h[t]),e),{})}rule(e,t){return this.rsm[e]=null==t?this.rsm[e]:t(this.rsm[e],this.rsm)||this.rsm[e],this.rsm[e]}start(t,n,s,o){let i,a=this.opts,u=this.config,p={rI:1,opts:a,config:u,meta:s||{},src:()=>n,root:()=>i.node,node:void 0,t0:t.end,t1:t.end,tI:-2,next:g,rs:[],rsm:this.rsm,log:s&&s.log||void 0,F:c.make_src_format(u),use:{}};null!=o&&(p=c.deep(p,o)),c.make_log(p);let d=e=>c.token(e,this.config),m=t.start(p),h=new r(this.rsm.val,p);i=h;let f=2*Object.keys(this.rsm).length*m.src.length*2*a.rule.maxmul;function g(){let e;p.t0=p.t1;do{e=m(),p.tI++}while(u.tokenset.IGNORE.includes(e.pin));return p.t1={...e},p.t0}g(),g();let b=0;for(;l!==h&&b<f;)p.log&&p.log("rule",h.name+"/"+h.id,e[h.state],p.rs.length,p.tI,"["+d(p.t0.pin)+" "+d(p.t1.pin)+"]","["+p.F(p.t0.src)+" "+p.F(p.t1.src)+"]",h,p),h=h.process(p),p.log&&p.log("stack",p.rs.length,p.rs.map(e=>e.name+"/"+e.id).join(";"),h,p),b++;return i.node}clone(e,t){let n=new i(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=c.clone(this.rsm[t]),e),{}),n}}t.Parser=i;let c={token:function(e,t,n){let s=t.token,r=s[e];return null==r&&"string"==typeof e&&(r=t.tokenI++,s[r]=e,s[e]=r,s[e.substring(1)]=r,null!=n&&Object.assign(n.token,t.token)),r},deep:function(e,...t){let n="function"==typeof e,s=null!=e&&("object"==typeof e||n);for(let r of t){let t="function"==typeof r,l=null!=r&&("object"==typeof r||t);if(s&&l&&!t&&Array.isArray(e)===Array.isArray(r))for(let n in r)e[n]=c.deep(e[n],r[n]);else n="function"==typeof(e=void 0===r?e:t?r:l?c.deep(Array.isArray(r)?[]:{},r):r),s=null!=e&&("object"==typeof e||n)}return e},clone:function(e){return c.deep(Object.create(Object.getPrototypeOf(e)),e)},s2cca:function(e){return e.split("").map(e=>e.charCodeAt(0))},longest:e=>e.reduce((e,t)=>e<t.length?t.length:e,0),make_src_format:e=>(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.debug.maxlen)+(e.debug.maxlen<n.length?"...":""),make_log:e=>{if("number"==typeof e.log){let t=!1,n=e.log;-1===n&&(n=1,t=!0),e.log=(...s)=>{if(t){let t=s.filter(e=>"object"!=typeof e).join("\t");e.opts.debug.get_console().log(t)}else e.opts.debug.get_console().dir(s,{depth:n})}}},errinject:(e,t,n,s,r)=>e.replace(/\$([\w_]+)/g,(e,l)=>"code"===l?t:n[l]||r.meta[l]||s[l]||r[l]||r.opts[l]||"$"+l),extract:(e,t,n)=>{let s=0<n.loc?n.loc:0,r=0<n.row?n.row:0,l=0<n.col?n.col:0,o=null==n.src?"":n.src,i=e.substring(Math.max(0,s-333),s).split("\n"),c=e.substring(s,s+333).split("\n"),a=2+(""+(r+2)).length,u=r<2?0:r-2,p=e=>"\x1b[34m"+(""+u++).padStart(a," ")+" | \x1b[0m"+(null==e?"":e),d=i.length;return[2<d?p(i[d-3]):null,1<d?p(i[d-2]):null,p(i[d-1]+c[0])," ".repeat(a)+"   "+" ".repeat(l)+"\x1b[31m"+"^".repeat(o.length||1)+" "+t+"\x1b[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")},handle_meta_mode:(e,t,s)=>{let r=e.options;if("function"!=typeof r.mode[s.mode])return[!1];try{return r.mode[s.mode].call(e,t,s)}catch(l){if("SyntaxError"===l.name){let o=0,i=0,a=0,u="",p=l.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(p){u=p[1],o=parseInt(p[2]),i=t.substring(0,o).replace(/[^\n]/g,"").length;let e=o-1;for(;-1<e&&"\n"!==t.charAt(e);)e--;a=e<o?t.substring(e,o).length-1:0}let d=l.token||{pin:e.token.UK,loc:o,len:u.length,row:l.lineNumber||i,col:l.columnNumber||a,val:void 0,src:u};throw new n(l.code||"json",l.details||{msg:l.message},d,l.ctx||{rI:-1,opts:r,config:{},token:{},meta:s,src:()=>t,root:()=>{},node:void 0,t0:d,t1:d,tI:-1,rs:[],next:()=>d,rsm:{},log:s.log,F:c.make_src_format(e.internal().config),use:{}})}throw l}},build_config_from_options:function(e,t){let n=Object.keys(t.token);n.forEach(t=>c.token(t,e));let s=n.filter(e=>null!=t.token[e].c);e.single=s.reduce((n,s)=>{return n[(r=t.token[s].c,r.charCodeAt(0))]=e.token[s],n;var r},[]);let r=n.filter(e=>"string"==typeof t.token[e]);e.start=r.reduce((e,n)=>(e[n.substring(1)]=c.s2cca(t.token[n]),e),{}),e.multi=r.reduce((e,n)=>(e[n.substring(1)]=t.token[n],e),{});let l=n.filter(e=>null!=t.token[e].s);if(e.tokenset=l.reduce((n,s)=>(n[s.substring(1)]=t.token[s].s.split(",").map(t=>e.token[t]),n),{}),t.escape=t.escape||{},e.escape=Object.keys(t.escape).reduce((e,n)=>(e[n.charCodeAt(0)]=t.escape[n],e),[]),e.start_cm=[],e.cm_single="",e.cmk=[],e.cmk0="",e.cmk1="",t.comment){let n=Object.keys(t.comment);n.forEach(t=>{1===t.length?(e.start_cm.push(t.charCodeAt(0)),e.cm_single+=t):(e.start_cm.push(t.charCodeAt(0)),e.cmk.push(t),e.cmk0+=t[0],e.cmk1+=t[1])}),e.cmk_maxlen=c.longest(n)}e.start_cm_char=e.start_cm.map(e=>String.fromCharCode(e)).join(""),e.single_char=e.single.map((e,t)=>String.fromCharCode(t)).join(""),e.value_ender=e.multi.SP+e.multi.LN+e.single_char+e.start_cm_char,e.text_ender=e.value_ender,e.hoover_ender=e.multi.LN+e.single_char+e.start_cm_char,e.lex={core:{LN:c.token(t.lex.core.LN,e)}},e.debug=t.debug}};function a(e,t){let n,r=e;"function"==typeof e&&(r={},t=e);let l,o,u=c.deep({},t?{...t.options}:{escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},char:{row:"\n",bad_unicode:String.fromCharCode("0x0000")},comment:{"#":!0,"//":!0,"/*":"*/"},balance:{comment:!0},number:{digital:"-1023456789._xeEaAbBcCdDfF+",underscore:!0},string:{multiline:"`",escapedouble:!1},text:{hoover:!0},object:{extend:!0},value:{null:null,true:!0,false:!1},mode:{},plugin:{},debug:{get_console:()=>console,maxlen:33},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): `$src`"},hint:{unknown:"Since the error is unknown, this is probably a bug inside jsonic itself.\nPlease consider posting a github issue - thanks!\n",unexpected:"The character(s) `$src` should not occur at this point as it is not\nvalid JSON syntax, even under the relaxed jsonic rules.  If it is not\nobviously wrong, the actual syntax error may be elsewhere. Try\ncommenting out larger areas around this point until you get no errors,\nthen remove the comments in small sections until you find the\noffending syntax."},token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},lex:{core:{LN:"#LN"}},rule:{maxmul:3}},r),p=function(e,t,n){if("string"==typeof e){let s=p.internal(),[r,l]=null!=t&&null!=t.mode?c.handle_meta_mode(p,e,t):[!1];return r||(l=s.parser.start(s.lexer,e,t,n)),l}return e};if(p.token=function(e){return c.token(e,n,p)},t){for(let n in t)p[n]=t[n];p.parent=t;let e=t.internal();n=c.deep({},e.config),c.build_config_from_options(n,u),Object.assign(p.token,n.token),l=e.lexer.clone(n),o=e.parser.clone(u,n)}else n={tokenI:1,token:{}},c.build_config_from_options(n,u),l=new s(n),(o=new i(u,n)).init();return Object.assign(p.token,n.token),p.internal=()=>({lexer:l,parser:o,config:n}),p.options=c.deep(e=>{if(null!=e&&"object"==typeof e){c.build_config_from_options(n,c.deep(u,e));for(let e in u)p.options[e]=u[e]}return p},u),p.parse=p,p.use=function(e,t){return p.options({plugin:{[e.name]:t||{}}}),e(p)||p},p.rule=function(e,t){let n=p.internal().parser.rule(e,t);return null==t?n:p},p.lex=function(e,t){let n=p.internal().lexer.lex(e,t);return null==t?n:p},p.make=function(e){return a(e,p)},Object.defineProperty(p.make,"name",{value:"make"}),p}t.util=c,t.make=a;let u=a();return t.Jsonic=u,t}));