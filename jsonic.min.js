!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const t="object",n="string",r="function",s="unexpected",o="map",l="list",i="elem",a="pair",c="val",u="node",p="",m="unprintable",h="invalid_ascii",d="invalid_unicode",f="invalid_lex_state",g="unterminated",b="lex",k="parse",_="block_indent_",v="error",x="none",y="END_OF_SOURCE",w="imp,map",S="imp,list",C="imp,null",j="end",N="open",I="close";class A extends SyntaxError{constructor(e,t,n,r,s){t=$.deep({},t);let o=$.deep({},{rI:s.rI,options:s.options,config:s.config,meta:s.meta,src:()=>s.src(),plugins:()=>s.plugins(),node:s.node,t0:s.t0,t1:s.t1,tI:s.tI,log:s.log,use:s.use}),l=$.make_error_desc(e,t,n,r,o);super(l.message),Object.assign(this,l),$.clean_stack(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=A;class O{constructor(e){this.match={},$.token("@LTP",e),$.token("@LTX",e),$.token("@LCS",e),$.token("@LML",e),this.end={tin:$.token("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const t=e.options,n=e.config;let r=e=>$.token(e,n),o=e=>$.token(e,n),l=e.F,i=r("@LTP"),a=r("@LTX"),c=r("@LCS"),u=r("@LML"),k=r("#ZZ"),v=r("#SP"),x=r("#CM"),y=r("#NR"),w=r("#ST"),S=r("#TX"),C=r("#VL"),j=r("#LN"),N={tin:k,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},I=0,A=0,O=0,E=i,T=null,L=e.src(),P=L.length,R=null!=e.log?(...t)=>e.log(b,o(N.tin),l(N.src),I,A+":"+O,o(E),{...N},...t):void 0,M=this;function J(t,n,r,s){return M.bad(e,R,t,N,I,n,A,O,r,r,s)}function U(t){let n=M.match[E];if(null!=n){N.loc=I;for(let r of n){let n=r({sI:I,rI:A,cI:O,src:L,token:N,ctx:e,rule:t,bad:J});if(n)return I=n.sI?n.sI:I,A=n.rI?n.rI:A,O=n.cI?n.cI:O,E=null==n.state?E:n.state,T=null==n.state_param?T:n.state_param,R&&R(N,r),N}}}let B=function(r){N.len=0,N.val=void 0,N.src=void 0,N.row=A,N.use=void 0;let o={},l=0,b=[];e:for(;I<P;){let k=L[I];if(e.lex=E,i!==E){if(a===E){if(U(r))return N;let e=t.text.hoover?n.charset.hoover_ender:n.charset.text_ender;for(;null!=L[l]&&(!e[L[l]]||n.cmk0.includes(L[l])&&!n.cmk1.includes(L[l+1]));)O++,l++;if(N.len=l-I,N.tin=S,N.val=L.substring(I,l),N.src=N.val,t.text.hoover&&n.multi.SP[N.val[N.val.length-1]]){let e=N.val.length-2;for(;0<e&&n.multi.SP[N.val[e]];)e--;N.val=N.val.substring(0,e+1),N.src=N.val,O-=N.len-e-1,N.len=N.val.length,I+=N.len}else I=l;return E=i,R&&R(N),N}if(c===E){if(U(r))return N;for(l=I;l<P&&!o[L[l]];)l++,O++;return N.val+=L.substring(I,l),N.src=N.val,N.len=N.val.length,I=l,E=i,R&&R(N),N}if(u===E){if(U(r))return N;l=I;let e=1,s=T[0],o=T[1],a=T[2],c=!!T[3],u="",m=0,h=s.length,d=o.length;if(c){let e=I-1;for(;-1<e&&n.multi.SP[L[e]];)e--;0<(m=I-e-1)&&(u=Object.keys(n.multi.SP)[0].repeat(m))}for(l+=s.length;l<P&&0<e;)o[0]===L[l]&&o===L.substring(l,l+d)?(l+=d,O+=d,e--):a&&s[0]===L[l]&&s===L.substring(l,l+h)?(l+=h,O+=d,e++):(t.line.row===L[l]?(A++,O=0):O++,l++);if(N.val=L.substring(I,l),N.src=N.val,N.len=N.val.length,c){N.val=N.val.substring(h,N.val.length-d),null==n.re.block_prefix&&(n.re.block_prefix=$.regexp(p,"^[","%"+t.token["#SP"],"]*","(",t.line.sep_RES,")")),N.val=N.val.replace(n.re.block_prefix,""),null==n.re.block_suffix&&(n.re.block_suffix=$.regexp(p,t.line.sep_RES,"[","%"+t.token["#SP"],"]*$")),N.val=N.val.replace(n.re.block_suffix,"");let e=n.re[_+u]=n.re[_+u]||$.regexp("g","^(","%"+u,")|(","(",t.line.sep_RES,")","%"+u,")");N.val=N.val.replace(e,"$3")}return I=l,E=i,R&&R(N),N}return J(f,I,L[I],{state:E})}{if(U(r))return N;if(t.space.lex&&n.start.SP[k]){for(N.tin=v,N.loc=I,N.col=O++,l=I+1;n.multi.SP[L[l]];)O++,l++;return N.len=l-I,N.val=L.substring(I,l),N.src=N.val,I=l,R&&R(N),N}if(t.line.lex&&n.start.LN[k]){for(N.tin=j,N.loc=I,N.col=O,l=I,O=0;n.multi.LN[L[l]];)A+=t.line.row===L[l]?1:0,l++;return N.len=l-I,N.val=L.substring(I,l),N.src=N.val,I=l,R&&R(N),N}if(null!=n.singlemap[k])return N.tin=n.singlemap[k],N.loc=I,N.col=O++,N.len=1,N.src=k,I++,R&&R(N),N;if(t.number.lex&&n.start.NR[k]){for(N.tin=y,N.loc=I,N.col=O,l=I;n.charset.digital[L[++l]];);let e=L.substring(I,l);if(null==L[l]||n.charset.value_ender[L[l]]){N.len=l-I;let r=L[I+1];!(1<N.len&&"0"===L[I]&&"."!==L[I+1])||t.number.hex&&"x"===r||t.number.oct&&"o"===r||t.number.bin&&"b"===r?(N.val=+e,null!=n.number.sep_RE&&isNaN(N.val)&&(N.val=+e.replace(n.number.sep_RE,"")),isNaN(N.val)&&(N.val=void 0,l--)):(N.val=void 0,l--)}if(null!=N.val)return N.src=e,O+=N.len,I=l,R&&R(N),N}if(t.block.lex&&n.charset.start_blockmarker[k]){let e=L.substring(I,I+n.bmk_maxlen);for(let r of n.bmk)if(e.startsWith(r)){N.tin=w,N.loc=I,N.col=O,E=u,T=[r,t.string.block[r],null,!0];continue e}}if(t.string.lex&&n.start.ST[k]){N.tin=w,N.loc=I,N.col=O++;let e=n.charset.multiline[k];b=[];let r="";for(l=I+1;l<P;l++)if(O++,k===(r=L[l])){if(!t.string.escapedouble||k!==L[l+1]){l++;break}b.push(L[l]),l++}else if("\\"===r){l++,O++;let e=n.string.escape[L[l]];if(null!=e)b.push(e);else if("x"===L[l]){l++;let e=parseInt(L.substring(l,l+2),16);if(isNaN(e))return I=l-2,O-=2,J(h,l+2,L.substring(l-2,l+2));let t=String.fromCharCode(e);b.push(t),l+=1,O+=2}else if("u"===L[l]){let e="{"===L[++l]?(l++,1):0,t=e?6:4,n=parseInt(L.substring(l,l+t),16);if(isNaN(n))return I=l-2-e,O-=2,J(d,l+t+1,L.substring(l-2-e,l+t+e));let r=String.fromCodePoint(n);b.push(r),l+=t-1+e,O+=t+e}else b.push(L[l])}else{let s=l,o=k.charCodeAt(0),i="\\".charCodeAt(0),a=L.charCodeAt(l);for(;l<P&&32<=a&&o!==a&&i!==a;)a=L.charCodeAt(++l),O++;if(O--,r=L[l],a<32){if(!e||!n.start.LN[r])return J(m,l,"char-code="+L[l].charCodeAt(0));r===t.line.row&&(A++,O=0),b.push(L.substring(s,l+1))}else b.push(L.substring(s,l)),l--}return k!==r?J(g,l,b.join("")):(N.val=b.join(""),N.src=L.substring(I,l),N.len=l-I,I=l,R&&R(N),N)}if(t.comment.lex&&n.charset.start_commentmarker[k]){let e=L.substring(I,I+n.cmk_maxlen);for(let r of n.cmk)if(e.startsWith(r)){if(!0!==n.comment[r]){N.tin=x,N.loc=I,N.col=O,N.val="",E=u,T=[r,n.comment[r],t.comment.balance];continue e}break}N.tin=x,N.loc=I,N.col=O,N.val="",E=c,o=n.multi.LN;continue e}N.loc=I,N.col=O,l=I;do{O++,l++}while(null!=L[l]&&!n.charset.value_ender[L[l]]);let e=L.substring(I,l),s=t.value[e];if(t.text.lex_value&&void 0!==s)return N.tin=C,N.val=s,N.src=e,N.len=l-I,I=l,R&&R(N),N;if(t.text.lex){E=a;continue e}}return J(s,I,L[I])}return N.tin=k,N.loc=P,N.col=O,R&&R(N),N};return B.src=L,B}bad(e,t,n,r,s,o,l,i,a,c,u){return r.why=n,r.tin=$.token("#BD",e.config),r.loc=s,r.row=l,r.col=i,r.len=o-s,r.val=a,r.src=c,r.use=u,t&&t($.token(r.tin,e.config),e.F(r.src),s,l+":"+i,{...r},v,n),r}lex(e,t){if(null==e)return this.match;let n=this.match[e];return null!=t?(null==n&&(n=this.match[e]=[]),n.push(t)):null===t&&(n=this.match[e],delete this.match[e]),n}clone(e){let t=new O(e);return $.deep(t.match,this.match),t}}var E;e.exports.Lexer=O,function(e){e[e.open=0]="open",e[e.close=1]="close"}(E||(E={}));class T{constructor(e,t,n){this.id=t.rI++,this.name=e.name,this.spec=e,this.node=n,this.state=E.open,this.child=L,this.open=[],this.close=[],this.n={},this.before_open_active=!1!==e.before_open_active,this.after_open_active=!1!==e.after_open_active,this.before_close_active=!1!==e.before_close_active,this.after_close_active=!1!==e.after_close_active}process(e){return this.spec.process(this,e,this.state)}}e.exports.Rule=T;const L={name:x,state:0};class P{constructor(){this.m=[],this.p="",this.r="",this.b=0,this.n=null,this.h=null}}const R=new P,M=new P;class J{constructor(e){function t(e){if(null!=e.c&&e.c.n){let t=e.c.n;e.c=(e,n,r)=>{let s=!0;for(let o in t)s=s&&(null==n.n[o]||n.n[o]<=t[o]);return s}}n===typeof e.g&&(e.g=e.g.split(/\s*,\s*/))}this.name="-",this.before_open_active=!0,this.after_open_active=!0,this.before_close_active=!0,this.after_close_active=!0,this.def=e,this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let n of[...this.def.open,...this.def.close])t(n)}process(e,t,n){let r,o="",l=t.F,i=n===E.open,a=i?e:L,c=this.def,p=i?c.open:c.close,m=i?e.before_open_active&&c.before_open:e.before_close_active&&c.before_close;if(m&&(r=m.call(this,e,t))){if(r.err)throw new A(r.err,{...r,state:i?N:I},t.t0,e,t);e.node=r.node||e.node}let h=r&&r.alt?{...M,...r.alt}:0<p.length?this.parse_alts(p,e,t):M;if(h.h&&(h=h.h(h,e,t,a)||h,o+="H"),i?e.open=h.m:e.close=h.m,h.e)throw new A(s,{...h.e.use,state:i?N:I},h.e,e,t);if(h.n)for(let s in h.n)e.n[s]=0===h.n[s]?0:(null==e.n[s]?0:e.n[s])+h.n[s],e.n[s]=0<e.n[s]?e.n[s]:0;h.p?(t.rs.push(e),(a=e.child=new T(t.rsm[h.p],t,e.node)).parent=e,a.n={...e.n},o+="U"):h.r?((a=new T(t.rsm[h.r],t,e.node)).parent=e.parent,a.n={...e.n},o+="R"):(i||(a=t.rs.pop()||L),o+="Z");let d=i?e.after_open_active&&c.after_open:e.after_close_active&&c.after_close;if(d){let n=d.call(this,e,t,a);if(n){if(n.err)throw t.t0.why=o,new A(n.err,{...n,state:i?N:I},t.t0,e,t);a=n.next||a}}a.why=o,t.log&&t.log(u,e.name+"/"+e.id,E[e.state],"w="+o,l(e.node));let f=0,g=h.m.length-(h.b||0);for(;f++<g;)t.next();return E.open===e.state&&(e.state=E.close),a}parse_alts(e,t,n){let r,s=R;s.m=[],s.b=0,s.p="",s.r="",s.n=void 0,s.h=void 0,s.e=void 0;let o,l=0,i=n.config.token;for(l=0;l<e.length;l++){if(o=(o=!(!(o=!(r=e[l]).c||r.c(r,t,n))||null!=r.d)||r.d===n.rs.length)&&(null==r.a||$.marr(r.a,n.rs.slice(-r.a.length).map(e=>e.name).reverse()))){if(s.e=r.e&&r.e(r,t,n)||void 0,null==r.s||0===r.s.length)break;if(r.s[0]===n.t0.tin||r.s[0]===i.AA){if(1===r.s.length){s.m=[n.t0];break}if(r.s[1]===n.t1.tin||r.s[1]===i.AA){s.m=[n.t0,n.t1];break}}}r=null}return null==r&&i.ZZ!==n.t0.tin&&(s.e=n.t0),null!=r&&(s.b=r.b?r.b:s.b,s.p=r.p?r.p:s.p,s.r=r.r?r.r:s.r,s.n=r.n?r.n:s.n,s.h=r.h?r.h:s.h),n.log&&n.log(k,t.name+"/"+t.id,E[t.state],l<e.length?"alt="+l:"no-alt",l<e.length&&r.s?"["+r.s.map(e=>i[e]).join(" ")+"]":"[]",n.tI,"p="+(s.p||""),"r="+(s.r||""),"b="+(s.b||""),s.m.map(e=>i[e.tin]).join(" "),n.F(s.m.map(e=>e.src)),"c:"+(r&&r.c?o:""),"n:"+Object.entries(t.n).join(";"),s),s}}e.exports.RuleSpec=J;class U{constructor(e,t){this.rsm={},this.options=e,this.config=t}init(){let e=this.config.token,t=e.OB,n=e.CB,r=e.OS,s=e.CS,u=e.CL,p=e.CA,m=e.TX,h=e.NR,d=e.ST,f=e.VL,g=e.AA,b=e.ZZ,k=(e,t,n)=>{if(!this.options.rule.finish)return n.t0.src=y,n.t0},_={val:{open:[{s:[t,p],p:o,n:{im:0},g:w},{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[p],d:0,p:l,b:1,g:S},{s:[p],b:1,g:S},{s:[m,u],p:o,b:2,n:{im:1},g:w},{s:[d,u],p:o,b:2,n:{im:1},g:w},{s:[h,u],p:o,b:2,n:{im:1},g:w},{s:[f,u],p:o,b:2,n:{im:1},g:w},{s:[m]},{s:[h]},{s:[d]},{s:[f]},{s:[n],a:[a],b:1,g:C},{s:[s],a:[a],b:1,g:C}],close:[{s:[p],d:0,r:i,h:(e,t,n)=>{t.node=[t.node]},g:S},{c:(e,t,n)=>(m===n.t0.tin||h===n.t0.tin||d===n.t0.tin||f===n.t0.tin)&&0===n.rs.length,r:i,h:(e,t,n)=>{t.node=[t.node]},g:S},{s:[g],b:1}],before_close:e=>{e.node=void 0===e.child.node?null==e.open[0]?void 0:e.open[0].val:e.child.node}},map:{before_open:()=>({node:{}}),open:[{s:[n]},{p:a}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[s]},{p:i}],close:[]},pair:{open:[{s:[d,u],p:c},{s:[m,u],p:c},{s:[h,u],p:c},{s:[f,u],p:c},{s:[n],b:1}],close:[{s:[n]},{s:[p],c:{n:{im:1}},r:a},{s:[p],n:{im:-1},b:1},{s:[d,u],c:{n:{im:1}},r:a,b:2},{s:[m,u],c:{n:{im:1}},r:a,b:2},{s:[h,u],c:{n:{im:1}},r:a,b:2},{s:[f,u],c:{n:{im:1}},r:a,b:2},{s:[d,u],n:{im:-1},b:2},{s:[m,u],n:{im:-1},b:2},{s:[h,u],n:{im:-1},b:2},{s:[f,u],n:{im:-1},b:2},{s:[s],a:[o,c,i],b:1},{s:[b],e:k,g:j}],before_close:(e,t)=>{let r=e.open[0];if(r&&n!==r.tin){let n=d===r.tin?r.val:r.src,s=e.child.node,o=e.node[n];void 0===s&&u===t.u1.tin&&(s=null),e.node[n]=null==o?s:t.options.map.extend?$.deep(o,s):s}}},elem:{open:[{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[p,p],b:2,g:"null"},{s:[p],g:"null"},{p:c,n:{im:1}}],close:[{s:[p,s]},{s:[p],r:i},{s:[s]},{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[m,u],p:o,n:{im:0},b:2},{s:[h,u],p:o,n:{im:0},b:2},{s:[d,u],p:o,n:{im:0},b:2},{s:[f,u],p:o,n:{im:0},b:2},{s:[m],r:i,b:1},{s:[h],r:i,b:1},{s:[d],r:i,b:1},{s:[f],r:i,b:1},{s:[b],e:k,g:j}],after_open:(e,t,n)=>{e===n&&e.node.push(null)},before_close:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(_).reduce((e,t)=>(e[t]=new J(_[t]),e[t].name=t,e),{})}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];return null===t?delete this.rsm[e]:void 0!==t&&((n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e),n}start(e,t,n,r,o){let l,i=this.options,a=this.config,c={rI:1,options:i,config:a,meta:r||{},src:()=>t,root:()=>l.node,plugins:()=>n.internal().plugins,rule:L,node:void 0,lex:-1,u2:e.end,u1:e.end,t0:e.end,t1:e.end,tI:-2,next:f,rs:[],rsm:this.rsm,log:r&&r.log||void 0,F:$.make_src_format(a),use:{}};null!=o&&(c=$.deep(c,o)),$.make_log(c);let u=e=>$.token(e,this.config),p=$.wrap_bad_lex(e.start(c),$.token("#BD",this.config),c),m=this.rsm[i.rule.start];if(null==m)return;let h=new T(m,c);l=h;let d=2*Object.keys(this.rsm).length*p.src.length*2*i.rule.maxmul;function f(){let e;c.u2=c.u1,c.u1=c.t0,c.t0=c.t1;do{e=p(h),c.tI++}while(a.tokenset.IGNORE[e.tin]);return c.t1={...e},c.t0}f(),f();let g=0;for(;L!==h&&g<d;)c.log&&c.log("rule",h.name+"/"+h.id,E[h.state],c.rs.length,c.tI,"["+u(c.t0.tin)+" "+u(c.t1.tin)+"]","["+c.F(c.t0.src)+" "+c.F(c.t1.src)+"]",h,c),c.rule=h,h=h.process(c),c.log&&c.log("stack",c.rs.length,c.rs.map(e=>e.name+"/"+e.id).join(";"),h,c),g++;if($.token("#ZZ",this.config)!==c.t0.tin)throw new A(s,{},c.t0,L,c);return l.node}clone(e,t){let n=new U(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=$.clone(this.rsm[t]),e),{}),n}}e.exports.Parser=U;let $={token:function(e,t,r){let s=t.token,o=s[e];return null==o&&n===typeof e&&(o=t.tokenI++,s[o]=e,s[e]=o,s[e.substring(1)]=o,null!=r&&Object.assign(r.token,t.token)),o},deep:function(e,...n){let s=r===typeof e,o=null!=e&&(t===typeof e||s);for(let l of n){let n=r===typeof l,i=null!=l&&(t===typeof l||n);if(o&&i&&!n&&Array.isArray(e)===Array.isArray(l))for(let t in l)e[t]=$.deep(e[t],l[t]);else e=void 0===l?e:n?l:i?$.deep(Array.isArray(l)?[]:{},l):l,s=r===typeof e,o=null!=e&&(t===typeof e||s)}return e},clone:function(e){return $.deep(Object.create(Object.getPrototypeOf(e)),e)},charset:(...e)=>e.map(e=>"object"==typeof e?Object.keys(e).join(""):e).join("").split("").reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{}),longest:e=>e.reduce((e,t)=>e<t.length?t.length:e,0),marr:(e,t)=>e.length===t.length&&e.reduce((e,n,r)=>e&&n===t[r],!0),clean_stack(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))},make_src_format:e=>(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.debug.maxlen)+(e.debug.maxlen<n.length?"...":""),make_log:e=>{if("number"==typeof e.log){let n=!1,s=e.log;-1===s&&(s=1,n=!0),e.log=(...o)=>{if(n){let n=o.filter(e=>t!=typeof e).map(e=>r==typeof e?e.name:e).join("\t");e.options.debug.get_console().log(n)}else e.options.debug.get_console().dir(o,{depth:s})}}return e.log},wrap_bad_lex:(e,t,n)=>{let r=r=>{let o=e(r);if(t===o.tin){let e={};throw null!=o.use&&(e.use=o.use),new A(o.why||s,e,o,r,n)}return o};return r.src=e.src,r},regexp:(e,...t)=>new RegExp(t.map(e=>"%"===e[0]?e.substring(1).replace(/./g,"\\$&"):e).join(""),e),errinject:(e,t,n,r,s,o)=>e.replace(/\$([\w_]+)/g,(e,l)=>JSON.stringify("code"===l?t:n[l]||(o.meta?o.meta[l]:void 0)||r[l]||s[l]||o[l]||o.options[l]||o.config[l]||"$"+l)),extract:(e,t,n)=>{let r=0<n.loc?n.loc:0,s=0<n.row?n.row:0,o=0<n.col?n.col:0,l=null==n.src?"":n.src,i=e.substring(Math.max(0,r-333),r).split("\n"),a=e.substring(r,r+333).split("\n"),c=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"\x1b[34m"+(""+u++).padStart(c," ")+" | \x1b[0m"+(null==e?"":e),m=i.length;return[2<m?p(i[m-3]):null,1<m?p(i[m-2]):null,p(i[m-1]+a[0])," ".repeat(c)+"   "+" ".repeat(o)+"\x1b[31m"+"^".repeat(l.length||1)+" "+t+"\x1b[0m",p(a[1]),p(a[2])].filter(e=>null!=e).join("\n")},wrap_parser:e=>({start:function(t,n,r,s,o){try{return e.start(t,n,r,s,o)}catch(l){if("SyntaxError"===l.name){let e=0,t=0,o=0,i="",a=l.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(a){i=a[1],e=parseInt(a[2]),t=n.substring(0,e).replace(/[^\n]/g,"").length;let r=e-1;for(;-1<r&&"\n"!==n.charAt(r);)r--;o=Math.max(n.substring(r,e).length,0)}let c=l.token||{tin:r.token.UK,loc:e,len:i.length,row:l.lineNumber||t,col:l.columnNumber||o,val:void 0,src:i};throw new A(l.code||"json",l.details||{msg:l.message},c,{},l.ctx||{rI:-1,options:r.options,config:{token:{}},token:c,meta:s,src:()=>n,root:()=>{},plugins:()=>r.internal().plugins,rule:L,node:void 0,lex:-1,u2:c,u1:c,t0:c,t1:c,tI:-1,rs:[],next:()=>c,rsm:{},n:{},log:s?s.log:void 0,F:$.make_src_format(r.internal().config),use:{}})}throw l}}}),make_error_desc(e,t,n,s,o){n={...n};let l=o.options,i=o.meta,a=$.errinject(l.error[e]||l.error.unknown,e,t,n,s,o);r===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let c=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+a,"  \x1b[34m--\x3e\x1b[0m "+(i&&i.fileName||"<no-file>")+":"+n.row+":"+n.col,$.extract(o.src(),a,n),$.errinject((l.hint[e]||l.hint.unknown).replace(/^([^ ])/," $1").split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,s,o),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+s.name+"~"+E[s.state]+"; token="+o.config.token[n.tin]+(null==n.why?"":"~"+n.why)+"; plugins="+o.plugins().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:o}};return{...Object.create(u),message:c,code:e,details:t,meta:i,fileName:i?i.fileName:void 0,lineNumber:n.row,columnNumber:n.col}},build_config_from_options:function(e,t){let r=Object.keys(t.token);r.forEach(t=>$.token(t,e));let s=r.filter(e=>null!=t.token[e].c);e.singlemap=s.reduce((n,r)=>(n[t.token[r].c]=e.token[r],n),{});let o=r.filter(e=>n===typeof t.token[e]);e.start=o.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.token[r],t),{}),n),{}),e.multi=o.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.token[r],t),{}),n),{});let l=r.filter(e=>null!=t.token[e].s);if(e.tokenset=l.reduce((n,r)=>(n[r.substring(1)]=t.token[r].s.split(",").reduce((t,n)=>(t[e.token[n]]=n,t),{}),n),{}),e.charset={},e.string={escape:Object.keys(t.string.escape).reduce((e,n)=>(e[n]=t.string.escape[n],e),{})},e.charset.start_commentmarker={},e.charset.cm_single={},e.cmk=[],e.cmk0="",e.cmk1="",t.comment.lex){e.comment=t.comment.marker;let n=Object.keys(e.comment);n.forEach(t=>{1===t.length?(e.charset.start_commentmarker[t]=t.charCodeAt(0),e.charset.cm_single[t]=t.charCodeAt(0)):(e.charset.start_commentmarker[t[0]]=t.charCodeAt(0),e.cmk.push(t),e.cmk0+=t[0],e.cmk1+=t[1])}),e.cmk_maxlen=$.longest(n)}e.single_char=Object.keys(e.singlemap).join(""),e.charset.digital=$.charset(t.number.digital),e.charset.multiline=$.charset(t.string.multiline),e.charset.value_ender=$.charset(e.multi.SP,e.multi.LN,e.single_char,e.charset.start_commentmarker),e.charset.text_ender=e.charset.value_ender,e.charset.hoover_ender=$.charset(e.multi.LN,e.single_char,e.charset.start_commentmarker),e.charset.start_blockmarker={},e.bmk=[];let i=Object.keys(t.string.block);i.forEach(t=>{e.charset.start_blockmarker[t[0]]=t.charCodeAt(0),e.bmk.push(t)}),e.bmk_maxlen=$.longest(i),e.number={sep_RE:null!=t.number.sep?new RegExp(t.number.sep,"g"):null},e.re={},e.debug=t.debug,Object.keys(t.config.modify).forEach(n=>t.config.modify[n](e,t)),t.debug.print_config&&t.debug.get_console().dir(e,{depth:null})}};function B(e,r){let s,o,l,i,a=$.deep({},r?{...r.options}:{tag:"-",line:{lex:!0,row:"\n",sep_RES:"\r*\n"},comment:{lex:!0,balance:!0,marker:{"#":!0,"//":!0,"/*":"*/"}},space:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},block:{lex:!0},string:{lex:!0,escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",block:{"'''":"'''"},escapedouble:!1},text:{lex:!0,lex_value:!0,hoover:!0},map:{extend:!0},value:{null:null,true:!0,false:!1},plugin:{},debug:{get_console:()=>console,maxlen:33,print_config:!1},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:D,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},rule:{start:"val",finish:!0,maxmul:3},config:{modify:{}},parser:{}},e||{}),c=function(e,t,r){if(n===typeof e){let n=c.internal();return(u.parser.start?$.wrap_parser(u.parser):n.parser).start(n.lexer,e,c,t,r)}return e},u=e=>{if(null!=e&&t===typeof e){$.build_config_from_options(l,$.deep(a,e));for(let e in a)c.options[e]=a[e];Object.assign(c.token,l.token)}return{...c.options}},p={token:function(e){return $.token(e,l,c)},options:$.deep(u,a),parse:c,use:function(e,t){return c.options({plugin:{[e.name]:t||{}}}),c.internal().plugins.push(e),e(c)||c},rule:function(e,t){return c.internal().parser.rule(e,t)},lex:function(e,t){return c.internal().lexer.lex(e,t)},make:function(e){return B(e,c)},id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+"/"+u.tag,toString:function(){return this.id}};if(Object.defineProperty(p.make,"name",{value:"make"}),Object.assign(p,{internal:()=>({lexer:s,parser:o,config:l,plugins:i})}),r){for(let t in r)c[t]=r[t];c.parent=r;let e=r.internal();l=$.deep({},e.config),$.build_config_from_options(l,a),Object.assign(c.token,l.token),i=[...e.plugins],s=e.lexer.clone(l),o=e.parser.clone(a,l)}else l={tokenI:1,token:{}},$.build_config_from_options(l,a),i=[],s=new O(l),(o=new U(a,l)).init();return Object.assign(c,p),Object.assign(c.token,l.token),c}function D(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcWasNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((n,r,s)=>(n[r]=e(t[s]),n),{})}e.exports.util=$,e.exports.make=B;let Z=B();return e.exports.Jsonic=Z,Z.use=()=>{throw new Error("Jsonic.use cannot be called directly. Instead write: `Jsonic.make().use(...)`.")},Z.Jsonic=Z,Z.JsonicError=A,Z.Lexer=O,Z.Parser=U,Z.Rule=T,Z.RuleSpec=J,Z.util=$,Z.make=B,e.exports.default=Z,e.exports=e.exports.Jsonic,e=e.exports}));