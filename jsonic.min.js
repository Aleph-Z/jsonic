!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.make=e.util=e.RuleSpec=e.Rule=e.Parser=e.Lexer=e.JsonicError=e.Jsonic=void 0;const t="object",n="unexpected";function r(){return{escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},char:{row:"\n",bad_unicode:String.fromCharCode("0x0000")},comment:{"#":!0,"//":!0,"/*":"*/"},balance:{comment:!0},number:{digital:"-1023456789._xeEaAbBcCdDfF+",underscore:!0},string:{multiline:"`",block:{"'''":"'''"},escapedouble:!1},text:{hoover:!0,endofline:!1},object:{extend:!0},value:{null:null,true:!0,false:!1},mode:{},plugin:{},debug:{get_console:()=>console,maxlen:33},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src"},hint:((e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonicItself.\nPleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcShouldNotOccurAtThisPointAsItIsNot\nvalid %j%s%o%nSyntax,EvenUnderTheRelaxedJsonicRules.~ifItIsNot\nobviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.|~but~i %j%s%o%nMustExplainToYouHowAllThisMistakenIdeaOf\nreprobatingPleasureAndExtollingPainArose.~toDoSo,~iWillGive\nyouACompleteAccountOfTheSystem,AndExpoundTheActual\nteachingsOfTheGreatExplorerOfTheTruth,TheMaster-builderOf\nhumanHappiness.".split("|"))=>"unknown|unexpected|invalid_unicode".split("|").reduce((n,r,l)=>(n[r]=e(t[l]),n),{}))(),token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},lex:{core:{LN:"#LN"}},rule:{maxmul:3}}}console.log(r());class l extends SyntaxError{constructor(e,t,n,r,s){t=p.deep({},t);let o=p.deep({},{rI:s.rI,opts:s.opts,config:s.config,meta:s.meta,src:()=>s.src(),root:()=>s.root(),node:s.node,t0:s.t0,t1:s.t1,tI:s.tI,next:()=>s.next(),log:s.log,use:s.use}),i=l.make_desc(e,t,n,r,o);super(i.message),Object.assign(this,i),this.stack&&(this.stack=this.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}static make_desc(e,t,n,r,l){n={...n};let s=l.opts,i=l.meta,c=p.errinject(s.error[e]||s.error.unknown,e,t,n,r,l),a=["[31m[jsonic/"+e+"]:[0m "+(i&&i.mode?"[35m[mode:"+i.mode+"]:[0m ":"")+c,"  [34m--\x3e[0m "+(i.fileName||"<no-file>")+":"+n.row+":"+n.col,p.extract(l.src(),c,n),p.errinject((s.hint[e]||s.hint.unknown).split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,r,l),"  [2mhttps://jsonic.richardrodger.com[0m","\n  [2m--internal: rule="+r.name+"~"+o[r.state]+", token="+l.config.token[n.pin]+"--[0m"].join("\n"),u={internal:{token:n,ctx:l}};return{...Object.create(u),message:a,code:e,details:t,meta:i,fileName:i.fileName,lineNumber:n.row,columnNumber:n.col}}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.JsonicError=l;class s{constructor(e){this.match={},p.token("@LS_TOP",e),p.token("@LS_TEXT",e),p.token("@LS_CONSUME",e),p.token("@LS_MULTILINE",e),this.end={pin:p.token("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const t=e.opts,n=e.config;let r=e=>p.token(e,n),l=e=>p.token(e,n),s=e.F,o=r("@LS_TOP"),i=r("@LS_TEXT"),c=r("@LS_CONSUME"),a=r("@LS_MULTILINE"),u=r("#ZZ"),d=r("#SP"),m=r("#CM"),f=r("#NR"),h=r("#ST"),g=r("#TX"),b=r("#VL");r("#LN");let k={pin:u,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},_=0,v=0,x=0,w=e.src(),y=w.length,S=null!=e&&null!=e.log?(...t)=>e.log("lex",...t):void 0,A=this;function j(t,n){let r=A.match[t];if(null!=r){k.loc=_;for(let t of r){let r=t(_,w,k,e,n,A.bad);if(r)return _=r.sI,v=r.rD?v+r.rD:v,x=r.cD?x+r.cD:x,S&&S(l(k.pin),s(k.src),{...k}),k}}}let N=function(r){k.len=0,k.val=void 0,k.src=void 0,k.row=v;let p=o,N=null,C="",O=0,L=[],I=-1;e:for(;_<y;){let u=w[_],T=w.charCodeAt(_);if(o!==p){if(i===p){if(j(i,r))return k;let e=t.text.hoover?n.hoover_ender:n.text_ender;for(;null!=w[O]&&(!e.includes(w[O])||n.cmk0.includes(w[O])&&!n.cmk1.includes(w[O+1]));)x++,O++;if(k.len=O-_,k.pin=g,k.val=w.substring(_,O),k.src=k.val,t.text.hoover&&n.multi.SP.includes(k.val[k.val.length-1])){let e=k.val.length-2;for(;0<e&&n.multi.SP.includes(k.val[e]);)e--;k.val=k.val.substring(0,e+1),k.src=k.val,x-=k.len-e-1,k.len=k.val.length,_+=k.len}else _=O;return S&&S(l(k.pin),s(k.src),{...k}),k}if(c===p){if(j(c,r))return k;for(O=_;O<y&&!C.includes(w[O]);)O++,x++;return k.val+=w.substring(_,O),k.src=k.val,k.len=k.val.length,_=O,p=o,S&&S(l(k.pin),s(k.src),{...k}),k}if(a===p){if(j(a,r))return k;O=_;let e=1,i=N[0],c=N[1],u=t.balance[N[2]],d=!!N[3],m="",f=i.length,h=c.length;if(d){let e=_-1;for(;-1<e&&n.multi.SP.includes(w[e--]););m=n.multi.SP[0].repeat(_-e-2)}for(O+=i.length;O<y&&0<e;)c[0]===w[O]&&c===w.substring(O,O+h)?(O+=h,x+=h,e--):u&&i[0]===w[O]&&i===w.substring(O,O+f)?(O+=f,x+=h,e++):(t.char.row===w[O]?(v++,x=0):x++,O++);return k.val=w.substring(_,O),k.src=k.val,k.len=k.val.length,d&&(k.val=k.val.substring(f,k.val.length-h),k.val=k.val.replace(new RegExp(t.char.row+m,"g"),"\n"),k.val=k.val.substring(1,k.val.length-1)),_=O,p=o,S&&S(l(k.pin),s(k.src),{...k}),k}}else{if(j(o,r))return k;if(n.start.SP.includes(T)){for(k.pin=d,k.loc=_,k.col=x++,O=_+1;n.multi.SP.includes(w[O]);)x++,O++;return k.len=O-_,k.val=w.substring(_,O),k.src=k.val,_=O,S&&S(l(k.pin),s(k.src),{...k}),k}if(n.start.LN.includes(T)){for(k.pin=n.lex.core.LN,k.loc=_,k.col=x,O=_,x=0;n.multi.LN.includes(w[O]);)v+=t.char.row===w[O]?1:0,O++;return k.len=O-_,k.val=w.substring(_,O),k.src=k.val,_=O,S&&S(l(k.pin),s(k.src),{...k}),k}if(null!=n.single[T])return k.pin=n.single[T],k.loc=_,k.col=x++,k.len=1,k.src=u,_++,S&&S(l(k.pin),s(k.src),{...k}),k;if(n.start.NR.includes(T)){for(k.pin=f,k.loc=_,k.col=x,O=_;t.number.digital.includes(w[++O]););if((null==w[O]||n.value_ender.includes(w[O]))&&(k.len=O-_,1<k.len&&"0"===w[_]&&"x"!=w[_+1]?(k.val=void 0,O--):(k.val=+w.substring(_,O),t.number.underscore&&isNaN(k.val)&&(k.val=+w.substring(_,O).replace(/_/g,"")),isNaN(k.val)&&(k.val=void 0,O--))),null!=k.val)return k.src=w.substring(_,O),x+=k.len,_=O,S&&S(l(k.pin),s(k.src),{...k}),k}if(n.start_bm.includes(T)){let e=w.substring(_,_+n.bmk_maxlen);for(let r of n.bmk)if(e.startsWith(r)){k.pin=h,k.loc=_,k.col=x,p=a,N=[r,t.string.block[r],null,!0];continue e}}if(n.start.ST.includes(T)){k.pin=h,k.loc=_,k.col=x++;let r=u.charCodeAt(0),o=t.string.multiline.includes(u);for(L=[],I=-1,O=_+1;O<y;O++)if(x++,r===(I=w.charCodeAt(O))){if(!t.string.escapedouble||r!==w.charCodeAt(O+1)){O++;break}L.push(w[O]),O++}else if(92===I){let r=w.charCodeAt(++O);x++;let l=n.escape[r];if(null!=l)L.push(l);else if(117===r){O++;let n=String.fromCharCode("0x"+w.substring(O,O+4));if(t.char.bad_unicode===n)return A.bad(e,S,"invalid_unicode",k,_,O,v,x,w.substring(O-2,O+4));L.push(n),O+=3,x+=4}else L.push(w[O])}else if(I<32){if(!o||!n.start.LN.includes(I))return A.bad(e,S,"unprintable",k,_,O,v,x,w.charAt(O));L.push(w[O])}else{let e=O;do{I=w.charCodeAt(++O),x++}while(32<=I&&r!==I&&92!==I);x--,L.push(w.substring(e,O)),O--}return r!==I?(x=_,A.bad(e,S,"unterminated",k,_,O-1,v,x,L.join(""))):(k.val=L.join(""),k.src=w.substring(_,O),k.len=O-_,_=O,S&&S(l(k.pin),s(k.src),{...k}),k)}if(n.start_cm.includes(T)){let e=n.cm_single.includes(u),r=w.substring(_,_+n.cmk_maxlen);for(let l of n.cmk)if(r.startsWith(l)){if(!0!==t.comment[l]){k.pin=m,k.loc=_,k.col=x,k.val="",p=a,N=[l,t.comment[l],"comment"];continue e}e=!0;break}if(e){k.pin=m,k.loc=_,k.col=x,k.val="",p=c,C=n.multi.LN;continue e}}k.loc=_,k.col=x,O=_;do{x++,O++}while(null!=w[O]&&!n.value_ender.includes(w[O]));let g=w.substring(_,O),E=t.value[g];if(void 0!==E)return k.pin=b,k.val=E,k.src=g,k.len=O-_,_=O,S&&S(l(k.pin),s(k.src),{...k}),k;p=i}}return k.pin=u,k.loc=y,k.col=x,S&&S(l(k.pin),s(k.src),{...k}),k};return N.src=w,N}bad(e,t,n,r,l,s,o,i,c,a,u){return r.why=n,r.pin=p.token("#BD",e.config),r.loc=s,r.row=o,r.col=i,r.len=s-l+1,r.val=c,r.src=a,r.use=u,t&&t(p.token(r.pin,e.config),e.F(r.src),{...r},"error",n),r}lex(e,t){return null==e?this.match:(this.match[e]=this.match[e]||[],null!=t&&this.match[e].push(t),this.match[e])}clone(e){let t=new s(e);return p.deep(t.match,this.match),t}}var o;e.Lexer=s,function(e){e[e.open=0]="open",e[e.close=1]="close"}(o||(o={}));class i{constructor(e,t,n){this.id=t.rI++,this.name=e.name,this.spec=e,this.node=n,this.state=o.open,this.child=c,this.open=[],this.close=[]}process(e){let t=c;return o.open===this.state?t=this.spec.open(this,e):o.close===this.state&&(t=this.spec.close(this,e)),t}}e.Rule=i;let c={id:0,spec:{name:"norule"}};class a{constructor(e,t){this.name=e,this.def=t}open(e,t){let r,s=e,c="",a=t.F;this.def.before_open&&(r=this.def.before_open.call(this,e,t),e.node=r&&r.node||e.node);let u=null!=r&&r.done?{m:[]}:this.parse_alts(this.def.open,e,t);if(u.e)throw new l(n,{open:!0},u.e,e,t);return e.open=u.m,u.p?(t.rs.push(e),(s=e.child=new i(t.rsm[u.p],t,e.node)).parent=e,c+="U"):u.r?((s=new i(t.rsm[u.r],t,e.node)).parent=e.parent,c+="R"):c+="Z",this.def.after_open&&this.def.after_open.call(this,e,t,s),t.log&&t.log("node",e.name+"/"+e.id,o[e.state],c,a(e.node)),e.state=o.close,s}close(e,t){let r=c,s="";this.def.before_close&&this.def.before_close.call(this,e,t);let a=0<this.def.close.length?this.parse_alts(this.def.close,e,t):{};if(a.e)throw new l(n,{close:!0},a.e,e,t);return a.h&&(r=a.h(this,e,t)||r,s+="H"),a.p?(t.rs.push(e),(r=e.child=new i(t.rsm[a.p],t,e.node)).parent=e,s+="U"):a.r?((r=new i(t.rsm[a.r],t,e.node)).parent=e.parent,s+="R"):(r=t.rs.pop()||c,s+="O"),this.def.after_close&&this.def.after_close.call(this,e,t,r),r.why=s,t.log&&t.log("node",e.name+"/"+e.id,o[e.state],s,t.F(e.node)),r}parse_alts(e,t,n){let r,l=void 0,s=0,i=n.config.token;if(i.ZZ===n.t0.pin)l={m:[]};else if(0<e.length){for(s=0;s<e.length;s++)if(!(r=e[s]).c||r.c(r,t,n)){if(null==r.s||0===r.s.length){l={...r,m:[]};break}if(r.s[0]===n.t0.pin){if(1===r.s.length){l={...r,m:[n.t0]};break}if(r.s[1]===n.t1.pin){l={...r,m:[n.t0,n.t1]};break}}else if(i.AA===r.s[0]){l={...r,m:[n.t0]};break}}l=l||{e:n.t0,m:[]}}if(l=l||{m:[]},n.log&&n.log("parse",t.name+"/"+t.id,o[t.state],s<e.length?"alt="+s:"no-alt",s<e.length&&r&&r.s?"["+r.s.map(e=>i[e]).join(" ")+"]":"[]",n.tI,"p="+(l.p||""),"r="+(l.r||""),"b="+(l.b||""),l.m.map(e=>i[e.pin]).join(" "),n.F(l.m.map(e=>e.src)),l),l.m){let e=0,t=l.m.length-(l.b||0);for(;e++<t;)n.next()}return l}}e.RuleSpec=a;class u{constructor(e,t){this.rsm={},this.opts=e,this.config=t}init(){let e=this.config.token,t=e.OB,n=e.CB,r=e.OS,l=e.CS,s=e.CL,o=e.CA,i=e.TX,c=e.NR,u=e.ST,d=e.VL,m=e.AA,f={val:{open:[{s:[t,o],p:"map"},{s:[t],p:"map"},{s:[r],p:"list"},{s:[o],p:"list",b:1},{s:[i,s],p:"map",b:2},{s:[u,s],p:"map",b:2},{s:[c,s],p:"map",b:2},{s:[d,s],p:"map",b:2},{s:[i]},{s:[c]},{s:[u]},{s:[d]}],close:[{s:[o],c:(e,t,n)=>0===n.rs.length,r:"elem",h:(e,t,n)=>{t.node=[t.node]}},{s:[m],b:1}],before_close:e=>{var t,n;e.node=null!==(t=e.child.node)&&void 0!==t?t:null===(n=e.open[0])||void 0===n?void 0:n.val}},map:{before_open:()=>({node:{}}),open:[{s:[n]},{p:"pair"}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[l]},{p:"elem"}],close:[]},pair:{open:[{s:[u,s],p:"val"},{s:[i,s],p:"val"},{s:[c,s],p:"val"},{s:[d,s],p:"val"},{s:[n],b:1}],close:[{s:[n]},{s:[o],r:"pair"},{s:[u,s],r:"pair",b:2},{s:[i,s],r:"pair",b:2},{s:[c,s],r:"pair",b:2},{s:[d,s],r:"pair",b:2}],before_close:(e,t)=>{let r=e.open[0];if(r&&n!==r.pin){let n=u===r.pin?r.val:r.src,l=e.node[n];e.node[n]=null==l?e.child.node:t.opts.object.extend?p.deep(l,e.child.node):e.child.node}}},elem:{open:[{s:[t],p:"map"},{s:[r],p:"list"},{s:[i]},{s:[c]},{s:[u]},{s:[d]},{s:[o,o],b:2},{s:[o]}],close:[{s:[o,l]},{s:[o],r:"elem"},{s:[l]},{s:[t],p:"map"},{s:[r],p:"list"},{s:[i,s],p:"map",b:2},{s:[c,s],p:"map",b:2},{s:[u,s],p:"map",b:2},{s:[d,s],p:"map",b:2},{s:[i],r:"elem",b:1},{s:[c],r:"elem",b:1},{s:[u],r:"elem",b:1},{s:[d],r:"elem",b:1}],after_open:(e,t,n)=>{if(e===n&&e.open[0]){let t=e.open[0].val;e.node.push(null!=t?t:null)}},before_close:e=>{e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(f).reduce((e,t)=>(e[t]=new a(t,f[t]),e),{})}rule(e,t){return this.rsm[e]=null==t?this.rsm[e]:t(this.rsm[e],this.rsm)||this.rsm[e],this.rsm[e]}start(e,t,n,r){let l,s=this.opts,a=this.config,u={rI:1,opts:s,config:a,meta:n||{},src:()=>t,root:()=>l.node,node:void 0,u2:e.end,u1:e.end,t0:e.end,t1:e.end,tI:-2,next:g,rs:[],rsm:this.rsm,log:n&&n.log||void 0,F:p.make_src_format(a),use:{}};null!=r&&(u=p.deep(u,r)),p.make_log(u);let d=e=>p.token(e,this.config),m=p.wrap_bad_lex(e.start(u),p.token("#BD",this.config),u),f=new i(this.rsm.val,u);l=f;let h=2*Object.keys(this.rsm).length*m.src.length*2*s.rule.maxmul;function g(e=!0){let t;u.u2=u.u1,u.u1=u.t0,u.t0=u.t1;do{t=m(f),u.tI++}while(e&&a.tokenset.IGNORE.includes(t.pin));return u.t1={...t},u.t0}g(),g();let b=0;for(;c!==f&&b<h;)u.log&&u.log("rule",f.name+"/"+f.id,o[f.state],u.rs.length,u.tI,"["+d(u.t0.pin)+" "+d(u.t1.pin)+"]","["+u.F(u.t0.src)+" "+u.F(u.t1.src)+"]",f,u),f=f.process(u),u.log&&u.log("stack",u.rs.length,u.rs.map(e=>e.name+"/"+e.id).join(";"),f,u),b++;return l.node}clone(e,t){let n=new u(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=p.clone(this.rsm[t]),e),{}),n}}e.Parser=u;let p={token:function(e,t,n){let r=t.token,l=r[e];return null==l&&"string"==typeof e&&(l=t.tokenI++,r[l]=e,r[e]=l,r[e.substring(1)]=l,null!=n&&Object.assign(n.token,t.token)),l},deep:function(e,...n){let r="function"==typeof e,l=null!=e&&(t===typeof e||r);for(let s of n){let n="function"==typeof s,o=null!=s&&(t===typeof s||n);if(l&&o&&!n&&Array.isArray(e)===Array.isArray(s))for(let t in s)e[t]=p.deep(e[t],s[t]);else r="function"==typeof(e=void 0===s?e:n?s:o?p.deep(Array.isArray(s)?[]:{},s):s),l=null!=e&&(t===typeof e||r)}return e},clone:function(e){return p.deep(Object.create(Object.getPrototypeOf(e)),e)},s2cca:function(e){return e.split("").map(e=>e.charCodeAt(0))},longest:e=>e.reduce((e,t)=>e<t.length?t.length:e,0),make_src_format:e=>(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.debug.maxlen)+(e.debug.maxlen<n.length?"...":""),make_log:e=>{if("number"==typeof e.log){let n=!1,r=e.log;-1===r&&(r=1,n=!0),e.log=(...l)=>{if(n){let n=l.filter(e=>t!=typeof e).join("\t");e.opts.debug.get_console().log(n)}else e.opts.debug.get_console().dir(l,{depth:r})}}},wrap_bad_lex:(e,t,r)=>{let s=s=>{let o=e(s);if(t===o.pin){let e={};throw null!=o.use&&(e.use=o.use),new l(o.why||n,e,o,s,r)}return o};return s.src=e.src,s},errinject:(e,t,n,r,l,s)=>e.replace(/\$([\w_]+)/g,(e,o)=>JSON.stringify("code"===o?t:n[o]||s.meta[o]||r[o]||l[o]||s[o]||s.opts[o]||s.config[o]||"$"+o)),extract:(e,t,n)=>{let r=0<n.loc?n.loc:0,l=0<n.row?n.row:0,s=0<n.col?n.col:0,o=null==n.src?"":n.src,i=e.substring(Math.max(0,r-333),r).split("\n"),c=e.substring(r,r+333).split("\n"),a=2+(""+(l+2)).length,u=l<2?0:l-2,p=e=>"[34m"+(""+u++).padStart(a," ")+" | [0m"+(null==e?"":e),d=i.length;return[2<d?p(i[d-3]):null,1<d?p(i[d-2]):null,p(i[d-1]+c[0])," ".repeat(a)+"   "+" ".repeat(s)+"[31m"+"^".repeat(o.length||1)+" "+t+"[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")},handle_meta_mode:(e,t,n)=>{let r=e.options;if("function"!=typeof r.mode[n.mode])return[!1];try{return r.mode[n.mode].call(e,t,n)}catch(s){if("SyntaxError"===s.name){let o=0,i=0,c=0,a="",u=s.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(u){a=u[1],o=parseInt(u[2]),i=t.substring(0,o).replace(/[^\n]/g,"").length;let e=o-1;for(;-1<e&&"\n"!==t.charAt(e);)e--;c=e<o?t.substring(e,o).length-1:0}let d=s.token||{pin:e.token.UK,loc:o,len:a.length,row:s.lineNumber||i,col:s.columnNumber||c,val:void 0,src:a};throw new l(s.code||"json",s.details||{msg:s.message},d,{},s.ctx||{rI:-1,opts:r,config:{token:{}},token:{},meta:n,src:()=>t,root:()=>{},node:void 0,u2:d,u1:d,t0:d,t1:d,tI:-1,rs:[],next:()=>d,rsm:{},log:n.log,F:p.make_src_format(e.internal().config),use:{}})}throw s}},build_config_from_options:function(e,t){let n=Object.keys(t.token);n.forEach(t=>p.token(t,e));let r=n.filter(e=>null!=t.token[e].c);e.single=r.reduce((n,r)=>{return n[(l=t.token[r].c,l.charCodeAt(0))]=e.token[r],n;var l},[]);let l=n.filter(e=>"string"==typeof t.token[e]);e.start=l.reduce((e,n)=>(e[n.substring(1)]=p.s2cca(t.token[n]),e),{}),e.multi=l.reduce((e,n)=>(e[n.substring(1)]=t.token[n],e),{});let s=n.filter(e=>null!=t.token[e].s);if(e.tokenset=s.reduce((n,r)=>(n[r.substring(1)]=t.token[r].s.split(",").map(t=>e.token[t]),n),{}),t.escape=t.escape||{},e.escape=Object.keys(t.escape).reduce((e,n)=>(e[n.charCodeAt(0)]=t.escape[n],e),[]),e.start_cm=[],e.cm_single="",e.cmk=[],e.cmk0="",e.cmk1="",t.comment){let n=Object.keys(t.comment);n.forEach(t=>{1===t.length?(e.start_cm.push(t.charCodeAt(0)),e.cm_single+=t):(e.start_cm.push(t.charCodeAt(0)),e.cmk.push(t),e.cmk0+=t[0],e.cmk1+=t[1])}),e.cmk_maxlen=p.longest(n)}e.start_cm_char=e.start_cm.map(e=>String.fromCharCode(e)).join(""),e.start_bm=[],e.bmk=[];let o=Object.keys(t.string.block);o.forEach(t=>{e.start_bm.push(t.charCodeAt(0)),e.bmk.push(t)}),e.bmk_maxlen=p.longest(o),e.single_char=e.single.map((e,t)=>String.fromCharCode(t)).join(""),e.value_ender=e.multi.SP+e.multi.LN+e.single_char+e.start_cm_char,e.text_ender=e.value_ender,e.hoover_ender=e.multi.LN+e.single_char+e.start_cm_char,e.lex={core:{LN:p.token(t.lex.core.LN,e)}},e.debug=t.debug}};function d(e,n){let l,o=e;"function"==typeof e&&(o={},n=e);let i,c,a=p.deep({},n?{...n.options}:r(),o),m=function(e,t,n){if("string"==typeof e){let r=m.internal(),[l,s]=null!=t&&null!=t.mode?p.handle_meta_mode(m,e,t):[!1];return l||(s=r.parser.start(r.lexer,e,t,n)),s}return e};if(m.token=function(e){return p.token(e,l,m)},n){for(let t in n)m[t]=n[t];m.parent=n;let e=n.internal();l=p.deep({},e.config),p.build_config_from_options(l,a),Object.assign(m.token,l.token),i=e.lexer.clone(l),c=e.parser.clone(a,l)}else l={tokenI:1,token:{}},p.build_config_from_options(l,a),i=new s(l),(c=new u(a,l)).init();return Object.assign(m.token,l.token),m.internal=()=>({lexer:i,parser:c,config:l}),m.options=p.deep(e=>{if(null!=e&&t===typeof e){p.build_config_from_options(l,p.deep(a,e));for(let e in a)m.options[e]=a[e]}return m},a),m.parse=m,m.use=function(e,t){return m.options({plugin:{[e.name]:t||{}}}),e(m)||m},m.rule=function(e,t){let n=m.internal().parser.rule(e,t);return null==t?n:m},m.lex=function(e,t){let n=m.internal().lexer.lex(e,t);return null==t?n:m},m.make=function(e){return d(e,m)},Object.defineProperty(m.make,"name",{value:"make"}),m}e.util=p,e.make=d;let m=d();return e.Jsonic=m,e}));