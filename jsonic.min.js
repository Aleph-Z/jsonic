!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const n="object",t="string",r="function",o="unexpected",s="map",l="list",i="elem",c="pair",a="val",u="node";class p extends SyntaxError{constructor(e,n,t,r,o){n=x.deep({},n);let s=x.deep({},{rI:o.rI,options:o.options,config:o.config,meta:o.meta,src:()=>o.src(),plugins:()=>o.plugins(),node:o.node,t0:o.t0,t1:o.t1,tI:o.tI,log:o.log,use:o.use}),l=x.make_error_desc(e,n,t,r,s);super(l.message),Object.assign(this,l),x.clean_stack(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=p;class h{constructor(e){this.match={},x.token("@LTP",e),x.token("@LTX",e),x.token("@LCS",e),x.token("@LML",e),this.end={pin:x.token("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const n=e.options,t=e.config;let r=e=>x.token(e,t),o=e.F,s=r("@LTP"),l=r("@LTX"),i=r("@LCS"),c=r("@LML"),a=r("#ZZ"),u=r("#SP"),p=r("#CM"),h=r("#NR"),d=r("#ST"),m=r("#TX"),f=r("#VL");r("#LN");let g={pin:a,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},b=0,k=0,v=0,_=e.src(),y=_.length,w=null!=e.log?(...n)=>{return e.log("lex",(r=g.pin,x.token(r,t)),o(g.src),b,k+":"+v,{...g},...n);var r}:void 0,C=this;function j(n,t,r,o){return C.bad(e,w,n,g,b,t,k,v,r,r,o)}function S(n,t){let r=C.match[n];if(null!=r){g.loc=b;for(let n of r){let r=n(b,k,v,_,g,e,t,j);if(r)return b=r.sI?r.sI:b,k=r.rI?r.rI:k,v=r.cI?r.cI:v,w&&w(g,n),g}}}let N=function(e){g.len=0,g.val=void 0,g.src=void 0,g.row=k;let r=s,o=null,x={},C=0,N=[];e:for(;b<y;){let a=_[b];if(s!==r){if(l===r){if(S(l,e))return g;let r=n.text.hoover?t.charset.hoover_ender:t.charset.text_ender;for(;null!=_[C]&&(!r[_[C]]||t.cmk0.includes(_[C])&&!t.cmk1.includes(_[C+1]));)v++,C++;if(g.len=C-b,g.pin=m,g.val=_.substring(b,C),g.src=g.val,n.text.hoover&&t.multi.SP[g.val[g.val.length-1]]){let e=g.val.length-2;for(;0<e&&t.multi.SP[g.val[e]];)e--;g.val=g.val.substring(0,e+1),g.src=g.val,v-=g.len-e-1,g.len=g.val.length,b+=g.len}else b=C;return w&&w(g),g}if(i===r){if(S(i,e))return g;for(C=b;C<y&&!x[_[C]];)C++,v++;return g.val+=_.substring(b,C),g.src=g.val,g.len=g.val.length,b=C,r=s,w&&w(g),g}if(c===r){if(S(c,e))return g;C=b;let l=1,i=o[0],a=o[1],u=n.balance[o[2]],p=!!o[3],h="",d=i.length,m=a.length;if(p){let e=b-1;for(;-1<e&&t.multi.SP[_[e--]];);let n=b-e-2;0<n&&(h=Object.keys(t.multi.SP)[0].repeat(n))}for(C+=i.length;C<y&&0<l;)a[0]===_[C]&&a===_.substring(C,C+m)?(C+=m,v+=m,l--):u&&i[0]===_[C]&&i===_.substring(C,C+d)?(C+=d,v+=m,l++):(n.char.row===_[C]?(k++,v=0):v++,C++);return g.val=_.substring(b,C),g.src=g.val,g.len=g.val.length,p&&(g.val=g.val.substring(d,g.val.length-m),g.val=g.val.replace(new RegExp(n.char.row+h,"g"),"\n"),g.val=g.val.substring(1,g.val.length-1)),b=C,r=s,w&&w(g),g}}else{if(S(s,e))return g;if(t.start.SP[a]){for(g.pin=u,g.loc=b,g.col=v++,C=b+1;t.multi.SP[_[C]];)v++,C++;return g.len=C-b,g.val=_.substring(b,C),g.src=g.val,b=C,w&&w(g),g}if(t.start.LN[a]){for(g.pin=t.lex.core.LN,g.loc=b,g.col=v,C=b,v=0;t.multi.LN[_[C]];)k+=n.char.row===_[C]?1:0,C++;return g.len=C-b,g.val=_.substring(b,C),g.src=g.val,b=C,w&&w(g),g}if(null!=t.singlemap[a])return g.pin=t.singlemap[a],g.loc=b,g.col=v++,g.len=1,g.src=a,b++,w&&w(g),g;if(t.start.NR[a]&&n.number.lex){for(g.pin=h,g.loc=b,g.col=v,C=b;t.charset.digital[_[++C]];);let e=_.substring(b,C);if(null==_[C]||t.charset.value_ender[_[C]]){g.len=C-b;let r=_[b+1];!(1<g.len&&"0"===_[b])||n.number.hex&&"x"===r||n.number.oct&&"o"===r||n.number.bin&&"b"===r?(g.val=+e,null!=t.number.sep_re&&isNaN(g.val)&&(g.val=+e.replace(t.number.sep_re,"")),isNaN(g.val)&&(g.val=void 0,C--)):(g.val=void 0,C--)}if(null!=g.val)return g.src=e,v+=g.len,b=C,w&&w(g),g}if(t.charset.start_blockmarker[a]){let e=_.substring(b,b+t.bmk_maxlen);for(let s of t.bmk)if(e.startsWith(s)){g.pin=d,g.loc=b,g.col=v,r=c,o=[s,n.string.block[s],null,!0];continue e}}if(t.start.ST[a]){g.pin=d,g.loc=b,g.col=v++;let e=t.charset.multiline[a];N=[];let r="";for(C=b+1;C<y;C++)if(v++,a===(r=_[C])){if(!n.string.escapedouble||a!==_[C+1]){C++;break}N.push(_[C]),C++}else if("\\"===r){C++,v++;let e=t.string.escape[_[C]];if(null!=e)N.push(e);else if("x"===_[C]){C++;let e=String.fromCharCode("0x"+_.substring(C,C+2));if(n.char.bad_unicode===e)return b=C-2,j("invalid_ascii",C+2,_.substring(C-2,C+2));N.push(e),C+=1,v+=2}else if("u"===_[C]){C++;let e=String.fromCharCode("0x"+_.substring(C,C+4));if(n.char.bad_unicode===e)return b=C-2,j("invalid_unicode",C+5,_.substring(C-2,C+4));N.push(e),C+=3,v+=4}else N.push(_[C])}else{let o=C,s=a.charCodeAt(0),l="\\".charCodeAt(0),i=_.charCodeAt(C);for(;C<y&&32<=i&&s!==i&&l!==i;)i=_.charCodeAt(++C),v++;if(v--,r=_[C],i<32){if(!e||!t.start.LN[r])return j("unprintable",C,"char-code="+_[C].charCodeAt(0));r===n.char.row&&(k++,v=0),N.push(_.substring(o,C+1))}else N.push(_.substring(o,C)),(l===i||s===i||isNaN(i))&&C--}return a!==r?j("unterminated",C,N.join("")):(g.val=N.join(""),g.src=_.substring(b,C),g.len=C-b,b=C,w&&w(g),g)}if(t.charset.start_commentmarker[a]){let e=!!t.charset.cm_single[a],s=_.substring(b,b+t.cmk_maxlen);for(let l of t.cmk)if(s.startsWith(l)){if(!0!==n.comment[l]){g.pin=p,g.loc=b,g.col=v,g.val="",r=c,o=[l,n.comment[l],"comment"];continue e}e=!0;break}if(e){g.pin=p,g.loc=b,g.col=v,g.val="",r=i,x=t.multi.LN;continue e}}g.loc=b,g.col=v,C=b;do{v++,C++}while(null!=_[C]&&!t.charset.value_ender[_[C]]);let m=_.substring(b,C),I=n.value[m];if(void 0!==I)return g.pin=f,g.val=I,g.src=m,g.len=C-b,b=C,w&&w(g),g;r=l}}return g.pin=a,g.loc=y,g.col=v,w&&w(g),g};return N.src=_,N}bad(e,n,t,r,o,s,l,i,c,a,u){return r.why=t,r.pin=x.token("#BD",e.config),r.loc=o,r.row=l,r.col=i,r.len=s-o,r.val=c,r.src=a,r.use=u,n&&n(x.token(r.pin,e.config),e.F(r.src),o,l+":"+i,{...r},"error",t),r}lex(e,n){if(null==e)return this.match;let t=this.match[e];return null!=n?(null==t&&(t=this.match[e]=[]),t.push(n)):null===n&&(t=this.match[e],delete this.match[e]),t}clone(e){let n=new h(e);return x.deep(n.match,this.match),n}}var d;e.exports.Lexer=h,function(e){e[e.open=0]="open",e[e.close=1]="close"}(d||(d={}));class m{constructor(e,n,t){this.id=n.rI++,this.name=e.name,this.spec=e,this.node=t,this.state=d.open,this.child=f,this.open=[],this.close=[],this.n={}}process(e){let n=f;return d.open===this.state?n=this.spec.open(this,e):d.close===this.state&&(n=this.spec.close(this,e)),n}}e.exports.Rule=m;let f={id:0,spec:{name:"norule"}};class g{constructor(){this.m=[],this.p="",this.r="",this.b=0,this.n=null,this.h=null}}const b=new g,k=new g;class v{constructor(e,n){function t(e){return"object"==typeof e&&e.n?(n,t,r)=>{let o=!0;for(let s in e.n)o=o&&(null==t.n[s]||t.n[s]<=e.n[s]);return o}:e}this.name=e,this.def=n,this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let r of this.def.open)null!=r.c&&(r.c=t(r.c));for(let r of this.def.close)null!=r.c&&(r.c=t(r.c))}open(e,n){let t,r=e,s="",l=n.F;this.def.before_open&&(t=this.def.before_open.call(this,e,n),e.node=t&&t.node||e.node);let i=null!=t&&t.done?k:this.parse_alts(this.def.open,e,n);if(i.e)throw new p(o,{open:!0},i.e,e,n);if(e.open=i.m,i.n)for(let o in i.n)e.n[o]=0===i.n[o]?0:(null==e.n[o]?0:e.n[o])+i.n[o],e.n[o]=0<e.n[o]?e.n[o]:0;return i.p?(n.rs.push(e),(r=e.child=new m(n.rsm[i.p],n,e.node)).parent=e,r.n={...e.n},s+="U"):i.r?((r=new m(n.rsm[i.r],n,e.node)).parent=e.parent,r.n={...e.n},s+="R"):s+="Z",this.def.after_open&&this.def.after_open.call(this,e,n,r),n.log&&n.log(u,e.name+"/"+e.id,d[e.state],"w="+s,l(e.node)),e.state=d.close,r}close(e,n){let t=f,r="";this.def.before_close&&this.def.before_close.call(this,e,n);let s=0<this.def.close.length?this.parse_alts(this.def.close,e,n):k;if(s.e)throw new p(o,{close:!0},s.e,e,n);if(s.n)for(let o in s.n)e.n[o]=0===s.n[o]?0:(null==e.n[o]?0:e.n[o])+s.n[o],e.n[o]=0<e.n[o]?e.n[o]:0;return s.h&&(t=s.h(this,e,n)||t,r+="H"),s.p?(n.rs.push(e),(t=e.child=new m(n.rsm[s.p],n,e.node)).parent=e,t.n={...e.n},r+="U"):s.r?((t=new m(n.rsm[s.r],n,e.node)).parent=e.parent,t.n={...e.n},r+="R"):(t=n.rs.pop()||f,r+="O"),this.def.after_close&&this.def.after_close.call(this,e,n,t),t.why=r,n.log&&n.log(u,e.name+"/"+e.id,d[e.state],"w="+r,n.F(e.node)),t}parse_alts(e,n,t){let r,o=b;o.m=[],o.b=0,o.p="",o.r="",o.n=void 0,o.h=void 0,o.e=void 0;let s,l=0,i=t.config.token;if(i.ZZ!==t.t0.pin&&0<e.length){for(o.e=t.t0,l=0;l<e.length;l++)if(s=(s=!(!(s=!(r=e[l]).c||r.c(r,n,t))||null!=r.d)||r.d===t.rs.length)&&(null==r.a||x.marr(r.a,t.rs.slice(-r.a.length).map(e=>e.name).reverse()))){if(null==r.s||0===r.s.length){o.e=void 0;break}if(r.s[0]===t.t0.pin){if(1===r.s.length){o.m=[t.t0],o.e=void 0;break}if(r.s[1]===t.t1.pin){o.m=[t.t0,t.t1],o.e=void 0;break}}else if(i.AA===r.s[0]){o.m=[t.t0],o.e=void 0;break}}null!=r&&(o.b=r.b?r.b:o.b,o.p=r.p?r.p:o.p,o.r=r.r?r.r:o.r,o.n=r.n?r.n:o.n,o.h=r.h?r.h:o.h)}if(t.log&&t.log("parse",n.name+"/"+n.id,d[n.state],l<e.length?"alt="+l:"no-alt",l<e.length&&r&&r.s?"["+r.s.map(e=>i[e]).join(" ")+"]":"[]",t.tI,"p="+(o.p||""),"r="+(o.r||""),"b="+(o.b||""),o.m.map(e=>i[e.pin]).join(" "),t.F(o.m.map(e=>e.src)),"c:"+(r&&r.c?s:""),"n:"+Object.entries(n.n).join(";"),o),o.m){let e=0,n=o.m.length-(o.b||0);for(;e++<n;)t.next()}return o}}e.exports.RuleSpec=v;class _{constructor(e,n){this.rsm={},this.options=e,this.config=n}init(){let e=this.config.token,n=e.OB,t=e.CB,r=e.OS,o=e.CS,u=e.CL,p=e.CA,h=e.TX,d=e.NR,m=e.ST,f=e.VL,g=e.AA,b={val:{open:[{s:[n,p],p:s,n:{im:0}},{s:[n],p:s,n:{im:0}},{s:[r],p:l},{s:[p],d:0,p:l,b:1},{s:[p],b:1},{s:[h,u],p:s,b:2,n:{im:1}},{s:[m,u],p:s,b:2,n:{im:1}},{s:[d,u],p:s,b:2,n:{im:1}},{s:[f,u],p:s,b:2,n:{im:1}},{s:[h]},{s:[d]},{s:[m]},{s:[f]},{s:[t],a:[c],b:1},{s:[o],a:[c],b:1}],close:[{s:[p],d:0,r:i,h:(e,n,t)=>{n.node=[n.node]}},{c:(e,n,t)=>(h===t.t0.pin||d===t.t0.pin||m===t.t0.pin||f===t.t0.pin)&&0===t.rs.length,r:i,h:(e,n,t)=>{n.node=[n.node]}},{s:[g],b:1}],before_close:e=>{var n,t;e.node=null!==(n=e.child.node)&&void 0!==n?n:null===(t=e.open[0])||void 0===t?void 0:t.val}},map:{before_open:()=>({node:{}}),open:[{s:[t]},{p:c}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[o]},{p:i}],close:[]},pair:{open:[{s:[m,u],p:a},{s:[h,u],p:a},{s:[d,u],p:a},{s:[f,u],p:a},{s:[t],b:1}],close:[{s:[t]},{s:[p],c:{n:{im:1}},r:c},{s:[p],n:{im:-1},b:1},{s:[m,u],c:{n:{im:1}},r:c,b:2},{s:[h,u],c:{n:{im:1}},r:c,b:2},{s:[d,u],c:{n:{im:1}},r:c,b:2},{s:[f,u],c:{n:{im:1}},r:c,b:2},{s:[m,u],n:{im:-1},b:2},{s:[h,u],n:{im:-1},b:2},{s:[d,u],n:{im:-1},b:2},{s:[f,u],n:{im:-1},b:2},{s:[o],a:[s,a,i],b:1}],before_close:(e,n)=>{let r=e.open[0];if(r&&t!==r.pin){let t=m===r.pin?r.val:r.src,o=e.child.node,s=e.node[t];o=void 0===o?null:o,e.node[t]=null==s?o:n.options.object.extend?x.deep(s,o):o}}},elem:{open:[{s:[n],p:s,n:{im:0}},{s:[r],p:l},{s:[p,p],b:2},{s:[p]},{p:a,n:{im:1}}],close:[{s:[p,o]},{s:[p],r:i},{s:[o]},{s:[n],p:s,n:{im:0}},{s:[r],p:l},{s:[h,u],p:s,n:{im:0},b:2},{s:[d,u],p:s,n:{im:0},b:2},{s:[m,u],p:s,n:{im:0},b:2},{s:[f,u],p:s,n:{im:0},b:2},{s:[h],r:i,b:1},{s:[d],r:i,b:1},{s:[m],r:i,b:1},{s:[f],r:i,b:1}],after_open:(e,n,t)=>{if(e===t&&e.open[0]){let n=e.open[0].val;e.node.push(null!=n?n:null)}},before_close:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(b).reduce((e,n)=>(e[n]=new v(n,b[n]),e),{})}rule(e,n){if(null==e)return this.rsm;let t=this.rsm[e];return null===n?delete this.rsm[e]:void 0!==n&&(t=this.rsm[e]=n(this.rsm[e],this.rsm)||this.rsm[e]),t}start(e,n,t,r,s){let l,i=this.options,c=this.config,a={rI:1,options:i,config:c,meta:r||{},src:()=>n,root:()=>l.node,plugins:()=>t.internal().plugins,node:void 0,u2:e.end,u1:e.end,t0:e.end,t1:e.end,tI:-2,next:k,rs:[],rsm:this.rsm,log:r&&r.log||void 0,F:x.make_src_format(c),use:{}};null!=s&&(a=x.deep(a,s)),x.make_log(a);let u=e=>x.token(e,this.config),h=x.wrap_bad_lex(e.start(a),x.token("#BD",this.config),a),g=new m(this.rsm.val,a);l=g;let b=2*Object.keys(this.rsm).length*h.src.length*2*i.rule.maxmul;function k(e=!0){let n;a.u2=a.u1,a.u1=a.t0,a.t0=a.t1;do{n=h(g),a.tI++}while(e&&c.tokenset.IGNORE[n.pin]);return a.t1={...n},a.t0}k(),k();let v=0;for(;f!==g&&v<b;)a.log&&a.log("rule",g.name+"/"+g.id,d[g.state],a.rs.length,a.tI,"["+u(a.t0.pin)+" "+u(a.t1.pin)+"]","["+a.F(a.t0.src)+" "+a.F(a.t1.src)+"]",g,a),g=g.process(a),a.log&&a.log("stack",a.rs.length,a.rs.map(e=>e.name+"/"+e.id).join(";"),g,a),v++;if(x.token("#ZZ",this.config)!==a.t0.pin)throw new p(o,{},a.t0,f,a);return l.node}clone(e,n){let t=new _(e,n);return t.rsm=Object.keys(this.rsm).reduce((e,n)=>(e[n]=x.clone(this.rsm[n]),e),{}),t}}e.exports.Parser=_;let x={token:function(e,n,r){let o=n.token,s=o[e];return null==s&&t===typeof e&&(s=n.tokenI++,o[s]=e,o[e]=s,o[e.substring(1)]=s,null!=r&&Object.assign(r.token,n.token)),s},deep:function(e,...t){let o=r===typeof e,s=null!=e&&(n===typeof e||o);for(let l of t){let t=r===typeof l,i=null!=l&&(n===typeof l||t);if(s&&i&&!t&&Array.isArray(e)===Array.isArray(l))for(let n in l)e[n]=x.deep(e[n],l[n]);else e=void 0===l?e:t?l:i?x.deep(Array.isArray(l)?[]:{},l):l,o=r===typeof e,s=null!=e&&(n===typeof e||o)}return e},clone:function(e){return x.deep(Object.create(Object.getPrototypeOf(e)),e)},charset:(...e)=>e.map(e=>"object"==typeof e?Object.keys(e).join(""):e).join("").split("").reduce((e,n)=>(e[n]=n.charCodeAt(0),e),{}),longest:e=>e.reduce((e,n)=>e<n.length?n.length:e,0),marr:(e,n)=>e.length===n.length&&e.reduce((e,t,r)=>e&&t===n[r],!0),clean_stack(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))},make_src_format:e=>(n,t)=>null==n?"":(t=JSON.stringify(n)).substring(0,e.debug.maxlen)+(e.debug.maxlen<t.length?"...":""),make_log:e=>{if("number"==typeof e.log){let t=!1,r=e.log;-1===r&&(r=1,t=!0),e.log=(...o)=>{if(t){let t=o.filter(e=>n!=typeof e).join("\t");e.options.debug.get_console().log(t)}else e.options.debug.get_console().dir(o,{depth:r})}}return e.log},wrap_bad_lex:(e,n,t)=>{let r=r=>{let s=e(r);if(n===s.pin){let e={};throw null!=s.use&&(e.use=s.use),new p(s.why||o,e,s,r,t)}return s};return r.src=e.src,r},errinject:(e,n,t,r,o,s)=>e.replace(/\$([\w_]+)/g,(e,l)=>JSON.stringify("code"===l?n:t[l]||s.meta[l]||r[l]||o[l]||s[l]||s.options[l]||s.config[l]||"$"+l)),extract:(e,n,t)=>{let r=0<t.loc?t.loc:0,o=0<t.row?t.row:0,s=0<t.col?t.col:0,l=null==t.src?"":t.src,i=e.substring(Math.max(0,r-333),r).split("\n"),c=e.substring(r,r+333).split("\n"),a=2+(""+(o+2)).length,u=o<2?0:o-2,p=e=>"\x1b[34m"+(""+u++).padStart(a," ")+" | \x1b[0m"+(null==e?"":e),h=i.length;return[2<h?p(i[h-3]):null,1<h?p(i[h-2]):null,p(i[h-1]+c[0])," ".repeat(a)+"   "+" ".repeat(s)+"\x1b[31m"+"^".repeat(l.length||1)+" "+n+"\x1b[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")},handle_meta_mode:(e,n,t)=>{let o=e.options;if(r!==typeof o.mode[t.mode])return[!1];try{return o.mode[t.mode].call(e,n,t)}catch(s){if("SyntaxError"===s.name){let r=0,l=0,i=0,c="",a=s.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(a){c=a[1],r=parseInt(a[2]),l=n.substring(0,r).replace(/[^\n]/g,"").length;let e=r-1;for(;-1<e&&"\n"!==n.charAt(e);)e--;i=e<r?n.substring(e,r).length-1:0}let u=s.token||{pin:e.token.UK,loc:r,len:c.length,row:s.lineNumber||l,col:s.columnNumber||i,val:void 0,src:c};throw new p(s.code||"json",s.details||{msg:s.message},u,{},s.ctx||{rI:-1,options:o,config:{token:{}},token:{},meta:t,src:()=>n,root:()=>{},plugins:()=>[],node:void 0,u2:u,u1:u,t0:u,t1:u,tI:-1,rs:[],next:()=>u,rsm:{},n:{},log:t.log,F:x.make_src_format(e.internal().config),use:{}})}throw s}},make_error_desc(e,n,t,o,s){t={...t};let l=s.options,i=s.meta,c=x.errinject(l.error[e]||l.error.unknown,e,n,t,o,s);r===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let a=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+(i&&i.mode?"\x1b[35m[mode:"+i.mode+"]:\x1b[0m ":"")+c,"  \x1b[34m--\x3e\x1b[0m "+(i&&i.fileName||"<no-file>")+":"+t.row+":"+t.col,x.extract(s.src(),c,t),x.errinject((l.hint[e]||l.hint.unknown).split("\n").map((e,n)=>(0===n?" ":"  ")+e).join("\n"),e,n,t,o,s),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+o.name+"~"+d[o.state]+"; token="+s.config.token[t.pin]+"; plugins="+s.plugins().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:t,ctx:s}};return{...Object.create(u),message:a,code:e,details:n,meta:i,fileName:i?i.fileName:void 0,lineNumber:t.row,columnNumber:t.col}},build_config_from_options:function(e,n){let r=Object.keys(n.token);r.forEach(n=>x.token(n,e));let o=r.filter(e=>null!=n.token[e].c);e.singlemap=o.reduce((t,r)=>(t[n.token[r].c]=e.token[r],t),{});let s=r.filter(e=>t===typeof n.token[e]);e.start=s.reduce((t,r)=>(t[r.substring(1)]=n.token[r].split("").reduce((n,t)=>(n[t]=e.token[r],n),{}),t),{}),e.multi=s.reduce((t,r)=>(t[r.substring(1)]=n.token[r].split("").reduce((n,t)=>(n[t]=e.token[r],n),{}),t),{});let l=r.filter(e=>null!=n.token[e].s);if(e.tokenset=l.reduce((t,r)=>(t[r.substring(1)]=n.token[r].s.split(",").reduce((n,t)=>(n[e.token[t]]=t,n),{}),t),{}),e.charset={},e.string={escape:Object.keys(n.string.escape).reduce((e,t)=>(e[t]=n.string.escape[t],e),{})},e.charset.start_commentmarker={},e.charset.cm_single={},e.cmk=[],e.cmk0="",e.cmk1="",n.comment){let t=Object.keys(n.comment);t.forEach(n=>{1===n.length?(e.charset.start_commentmarker[n]=n.charCodeAt(0),e.charset.cm_single[n]=n.charCodeAt(0)):(e.charset.start_commentmarker[n[0]]=n.charCodeAt(0),e.cmk.push(n),e.cmk0+=n[0],e.cmk1+=n[1])}),e.cmk_maxlen=x.longest(t)}e.single_char=Object.keys(e.singlemap).join(""),e.charset.digital=x.charset(n.number.digital),e.charset.multiline=x.charset(n.string.multiline),e.charset.value_ender=x.charset(e.multi.SP,e.multi.LN,e.single_char,e.charset.start_commentmarker),e.charset.text_ender=e.charset.value_ender,e.charset.hoover_ender=x.charset(e.multi.LN,e.single_char,e.charset.start_commentmarker),e.charset.start_blockmarker={},e.bmk=[];let i=Object.keys(n.string.block);i.forEach(n=>{e.charset.start_blockmarker[n[0]]=n.charCodeAt(0),e.bmk.push(n)}),e.bmk_maxlen=x.longest(i),e.lex={core:{LN:x.token(n.lex.core.LN,e)}},e.number={sep_re:null!=n.number.sep?new RegExp(n.number.sep,"g"):null},e.debug=n.debug,Object.keys(n.config.modify).forEach(t=>n.config.modify[t](e,n)),n.debug.print_config&&console.log(e)}};function y(e,r){let o,s,l,i,c=x.deep({},r?{...r.options}:{char:{row:"\n",bad_unicode:String.fromCharCode("0x0000")},comment:{"#":!0,"//":!0,"/*":"*/"},balance:{comment:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},string:{escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",block:{"'''":"'''"},escapedouble:!1},text:{hoover:!0,endofline:!1},object:{extend:!0},value:{null:null,true:!0,false:!1},mode:{},plugin:{},debug:{get_console:()=>console,maxlen:33,print_config:!1},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:w,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},lex:{core:{LN:"#LN"}},rule:{maxmul:3},config:{modify:{}}},e||{}),a=function(e,n,r){if(t===typeof e){let t=a.internal(),[o,s]=null!=n&&null!=n.mode?x.handle_meta_mode(a,e,n):[!1];return o||(s=t.parser.start(t.lexer,e,a,n,r)),s}return e},u={token:function(e){return x.token(e,l,a)},options:x.deep(e=>{if(null!=e&&n===typeof e){x.build_config_from_options(l,x.deep(c,e));for(let e in c)a.options[e]=c[e]}},c),parse:a,use:function(e,n){return a.options({plugin:{[e.name]:n||{}}}),a.internal().plugins.push(e),e(a)||a},rule:function(e,n){return a.internal().parser.rule(e,n)},lex:function(e,n){return a.internal().lexer.lex(e,n)},make:function(e){return y(e,a)}};if(Object.defineProperty(u.make,"name",{value:"make"}),Object.assign(u,{internal:()=>({lexer:o,parser:s,config:l,plugins:i})}),r){for(let n in r)a[n]=r[n];a.parent=r;let e=r.internal();l=x.deep({},e.config),x.build_config_from_options(l,c),Object.assign(a.token,l.token),i=[...e.plugins],o=e.lexer.clone(l),s=e.parser.clone(c,l)}else l={tokenI:1,token:{}},x.build_config_from_options(l,c),i=[],o=new h(l),(s=new _(c,l)).init();return Object.assign(a,u),Object.assign(a.token,l.token),a}function w(e=((e,n="replace")=>e[n](/[A-Z]/g,e=>" "+e.toLowerCase())[n](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),n="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcShouldNotOccurAtThisPointAsItIsNot\nvalid %j%s%o%nSyntax,EvenUnderTheRelaxedJsonicRules.~ifItIs\nnotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsOrModesYouAre\nusingExpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((t,r,o)=>(t[r]=e(n[o]),t),{})}e.exports.util=x,e.exports.make=y;let C=y();return e.exports.Jsonic=C,C.use=()=>{throw new Error("Jsonic.use cannot be called directly. Instead write: `Jsonic.make().use(...)`.")},C.Jsonic=C,C.JsonicError=p,C.Lexer=h,C.Parser=_,C.Rule=m,C.RuleSpec=v,C.util=x,C.make=y,e.exports.default=C,e.exports=e.exports.Jsonic,e=e.exports}));