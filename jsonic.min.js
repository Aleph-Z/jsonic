!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const t="object",n="string",r="function",s="unexpected",o="map",l="list",i="elem",a="pair",c="val",u="node",p="";class h extends SyntaxError{constructor(e,t,n,r,s){t=y.deep({},t);let o=y.deep({},{rI:s.rI,options:s.options,config:s.config,meta:s.meta,src:()=>s.src(),plugins:()=>s.plugins(),node:s.node,t0:s.t0,t1:s.t1,tI:s.tI,log:s.log,use:s.use}),l=y.make_error_desc(e,t,n,r,o);super(l.message),Object.assign(this,l),y.clean_stack(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=h;class m{constructor(e){this.match={},y.token("@LTP",e),y.token("@LTX",e),y.token("@LCS",e),y.token("@LML",e),this.end={tin:y.token("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const t=e.options,n=e.config;let r=e=>y.token(e,n),s=e=>y.token(e,n),o=e.F,l=r("@LTP"),i=r("@LTX"),a=r("@LCS"),c=r("@LML"),u=r("#ZZ"),h=r("#SP"),m=r("#CM"),d=r("#NR"),f=r("#ST"),g=r("#TX"),b=r("#VL"),k=r("#LN"),_={tin:u,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},v=0,x=0,w=0,S=l,C=e.src(),j=C.length,I=null!=e.log?(...t)=>e.log("lex",s(_.tin),o(_.src),v,x+":"+w,s(S),{..._},...t):void 0,N=this;function O(t,n,r,s){return N.bad(e,I,t,_,v,n,x,w,r,r,s)}function A(t){let n=N.match[S];if(null!=n){_.loc=v;for(let r of n){let n=r({sI:v,rI:x,cI:w,src:C,token:_,ctx:e,rule:t,bad:O});if(n)return v=n.sI?n.sI:v,x=n.rI?n.rI:x,w=n.cI?n.cI:w,S=null==n.state?S:n.state,I&&I(_,r),_}}}let E=function(e){_.len=0,_.val=void 0,_.src=void 0,_.row=x,_.use=void 0;let r=null,s={},o=0,N=[];e:for(;v<j;){let u=C[v];if(l!==S){if(i===S){if(A(e))return _;let r=t.text.hoover?n.charset.hoover_ender:n.charset.text_ender;for(;null!=C[o]&&(!r[C[o]]||n.cmk0.includes(C[o])&&!n.cmk1.includes(C[o+1]));)w++,o++;if(_.len=o-v,_.tin=g,_.val=C.substring(v,o),_.src=_.val,t.text.hoover&&n.multi.SP[_.val[_.val.length-1]]){let e=_.val.length-2;for(;0<e&&n.multi.SP[_.val[e]];)e--;_.val=_.val.substring(0,e+1),_.src=_.val,w-=_.len-e-1,_.len=_.val.length,v+=_.len}else v=o;return S=l,I&&I(_),_}if(a===S){if(A(e))return _;for(o=v;o<j&&!s[C[o]];)o++,w++;return _.val+=C.substring(v,o),_.src=_.val,_.len=_.val.length,v=o,S=l,I&&I(_),_}if(c===S){if(A(e))return _;o=v;let s=1,i=r[0],a=r[1],c=t.balance[r[2]],u=!!r[3],h="",m=0,d=i.length,f=a.length;if(u){let e=v-1;for(;-1<e&&n.multi.SP[C[e]];)e--;0<(m=v-e-1)&&(h=Object.keys(n.multi.SP)[0].repeat(m))}for(o+=i.length;o<j&&0<s;)a[0]===C[o]&&a===C.substring(o,o+f)?(o+=f,w+=f,s--):c&&i[0]===C[o]&&i===C.substring(o,o+d)?(o+=d,w+=f,s++):(t.char.row===C[o]?(x++,w=0):w++,o++);if(_.val=C.substring(v,o),_.src=_.val,_.len=_.val.length,u){_.val=_.val.substring(d,_.val.length-f),null==n.re.block_prefix&&(n.re.block_prefix=y.regexp(p,"^[","%"+t.token["#SP"],"]*","(",t.char.line_sep_RES,")")),_.val=_.val.replace(n.re.block_prefix,""),null==n.re.block_suffix&&(n.re.block_suffix=y.regexp(p,t.char.line_sep_RES,"[","%"+t.token["#SP"],"]*$")),_.val=_.val.replace(n.re.block_suffix,"");let e=n.re["block_indent_"+h]=n.re["block_indent_"+h]||y.regexp("g","^(","%"+h,")|(","(",t.char.line_sep_RES,")","%"+h,")");_.val=_.val.replace(e,"$3")}return v=o,S=l,I&&I(_),_}return O("invalid_lex_state",v,C[v],{state:S})}{if(A(e))return _;if(n.start.SP[u]){for(_.tin=h,_.loc=v,_.col=w++,o=v+1;n.multi.SP[C[o]];)w++,o++;return _.len=o-v,_.val=C.substring(v,o),_.src=_.val,v=o,I&&I(_),_}if(n.start.LN[u]){for(_.tin=k,_.loc=v,_.col=w,o=v,w=0;n.multi.LN[C[o]];)x+=t.char.row===C[o]?1:0,o++;return _.len=o-v,_.val=C.substring(v,o),_.src=_.val,v=o,I&&I(_),_}if(null!=n.singlemap[u])return _.tin=n.singlemap[u],_.loc=v,_.col=w++,_.len=1,_.src=u,v++,I&&I(_),_;if(t.number&&n.start.NR[u]&&n.number.lex){for(_.tin=d,_.loc=v,_.col=w,o=v;n.charset.digital[C[++o]];);let e=C.substring(v,o);if(null==C[o]||n.charset.value_ender[C[o]]){_.len=o-v;let t=C[v+1];!(1<_.len&&"0"===C[v]&&"."!==C[v+1])||n.number.hex&&"x"===t||n.number.oct&&"o"===t||n.number.bin&&"b"===t?(_.val=+e,null!=n.number.sep_RE&&isNaN(_.val)&&(_.val=+e.replace(n.number.sep_RE,"")),isNaN(_.val)&&(_.val=void 0,o--)):(_.val=void 0,o--)}if(null!=_.val)return _.src=e,w+=_.len,v=o,I&&I(_),_}if(n.charset.start_blockmarker[u]){let e=C.substring(v,v+n.bmk_maxlen);for(let s of n.bmk)if(e.startsWith(s)){_.tin=f,_.loc=v,_.col=w,S=c,r=[s,t.string.block[s],null,!0];continue e}}if(n.start.ST[u]){_.tin=f,_.loc=v,_.col=w++;let e=n.charset.multiline[u];N=[];let r="";for(o=v+1;o<j;o++)if(w++,u===(r=C[o])){if(!t.string.escapedouble||u!==C[o+1]){o++;break}N.push(C[o]),o++}else if("\\"===r){o++,w++;let e=n.string.escape[C[o]];if(null!=e)N.push(e);else if("x"===C[o]){o++;let e=parseInt(C.substring(o,o+2),16);if(isNaN(e))return v=o-2,w-=2,O("invalid_ascii",o+2,C.substring(o-2,o+2));let t=String.fromCharCode(e);N.push(t),o+=1,w+=2}else if("u"===C[o]){let e="{"===C[++o]?(o++,1):0,t=e?6:4,n=parseInt(C.substring(o,o+t),16);if(isNaN(n))return v=o-2-e,w-=2,O("invalid_unicode",o+t+1,C.substring(o-2-e,o+t+e));let r=String.fromCodePoint(n);N.push(r),o+=t-1+e,w+=t+e}else N.push(C[o])}else{let s=o,l=u.charCodeAt(0),i="\\".charCodeAt(0),a=C.charCodeAt(o);for(;o<j&&32<=a&&l!==a&&i!==a;)a=C.charCodeAt(++o),w++;if(w--,r=C[o],a<32){if(!e||!n.start.LN[r])return O("unprintable",o,"char-code="+C[o].charCodeAt(0));r===t.char.row&&(x++,w=0),N.push(C.substring(s,o+1))}else N.push(C.substring(s,o)),o--}return u!==r?O("unterminated",o,N.join("")):(_.val=N.join(""),_.src=C.substring(v,o),_.len=o-v,v=o,I&&I(_),_)}if(n.charset.start_commentmarker[u]){let e=C.substring(v,v+n.cmk_maxlen);for(let t of n.cmk)if(e.startsWith(t)){if(!0!==n.comment[t]){_.tin=m,_.loc=v,_.col=w,_.val="",S=c,r=[t,n.comment[t],"comment"];continue e}break}_.tin=m,_.loc=v,_.col=w,_.val="",S=a,s=n.multi.LN;continue e}_.loc=v,_.col=w,o=v;do{w++,o++}while(null!=C[o]&&!n.charset.value_ender[C[o]]);let l=C.substring(v,o),p=t.value[l];if(void 0!==p)return _.tin=b,_.val=p,_.src=l,_.len=o-v,v=o,I&&I(_),_;S=i}}return _.tin=u,_.loc=j,_.col=w,I&&I(_),_};return E.src=C,E}bad(e,t,n,r,s,o,l,i,a,c,u){return r.why=n,r.tin=y.token("#BD",e.config),r.loc=s,r.row=l,r.col=i,r.len=o-s,r.val=a,r.src=c,r.use=u,t&&t(y.token(r.tin,e.config),e.F(r.src),s,l+":"+i,{...r},"error",n),r}lex(e,t){if(null==e)return this.match;let n=this.match[e];return null!=t?(null==n&&(n=this.match[e]=[]),n.push(t)):null===t&&(n=this.match[e],delete this.match[e]),n}clone(e){let t=new m(e);return y.deep(t.match,this.match),t}}var d;e.exports.Lexer=m,function(e){e[e.open=0]="open",e[e.close=1]="close"}(d||(d={}));class f{constructor(e,t,n){this.id=t.rI++,this.name=e.name,this.spec=e,this.node=n,this.state=d.open,this.child=g,this.open=[],this.close=[],this.n={}}process(e){let t=g;return d.open===this.state?t=this.spec.open(this,e):d.close===this.state&&(t=this.spec.close(this,e)),t}}e.exports.Rule=f;let g={id:0,spec:{name:"norule"}};class b{constructor(){this.m=[],this.p="",this.r="",this.b=0,this.n=null,this.h=null}}const k=new b,_=new b;class v{constructor(e){function t(e){if(null!=e.c&&e.c.n){let t=e.c.n;e.c=(e,n,r)=>{let s=!0;for(let o in t)s=s&&(null==n.n[o]||n.n[o]<=t[o]);return s}}"string"==typeof e.g&&(e.g=e.g.split(/\s*,\s*/))}this.name="-",this.def=e,this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let n of[...this.def.open,...this.def.close])t(n)}open(e,t){let n,r=e,o="",l=t.F;this.def.before_open&&(n=this.def.before_open.call(this,e,t),e.node=n&&n.node||e.node);let i=n&&n.alt?{..._,...n.alt}:0<this.def.open.length?this.parse_alts(this.def.open,e,t):_;if(i.e)throw new h(s,{open:!0},i.e,e,t);if(e.open=i.m,i.n)for(let s in i.n)e.n[s]=0===i.n[s]?0:(null==e.n[s]?0:e.n[s])+i.n[s],e.n[s]=0<e.n[s]?e.n[s]:0;return i.p?(t.rs.push(e),(r=e.child=new f(t.rsm[i.p],t,e.node)).parent=e,r.n={...e.n},o+="U"):i.r?((r=new f(t.rsm[i.r],t,e.node)).parent=e.parent,r.n={...e.n},o+="R"):o+="Z",this.def.after_open&&this.def.after_open.call(this,e,t,r),t.log&&t.log(u,e.name+"/"+e.id,d[e.state],"w="+o,l(e.node)),e.state=d.close,r}close(e,t){let n,r=g,o="";if(this.def.before_close){if((n=this.def.before_close.call(this,e,t,r))&&n.err)throw new h(n.err,{...n,close:!0},t.t0,e,t);e.node=n&&n.node||e.node}let l=n&&n.alt?{..._,...n.alt}:0<this.def.close.length?this.parse_alts(this.def.close,e,t):_;if(l.e)throw new h(s,{close:!0},l.e,e,t);if(l.n)for(let s in l.n)e.n[s]=0===l.n[s]?0:(null==e.n[s]?0:e.n[s])+l.n[s],e.n[s]=0<e.n[s]?e.n[s]:0;return l.h&&(r=l.h(this,e,t,r)||r,o+="H"),l.p?(t.rs.push(e),(r=e.child=new f(t.rsm[l.p],t,e.node)).parent=e,r.n={...e.n},o+="U"):l.r?((r=new f(t.rsm[l.r],t,e.node)).parent=e.parent,r.n={...e.n},o+="R"):(r=t.rs.pop()||g,o+="O"),this.def.after_close&&this.def.after_close.call(this,e,t,r),r.why=o,t.log&&t.log(u,e.name+"/"+e.id,d[e.state],"w="+o,t.F(e.node)),r}parse_alts(e,t,n){let r,s=k;s.m=[],s.b=0,s.p="",s.r="",s.n=void 0,s.h=void 0,s.e=void 0;let o,l=0,i=n.config.token;for(l=0;l<e.length;l++){if(o=(o=!(!(o=!(r=e[l]).c||r.c(r,t,n))||null!=r.d)||r.d===n.rs.length)&&(null==r.a||y.marr(r.a,n.rs.slice(-r.a.length).map(e=>e.name).reverse()))){if(null==r.s||0===r.s.length){s.e=r.e&&r.e(r,t,n)||void 0;break}if(r.s[0]===n.t0.tin){if(1===r.s.length){s.m=[n.t0],s.e=r.e&&r.e(r,t,n)||void 0;break}if(r.s[1]===n.t1.tin){s.m=[n.t0,n.t1],s.e=r.e&&r.e(r,t,n)||void 0;break}}else if(i.AA===r.s[0]){s.m=[n.t0],s.e=r.e&&r.e(r,t,n)||void 0;break}}r=null}null==r&&i.ZZ!==n.t0.tin&&(s.e=n.t0),null!=r&&(s.b=r.b?r.b:s.b,s.p=r.p?r.p:s.p,s.r=r.r?r.r:s.r,s.n=r.n?r.n:s.n,s.h=r.h?r.h:s.h),n.log&&n.log("parse",t.name+"/"+t.id,d[t.state],l<e.length?"alt="+l:"no-alt",l<e.length&&r&&r.s?"["+r.s.map(e=>i[e]).join(" ")+"]":"[]",n.tI,"p="+(s.p||""),"r="+(s.r||""),"b="+(s.b||""),s.m.map(e=>i[e.tin]).join(" "),n.F(s.m.map(e=>e.src)),"c:"+(r&&r.c?o:""),"n:"+Object.entries(t.n).join(";"),s);let a=0,c=s.m.length-(s.b||0);for(;a++<c;)n.next();return s}}e.exports.RuleSpec=v;class x{constructor(e,t){this.rsm={},this.options=e,this.config=t}init(){let e=this.config.token,t=e.OB,n=e.CB,r=e.OS,s=e.CS,u=e.CL,p=e.CA,h=e.TX,m=e.NR,d=e.ST,f=e.VL,g=e.AA,b=e.ZZ,k=(e,t,n)=>{if(!this.options.rule.finish)return n.t0.src="END-OF-FILE",n.t0},_={val:{open:[{s:[t,p],p:o,n:{im:0},g:"imp,map"},{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[p],d:0,p:l,b:1,g:"imp,list"},{s:[p],b:1,g:"imp,list"},{s:[h,u],p:o,b:2,n:{im:1},g:"imp,map"},{s:[d,u],p:o,b:2,n:{im:1},g:"imp,map"},{s:[m,u],p:o,b:2,n:{im:1},g:"imp,map"},{s:[f,u],p:o,b:2,n:{im:1},g:"imp,map"},{s:[h]},{s:[m]},{s:[d]},{s:[f]},{s:[n],a:[a],b:1,g:"imp,null"},{s:[s],a:[a],b:1,g:"imp,null"}],close:[{s:[p],d:0,r:i,h:(e,t,n)=>{t.node=[t.node]},g:"imp,list"},{c:(e,t,n)=>(h===n.t0.tin||m===n.t0.tin||d===n.t0.tin||f===n.t0.tin)&&0===n.rs.length,r:i,h:(e,t,n)=>{t.node=[t.node]},g:"imp,list"},{s:[g],b:1}],before_close:e=>{e.node=void 0===e.child.node?null==e.open[0]?void 0:e.open[0].val:e.child.node}},map:{before_open:()=>({node:{}}),open:[{s:[n]},{p:a}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[s]},{p:i}],close:[]},pair:{open:[{s:[d,u],p:c},{s:[h,u],p:c},{s:[m,u],p:c},{s:[f,u],p:c},{s:[n],b:1}],close:[{s:[n]},{s:[p],c:{n:{im:1}},r:a},{s:[p],n:{im:-1},b:1},{s:[d,u],c:{n:{im:1}},r:a,b:2},{s:[h,u],c:{n:{im:1}},r:a,b:2},{s:[m,u],c:{n:{im:1}},r:a,b:2},{s:[f,u],c:{n:{im:1}},r:a,b:2},{s:[d,u],n:{im:-1},b:2},{s:[h,u],n:{im:-1},b:2},{s:[m,u],n:{im:-1},b:2},{s:[f,u],n:{im:-1},b:2},{s:[s],a:[o,c,i],b:1},{s:[b],e:k,g:"end"}],before_close:(e,t)=>{let r=e.open[0];if(r&&n!==r.tin){let n=d===r.tin?r.val:r.src,s=e.child.node,o=e.node[n];void 0===s&&u===t.u1.tin&&(s=null),e.node[n]=null==o?s:t.options.map.extend?y.deep(o,s):s}}},elem:{open:[{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[p,p],b:2,g:"null"},{s:[p],g:"null"},{p:c,n:{im:1}}],close:[{s:[p,s]},{s:[p],r:i},{s:[s]},{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[h,u],p:o,n:{im:0},b:2},{s:[m,u],p:o,n:{im:0},b:2},{s:[d,u],p:o,n:{im:0},b:2},{s:[f,u],p:o,n:{im:0},b:2},{s:[h],r:i,b:1},{s:[m],r:i,b:1},{s:[d],r:i,b:1},{s:[f],r:i,b:1},{s:[b],e:k,g:"end"}],after_open:(e,t,n)=>{e===n&&e.open[0]&&e.node.push(null)},before_close:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(_).reduce((e,t)=>(e[t]=new v(_[t]),e[t].name=t,e),{})}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];return null===t?delete this.rsm[e]:void 0!==t&&((n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e),n}start(e,t,n,r,o){let l,i=this.options,a=this.config,c={rI:1,options:i,config:a,meta:r||{},src:()=>t,root:()=>l.node,plugins:()=>n.internal().plugins,rule:g,node:void 0,u2:e.end,u1:e.end,t0:e.end,t1:e.end,tI:-2,next:k,rs:[],rsm:this.rsm,log:r&&r.log||void 0,F:y.make_src_format(a),use:{}};null!=o&&(c=y.deep(c,o)),y.make_log(c);let u=e=>y.token(e,this.config),p=y.wrap_bad_lex(e.start(c),y.token("#BD",this.config),c),m=new f(this.rsm.val,c);l=m;let b=2*Object.keys(this.rsm).length*p.src.length*2*i.rule.maxmul;function k(){let e;c.u2=c.u1,c.u1=c.t0,c.t0=c.t1;do{e=p(m),c.tI++}while(a.tokenset.IGNORE[e.tin]);return c.t1={...e},c.t0}k(),k();let _=0;for(;g!==m&&_<b;)c.log&&c.log("rule",m.name+"/"+m.id,d[m.state],c.rs.length,c.tI,"["+u(c.t0.tin)+" "+u(c.t1.tin)+"]","["+c.F(c.t0.src)+" "+c.F(c.t1.src)+"]",m,c),c.rule=m,m=m.process(c),c.log&&c.log("stack",c.rs.length,c.rs.map(e=>e.name+"/"+e.id).join(";"),m,c),_++;if(y.token("#ZZ",this.config)!==c.t0.tin)throw new h(s,{},c.t0,g,c);return l.node}clone(e,t){let n=new x(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=y.clone(this.rsm[t]),e),{}),n}}e.exports.Parser=x;let y={token:function(e,t,r){let s=t.token,o=s[e];return null==o&&n===typeof e&&(o=t.tokenI++,s[o]=e,s[e]=o,s[e.substring(1)]=o,null!=r&&Object.assign(r.token,t.token)),o},deep:function(e,...n){let s=r===typeof e,o=null!=e&&(t===typeof e||s);for(let l of n){let n=r===typeof l,i=null!=l&&(t===typeof l||n);if(o&&i&&!n&&Array.isArray(e)===Array.isArray(l))for(let t in l)e[t]=y.deep(e[t],l[t]);else e=void 0===l?e:n?l:i?y.deep(Array.isArray(l)?[]:{},l):l,s=r===typeof e,o=null!=e&&(t===typeof e||s)}return e},clone:function(e){return y.deep(Object.create(Object.getPrototypeOf(e)),e)},charset:(...e)=>e.map(e=>"object"==typeof e?Object.keys(e).join(""):e).join("").split("").reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{}),longest:e=>e.reduce((e,t)=>e<t.length?t.length:e,0),marr:(e,t)=>e.length===t.length&&e.reduce((e,n,r)=>e&&n===t[r],!0),clean_stack(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))},make_src_format:e=>(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.debug.maxlen)+(e.debug.maxlen<n.length?"...":""),make_log:e=>{if("number"==typeof e.log){let n=!1,s=e.log;-1===s&&(s=1,n=!0),e.log=(...o)=>{if(n){let n=o.filter(e=>t!=typeof e).map(e=>r==typeof e?e.name:e).join("\t");e.options.debug.get_console().log(n)}else e.options.debug.get_console().dir(o,{depth:s})}}return e.log},wrap_bad_lex:(e,t,n)=>{let r=r=>{let o=e(r);if(t===o.tin){let e={};throw null!=o.use&&(e.use=o.use),new h(o.why||s,e,o,r,n)}return o};return r.src=e.src,r},regexp:(e,...t)=>new RegExp(t.map(e=>"%"===e[0]?e.substring(1).replace(/./g,"\\$&"):e).join(""),e),errinject:(e,t,n,r,s,o)=>e.replace(/\$([\w_]+)/g,(e,l)=>JSON.stringify("code"===l?t:n[l]||(o.meta?o.meta[l]:void 0)||r[l]||s[l]||o[l]||o.options[l]||o.config[l]||"$"+l)),extract:(e,t,n)=>{let r=0<n.loc?n.loc:0,s=0<n.row?n.row:0,o=0<n.col?n.col:0,l=null==n.src?"":n.src,i=e.substring(Math.max(0,r-333),r).split("\n"),a=e.substring(r,r+333).split("\n"),c=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"\x1b[34m"+(""+u++).padStart(c," ")+" | \x1b[0m"+(null==e?"":e),h=i.length;return[2<h?p(i[h-3]):null,1<h?p(i[h-2]):null,p(i[h-1]+a[0])," ".repeat(c)+"   "+" ".repeat(o)+"\x1b[31m"+"^".repeat(l.length||1)+" "+t+"\x1b[0m",p(a[1]),p(a[2])].filter(e=>null!=e).join("\n")},wrap_parser:e=>({start:function(t,n,r,s,o){try{return e.start(t,n,r,s,o)}catch(l){if("SyntaxError"===l.name){let e=0,t=0,o=0,i="",a=l.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(a){i=a[1],e=parseInt(a[2]),t=n.substring(0,e).replace(/[^\n]/g,"").length;let r=e-1;for(;-1<r&&"\n"!==n.charAt(r);)r--;o=Math.max(n.substring(r,e).length,0)}let c=l.token||{tin:r.token.UK,loc:e,len:i.length,row:l.lineNumber||t,col:l.columnNumber||o,val:void 0,src:i};throw new h(l.code||"json",l.details||{msg:l.message},c,{},l.ctx||{rI:-1,options:r.options,config:{token:{}},token:c,meta:s,src:()=>n,root:()=>{},plugins:()=>r.internal().plugins,rule:g,node:void 0,u2:c,u1:c,t0:c,t1:c,tI:-1,rs:[],next:()=>c,rsm:{},n:{},log:s?s.log:void 0,F:y.make_src_format(r.internal().config),use:{}})}throw l}}}),make_error_desc(e,t,n,s,o){n={...n};let l=o.options,i=o.meta,a=y.errinject(l.error[e]||l.error.unknown,e,t,n,s,o);r===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let c=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+a,"  \x1b[34m--\x3e\x1b[0m "+(i&&i.fileName||"<no-file>")+":"+n.row+":"+n.col,y.extract(o.src(),a,n),y.errinject((l.hint[e]||l.hint.unknown).replace(/^([^ ])/," $1").split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,s,o),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+s.name+"~"+d[s.state]+"; token="+o.config.token[n.tin]+"; plugins="+o.plugins().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:o}};return{...Object.create(u),message:c,code:e,details:t,meta:i,fileName:i?i.fileName:void 0,lineNumber:n.row,columnNumber:n.col}},build_config_from_options:function(e,t){let r=Object.keys(t.token);r.forEach(t=>y.token(t,e));let s=r.filter(e=>null!=t.token[e].c);e.singlemap=s.reduce((n,r)=>(n[t.token[r].c]=e.token[r],n),{});let o=r.filter(e=>n===typeof t.token[e]);e.start=o.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.token[r],t),{}),n),{}),e.multi=o.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.token[r],t),{}),n),{});let l=r.filter(e=>null!=t.token[e].s);if(e.tokenset=l.reduce((n,r)=>(n[r.substring(1)]=t.token[r].s.split(",").reduce((t,n)=>(t[e.token[n]]=n,t),{}),n),{}),e.charset={},e.string={escape:Object.keys(t.string.escape).reduce((e,n)=>(e[n]=t.string.escape[n],e),{})},e.charset.start_commentmarker={},e.charset.cm_single={},e.cmk=[],e.cmk0="",e.cmk1="",t.comment){e.comment=t.comment;let n=Object.keys(t.comment);n.forEach(t=>{1===t.length?(e.charset.start_commentmarker[t]=t.charCodeAt(0),e.charset.cm_single[t]=t.charCodeAt(0)):(e.charset.start_commentmarker[t[0]]=t.charCodeAt(0),e.cmk.push(t),e.cmk0+=t[0],e.cmk1+=t[1])}),e.cmk_maxlen=y.longest(n)}e.single_char=Object.keys(e.singlemap).join(""),e.charset.digital=y.charset(t.number.digital||""),e.charset.multiline=y.charset(t.string.multiline),e.charset.value_ender=y.charset(e.multi.SP,e.multi.LN,e.single_char,e.charset.start_commentmarker),e.charset.text_ender=e.charset.value_ender,e.charset.hoover_ender=y.charset(e.multi.LN,e.single_char,e.charset.start_commentmarker),e.charset.start_blockmarker={},e.bmk=[];let i=Object.keys(t.string.block);i.forEach(t=>{e.charset.start_blockmarker[t[0]]=t.charCodeAt(0),e.bmk.push(t)}),e.bmk_maxlen=y.longest(i),e.number={...!1!==t.number?t.number:{},sep_RE:null!=t.number.sep?new RegExp(t.number.sep,"g"):null},e.re={},e.debug=t.debug,Object.keys(t.config.modify).forEach(n=>t.config.modify[n](e,t)),t.debug.print_config&&t.debug.get_console().dir(e,{depth:null})}};function w(e,r){let s,o,l,i,a=y.deep({},r?{...r.options}:{char:{row:"\n",line_sep_RES:"\r*\n",bad_unicode:String.fromCharCode("0x0000")},comment:{"#":!0,"//":!0,"/*":"*/"},balance:{comment:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},string:{escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",block:{"'''":"'''"},escapedouble:!1},text:{hoover:!0,endofline:!1},map:{extend:!0},value:{null:null,true:!0,false:!1},plugin:{},debug:{get_console:()=>console,maxlen:33,print_config:!1},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:S,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},lex:{core:{LN:"#LN"}},rule:{finish:!0,maxmul:3},config:{modify:{}},parser:{}},e||{}),c=function(e,t,r){if(n===typeof e){let n=c.internal();return(u.parser.start?y.wrap_parser(u.parser):n.parser).start(n.lexer,e,c,t,r)}return e},u=e=>{if(null!=e&&t===typeof e){y.build_config_from_options(l,y.deep(a,e));for(let e in a)c.options[e]=a[e]}},p={token:function(e){return y.token(e,l,c)},options:y.deep(u,a),parse:c,use:function(e,t){return c.options({plugin:{[e.name]:t||{}}}),c.internal().plugins.push(e),e(c)||c},rule:function(e,t){return c.internal().parser.rule(e,t)},lex:function(e,t){return c.internal().lexer.lex(e,t)},make:function(e){return w(e,c)}};if(Object.defineProperty(p.make,"name",{value:"make"}),Object.assign(p,{internal:()=>({lexer:s,parser:o,config:l,plugins:i})}),r){for(let t in r)c[t]=r[t];c.parent=r;let e=r.internal();l=y.deep({},e.config),y.build_config_from_options(l,a),Object.assign(c.token,l.token),i=[...e.plugins],s=e.lexer.clone(l),o=e.parser.clone(a,l)}else l={tokenI:1,token:{}},y.build_config_from_options(l,a),i=[],s=new m(l),(o=new x(a,l)).init();return Object.assign(c,p),Object.assign(c.token,l.token),c}function S(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcShouldNotOccurAtThisPointAsItIsNot\nvalid %j%s%o%nSyntax,EvenUnderTheRelaxedJsonicRules.~ifItIs\nnotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((n,r,s)=>(n[r]=e(t[s]),n),{})}e.exports.util=y,e.exports.make=w;let C=w();return e.exports.Jsonic=C,C.use=()=>{throw new Error("Jsonic.use cannot be called directly. Instead write: `Jsonic.make().use(...)`.")},C.Jsonic=C,C.JsonicError=h,C.Lexer=m,C.Parser=x,C.Rule=f,C.RuleSpec=v,C.util=y,C.make=w,e.exports.default=C,e.exports=e.exports.Jsonic,e=e.exports}));