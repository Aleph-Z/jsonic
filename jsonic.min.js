!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.Alt=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const t=Object.keys,n=Object.entries,r=Object.assign,s=Object.defineProperty,l="object",i="string",o="function",c="unexpected",a="map",u="list",p="elem",h="pair",d="val",m="node",f="",g="unprintable",b="invalid_ascii",x="invalid_unicode",v="invalid_lex_state",k="unterminated",y="lex",w="parse",C="block_indent_",S="error",A="none",N="END_OF_SOURCE",j="imp,map",_="imp,list",I="imp,null",T="end",E="open",L="close",O="rule",P="stack",R="null",M="name",$="make";class U extends SyntaxError{constructor(e,t,n,s,l){let i=pe(e,t=K({},t),n,s,l);super(i.message),r(this,i),ne(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=U;class B{constructor(e){this.match={},z("@LTP",e),z("@LTX",e),z("@LCS",e),z("@LML",e),this.end={tin:z("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const n=e.opts,r=e.cnfg;let s=e=>z(e,r),l=e=>z(e,r),i=e.F,a=s("@LTP"),u=s("@LTX"),p=s("@LCS"),h=s("@LML"),d=s("#ZZ"),m=s("#SP"),w=s("#CM"),S=s("#NR"),A=s("#ST"),N=s("#TX"),j=s("#VL"),_=s("#LN"),I={tin:d,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},T=0,E=0,L=0,O=a,P=null,R=e.src(),M=R.length,$=null!=e.log?(...t)=>e.log(y,l(I.tin),i(I.src),T,E+":"+L,l(O),{...I},...t):void 0,U=(t,n,r,s)=>this.bad(e,$,t,I,T,n,E,L,r,r,s),B=t=>{let n=this.match[O];if(null!=n)for(let r of n){let n=r({sI:T,rI:E,cI:L,src:R,token:I,ctx:e,rule:t,bad:U});if(n)return T=n.sI?n.sI:T,E=n.rI?n.rI:E,L=n.cI?n.cI:L,O=null==n.state?O:n.state,P=null==n.state_param?P:n.state_param,$&&$(I,r),I}},D=function(s){I.len=0,I.val=void 0,I.src=void 0,I.row=E,I.use=void 0;let l={},i=0,y=[];e:for(;T<M;){let d=R[T];if(I.loc=T,I.col=L,e.xs=O,a!==O){if(u===O){if(B(s))return I;i=T;let e=R.substring(T).match(r.re.te);if(e){let t=e[0].length;i+=t,L+=t}return I.len=i-T,I.tin=N,I.val=R.substring(T,i),I.src=I.val,T=i,O=a,$&&$(I),I}if(p===O){if(B(s))return I;for(i=T;i<M&&!l[R[i]];)i++,L++;return I.val+=R.substring(T,i),I.src=I.val,I.len=I.val.length,T=i,O=a,$&&$(I),I}if(h===O){if(B(s))return I;i=T;let e=1,l=P[0],o=P[1],c=P[2],u=!!P[3],p="",h=0,d=l.length,m=o.length;if(u){let e=T-1;for(;-1<e&&r.m.SP[R[e]];)e--;0<(h=T-e-1)&&(p=t(r.m.SP)[0].repeat(h))}for(i+=l.length;i<M&&0<e;)o[0]===R[i]&&o===R.substring(i,i+m)?(i+=m,L+=m,e--):c&&l[0]===R[i]&&l===R.substring(i,i+d)?(i+=d,L+=m,e++):(n.line.row===R[i]?(E++,L=0):L++,i++);if(I.val=R.substring(T,i),I.src=I.val,I.len=I.val.length,u){I.val=I.val.substring(d,I.val.length-m),null==r.re.block_prefix&&(r.re.block_prefix=ie(f,"^[",le(n.token["#SP"]),"]*(",n.line.sep,")")),I.val=I.val.replace(r.re.block_prefix,""),null==r.re.block_suffix&&(r.re.block_suffix=ie(f,n.line.sep,"[",le(n.token["#SP"]),"]*$")),I.val=I.val.replace(r.re.block_suffix,"");let e=r.re[C+p]=r.re[C+p]||ie("g","^(",le(p),")|((",n.line.sep,")",le(p),")");I.val=I.val.replace(e,"$3")}return T=i,O=a,$&&$(I),I}return U(v,T,R[T],{state:O})}if(B(s))return I;if(n.space.lex&&r.m.SP[d]){for(I.tin=m,L++,i=T+1;r.m.SP[R[i]];)L++,i++;return I.len=i-T,I.val=R.substring(T,i),I.src=I.val,T=i,$&&$(I),I}if(n.line.lex&&r.m.LN[d]){for(I.tin=_,i=T,L=0;r.m.LN[R[i]];)E+=n.line.row===R[i]?1:0,i++;return I.len=i-T,I.val=R.substring(T,i),I.src=I.val,T=i,$&&$(I),I}if(n.number.lex&&r.m.NR[d]){let e=R.substring(T).match(r.re.nm);if(null!=e){let t=e[0];if(i=T+t.length,null==R[i]||r.cs.vend[R[i]]){let e=+(r.re.ns?t.replace(r.re.ns,""):t);if(!isNaN(e))return I.tin=S,I.src=t,I.val=e,I.len=t.length,T+=I.len,L+=I.len,$&&$(I),I}}}if(null!=r.sm[d])return I.tin=r.sm[d],I.len=1,I.src=d,T++,L++,$&&$(I),I;if(n.block.lex&&r.cs.bs[d]){let e=R.substring(T,T+r.bmx);for(let t of r.bmk)if(e.startsWith(t)){I.tin=A,O=h,P=[t,n.block.marker[t],null,!0];continue e}}if(n.string.lex&&r.m.ST[d]){I.tin=A,L++;let e=r.cs.mln[d];y=[];let t="";for(i=T+1;i<M;i++)if(L++,d===(t=R[i])){if(!n.string.escapedouble||d!==R[i+1]){i++;break}y.push(R[i]),i++}else if("\\"===t){i++,L++;let e=r.esc[R[i]];if(null!=e)y.push(e);else if("x"===R[i]){i++;let e=parseInt(R.substring(i,i+2),16);if(isNaN(e))return T=i-2,L-=2,U(b,i+2,R.substring(i-2,i+2));let t=String.fromCharCode(e);y.push(t),i+=1,L+=2}else if("u"===R[i]){let e="{"===R[++i]?(i++,1):0,t=e?6:4,n=parseInt(R.substring(i,i+t),16);if(isNaN(n))return T=i-2-e,L-=2,U(x,i+t+1,R.substring(i-2-e,i+t+e));let r=String.fromCodePoint(n);y.push(r),i+=t-1+e,L+=t+e}else y.push(R[i])}else{let s=i,l=d.charCodeAt(0),o="\\".charCodeAt(0),c=R.charCodeAt(i);for(;i<M&&32<=c&&l!==c&&o!==c;)c=R.charCodeAt(++i),L++;if(L--,t=R[i],c<32){if(!e||!r.m.LN[t])return U(g,i,"char-code="+R[i].charCodeAt(0));t===n.line.row&&(E++,L=0),y.push(R.substring(s,i+1))}else y.push(R.substring(s,i)),i--}return d!==t?U(k,i,y.join("")):(I.val=y.join(""),I.src=R.substring(T,i),I.len=i-T,T=i,$&&$(I),I)}if(n.comment.lex&&r.cs.cs[d]){let e=R.substring(T,T+r.cmx);for(let t of r.cmk)if(e.startsWith(t)){if(!0!==r.cm[t]){I.tin=w,I.val="",O=h,P=[t,r.cm[t],n.comment.balance];continue e}break}I.tin=w,I.val="",O=p,l=r.m.LN}else{if(n.value.lex&&r.vs[d]){i=T;do{i++}while(null!=R[i]&&!r.cs.vend[R[i]]);let t=R.substring(T,i),n=r.vm[t];if(void 0!==(n=o===typeof n?n({sI:T,rI:E,cI:L,src:R,token:I,ctx:e,rule:s,bad:U}):n))return I.tin=j,I.val=n,I.src=t,I.len=i-T,L+=I.len,T=i,$&&$(I),I}if(!n.text.lex)return U(c,T,R[T]);O=u}}return I.tin=d,I.loc=M,I.col=L,$&&$(I),I};return D.src=R,D}bad(e,t,n,r,s,l,i,o,c,a,u){return r.why=n,r.tin=z("#BD",e.cnfg),r.loc=s,r.row=i,r.col=o,r.len=l-s,r.val=c,r.src=a,r.use=u,t&&t(z(r.tin,e.cnfg),e.F(r.src),s,i+":"+o,{...r},S,n),r}lex(e,t){if(null==e)return this.match;let n=this.match[e];return null!=t?(null==n&&(n=this.match[e]=[]),n.push(t)):null===t&&(n=this.match[e],delete this.match[e]),n}clone(e){let t=new B(e);return K(t.match,this.match),t}}var D;e.exports.Lexer=B,function(e){e[e.open=0]="open",e[e.close=1]="close"}(D||(D={}));class F{constructor(e,t,n){this.id=t.uI++,this.name=e.name,this.spec=e,this.node=n,this.state=D.open,this.child=J,this.open=[],this.close=[],this.n={},this.use={},this.bo=!1!==e.bo,this.ao=!1!==e.ao,this.bc=!1!==e.bc,this.ac=!1!==e.ac}process(e){return this.spec.process(this,e,this.state)}}e.exports.Rule=F;const J={name:A,state:0};class Z{constructor(){this.m=[],this.p="",this.r="",this.b=0}}e.exports.Alt=Z;const V=new Z,Y=new Z;class W{constructor(e){function t(e){let t=null!=e.c&&e.c.n;t&&(e.c=e=>{let n=!0;for(let r in t)n=n&&(null==e.n[r]||e.n[r]<=t[r]);return n}),i===typeof e.g&&(e.g=e.g.split(/\s*,\s*/))}this.name="-",this.bo=!0,this.ao=!0,this.bc=!0,this.ac=!0,this.def=e||{},this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let n of[...this.def.open,...this.def.close])t(n)}process(e,t,n){let r,s="",l=t.F,i=n===D.open,o=i?e:J,a=this.def,u=i?a.open:a.close,p=i?e.bo&&a.bo:e.bc&&a.bc;if(p&&(r=p.call(this,e,t))){if(r.err)throw new U(r.err,{...r,state:i?E:L},t.t0,e,t);e.node=r.node||e.node}let h=r&&r.alt?{...Y,...r.alt}:0<u.length?this.parse_alts(u,e,t):Y;if(h.h&&(h=h.h(e,t,h,o)||h,s+="H"),i?e.open=h.m:e.close=h.m,h.e)throw new U(c,{...h.e.use,state:i?E:L},h.e,e,t);if(h.n)for(let c in h.n)e.n[c]=0===h.n[c]?0:(null==e.n[c]?0:e.n[c])+h.n[c],e.n[c]=0<e.n[c]?e.n[c]:0;h.u&&(e.use=Object.assign(e.use,h.u)),h.a&&(s+="A",h.a.call(this,e,t,h,o)),h.p?(t.rs.push(e),(o=e.child=new F(t.rsm[h.p],t,e.node)).parent=e,o.n={...e.n},s+="U"):h.r?((o=new F(t.rsm[h.r],t,e.node)).parent=e.parent,o.prev=e,o.n={...e.n},s+="R"):(i||(o=t.rs.pop()||J),s+="Z");let d=i?e.ao&&a.ao:e.ac&&a.ac;if(d){let n=d.call(this,e,t,h,o);if(n){if(n.err)throw t.t0.why=s,new U(n.err,{...n,state:i?E:L},t.t0,e,t);o=n.next||o}}o.why=s,t.log&&t.log(m,e.name+"~"+e.id,D[e.state],"w="+s,l(e.node));let f=0,g=h.m.length-(h.b||0);for(;f++<g;)t.next();return D.open===e.state&&(e.state=D.close),o}parse_alts(e,t,r){let s,l=V;l.m=[],l.b=0,l.p="",l.r="",l.n=void 0,l.h=void 0,l.a=void 0,l.u=void 0,l.e=void 0;let i,o=0,c=r.cnfg.t,a=e.length;for(o=0;o<a&&(i=!1,null==(s=e[o]).s||0===s.s.length?i=!0:(s.s[0]===r.t0.tin||s.s[0]===c.AA||Array.isArray(s.s[0])&&s.s[0].includes(r.t0.tin))&&(1===s.s.length?(l.m=[r.t0],i=!0):(s.s[1]===r.t1.tin||s.s[1]===c.AA||Array.isArray(s.s[1])&&s.s[1].includes(r.t1.tin))&&(l.m=[r.t0,r.t1],i=!0)),!(i=(i=i&&(!s.c||s.c(t,r,l)))&&(null==s.d||s.d===r.rs.length)));o++)s=null;return null==s&&c.ZZ!==r.t0.tin&&(l.e=r.t0),null!=s&&(l.e=s.e&&s.e(t,r,l)||void 0,l.b=s.b?s.b:l.b,l.p=s.p?s.p:l.p,l.r=s.r?s.r:l.r,l.n=s.n?s.n:l.n,l.h=s.h?s.h:l.h,l.a=s.a?s.a:l.a,l.u=s.u?s.u:l.u),r.log&&r.log(w,t.name+"~"+t.id,D[t.state],o<e.length?"alt="+o:"no-alt",o<e.length&&s.s?"["+s.s.map(e=>c[e]).join(" ")+"]":"[]",r.tC,"p="+(l.p||""),"r="+(l.r||""),"b="+(l.b||""),l.m.map(e=>c[e.tin]).join(" "),r.F(l.m.map(e=>e.src)),"c:"+(s&&s.c?i:""),"n:"+n(t.n).join(";"),"u:"+n(t.use).join(";"),l),l}}e.exports.RuleSpec=W;class H{constructor(e,t){this.rsm={},this.options=e,this.config=t}init(){let e=this.config.t,n=e.OB,r=e.CB,s=e.OS,l=e.CS,i=e.CL,o=e.CA,c=e.TX,m=e.NR,f=e.ST,g=e.VL,b=e.AA,x=e.ZZ,v=(e,t)=>{if(!this.options.rule.finish)return t.t0.src=N,t.t0},k={val:{open:[{s:[n,o],p:a,n:{im:0},g:j},{s:[n],p:a,n:{im:0}},{s:[s],p:u},{s:[o],d:0,p:u,b:1,g:_},{s:[o],b:1,g:_},{s:[[c,m,f,g],i],p:a,b:2,n:{im:1},g:j},{s:[[c,m,f,g]]},{s:[r],b:1,g:I},{s:[l],b:1,g:I}],close:[{s:[o],d:0,r:p,a:e=>e.node=[e.node],g:_},{c:(e,t,n)=>(c===t.t0.tin||m===t.t0.tin||f===t.t0.tin||g===t.t0.tin)&&0===t.rs.length,r:p,a:e=>e.node=[e.node],g:_},{s:[b],b:1}],bc:e=>{e.node=void 0===e.child.node?null==e.open[0]?void 0:e.open[0].val:e.child.node}},map:{bo:()=>({node:{}}),open:[{s:[r]},{p:h}],close:[]},list:{bo:()=>({node:[]}),open:[{s:[l]},{p:p}],close:[]},pair:{open:[{s:[[c,m,f,g],i],p:d,u:{key:!0}},{s:[r],b:1}],close:[{s:[r]},{s:[o],c:{n:{im:1}},r:h},{s:[o],b:1},{s:[[c,m,f,g],i],c:{n:{im:1}},r:h,b:2},{s:[[c,m,f,g],i],b:2},{s:[l],b:1},{s:[x],e:v,g:T}],bc:(e,t)=>{if(e.use.key){let n=e.open[0],r=f===n.tin?n.val:n.src,s=e.child.node,l=e.node[r];void 0===s&&i===t.v1.tin&&(s=null),e.node[r]=null==l?s:t.opts.map.merge?t.opts.map.merge(l,s):t.opts.map.extend?K(l,s):s}}},elem:{open:[{s:[n],p:a,n:{im:0}},{s:[s],p:u},{s:[o,o],b:2,g:R,a:e=>e.node.push(null)},{s:[o],g:R,a:e=>e.node.push(null)},{p:d,n:{im:1}}],close:[{s:[o,l]},{s:[o],r:p},{s:[l]},{s:[n],p:a,n:{im:0}},{s:[s],p:u},{s:[[c,m,f,g]],r:p,b:1},{s:[x],e:v,g:T}],bc:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=t(k).reduce((e,t)=>(e[t]=new W(k[t]),e[t].name=t,e),{})}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];return null===t?delete this.rsm[e]:void 0!==t&&((n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e),n}start(e,n,r,s,l){let i,o={uI:1,opts:this.options,cnfg:this.config,meta:s||{},src:()=>n,root:()=>i.node,plgn:()=>r.internal().plugins,rule:J,xs:-1,v2:e.end,v1:e.end,t0:e.end,t1:e.end,tC:-2,next:m,rs:[],rsm:this.rsm,log:s&&s.log||void 0,F:q(this.config),use:{}};null!=l&&(o=K(o,l)),re(o);let a=e=>z(e,this.config),u=se(e.start(o),z("#BD",this.config),o),p=this.rsm[this.options.rule.start];if(null==p)return;let h=new F(p,o);i=h;let d=2*t(this.rsm).length*u.src.length*2*this.options.rule.maxmul;function m(){let e;o.v2=o.v1,o.v1=o.t0,o.t0=o.t1;do{e=u(h),o.tC++}while(o.cnfg.ts.IGNORE[e.tin]);return o.t1={...e},o.t0}m(),m();let f=0;for(;J!==h&&f<d;)o.log&&o.log(O,h.name+"~"+h.id,D[h.state],o.rs.length,o.tC,"["+a(o.t0.tin)+" "+a(o.t1.tin)+"]","["+o.F(o.t0.src)+" "+o.F(o.t1.src)+"]",h,o),o.rule=h,h=h.process(o),o.log&&o.log(P,o.rs.length,o.rs.map(e=>e.name+"~"+e.id).join("/"),h,o),f++;if(z("#ZZ",this.config)!==o.t0.tin)throw new U(c,{},o.t0,J,o);return i.node}clone(e,t){let n=new H(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=Q(this.rsm[t]),e),{}),n}}e.exports.Parser=H;let G={tokenize:z,srcfmt:q,deep:K,clone:Q,charset:ee,longest:te,marr:function(e,t){return e.length===t.length&&e.reduce((e,n,r)=>e&&n===t[r],!0)},trimstk:ne,makelog:re,badlex:se,extract:ae,errinject:ce,errdesc:pe,configure:he,parserwrap:ue,regexp:ie,mesc:le,ender:oe};function X(e,t){let n,o,c,a,u=K({},t?{...t.options}:{tag:"-",line:{lex:!0,row:"\n",sep:"\r*\n"},comment:{lex:!0,balance:!0,marker:{"#":!0,"//":!0,"/*":"*/"}},space:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},block:{lex:!0,marker:{"'''":"'''"}},string:{lex:!0,escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",escapedouble:!1},text:{lex:!0},map:{extend:!0,merge:void 0},value:{lex:!0,src:{null:null,true:!0,false:!1}},plugin:{},debug:{get_console:()=>console,maxlen:99,print:{config:!1}},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:de,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#NR":"-0123456789+","#ST":"\"'`","#TX":!0,"#VL":!0,"#CM":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},rule:{start:d,finish:!0,maxmul:3},config:{modify:{}},parser:{start:void 0}},e||{}),p=function(e,t,n){if(i===typeof e){let r=p.internal();return(h.parser.start?ue(h.parser):r.parser).start(r.lexer,e,p,t,n)}return e},h=e=>{if(null!=e&&l===typeof e){he(c,K(u,e));for(let e in u)p.options[e]=u[e];r(p.token,c.t)}return{...p.options}},m={token:function(e){return z(e,c,p)},options:K(h,u),parse:p,use:function(e,t){return p.options({plugin:{[e.name]:t||{}}}),p.internal().plugins.push(e),e(p)||p},rule:function(e,t){return p.internal().parser.rule(e,t)},lex:function(e,t){return p.internal().lexer.lex(e,t)},make:function(e){return X(e,p)},id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+"/"+h.tag,toString:function(){return this.id}};if(s(m.make,M,{value:$}),t){for(let n in t)p[n]=t[n];p.parent=t;let e=t.internal();he(c=K({},e.config),u),r(p.token,c.t),a=[...e.plugins],n=e.lexer.clone(c),o=e.parser.clone(u,c)}else he(c={tI:1,t:{}},u),a=[],n=new B(c),(o=new H(u,c)).init();return r(p,m),r(p.token,c.t),s(p,"internal",{value:function(){return{lexer:n,parser:o,config:c,plugins:a}}}),p}function q(e){return(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.d.maxlen)+(e.d.maxlen<n.length?"...":"")}function z(e,t,n){let s=t.t,l=s[e];return null==l&&i===typeof e&&(s[l=t.tI++]=e,s[e]=l,s[e.substring(1)]=l,null!=n&&r(n.token,t.t)),l}function K(e,...t){let n=o===typeof e,r=null!=e&&(l===typeof e||n);for(let s of t){let t=o===typeof s,i=null!=s&&(l===typeof s||t);if(r&&i&&!t&&Array.isArray(e)===Array.isArray(s))for(let n in s)e[n]=K(e[n],s[n]);else e=void 0===s?e:t?s:i?K(Array.isArray(s)?[]:{},s):s,n=o===typeof e,r=null!=e&&(l===typeof e||n)}return e}function Q(e){return K(Object.create(Object.getPrototypeOf(e)),e)}function ee(...e){return e.filter(e=>!1!==e).map(e=>"object"==typeof e?t(e).join(""):e).join("").split("").reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{})}function te(e){return e.reduce((e,t)=>e<t.length?t.length:e,0)}function ne(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function re(e){if("number"==typeof e.log){let t=!1,n=e.log;-1===n&&(n=1,t=!0),e.log=(...r)=>{if(t){let t=r.filter(e=>l!=typeof e).map(e=>o==typeof e?e.name:e).join("\t");e.opts.debug.get_console().log(t)}else e.opts.debug.get_console().dir(r,{depth:n})}}return e.log}function se(e,t,n){let r=r=>{let s=e(r);if(t===s.tin){let e={};throw null!=s.use&&(e.use=s.use),new U(s.why||c,e,s,r,n)}return s};return r.src=e.src,r}function le(e,t){return(t=new String(e)).esc=!0,t}function ie(e,...t){return new RegExp(t.map(e=>e.esc?e.replace(/[-\\|\]{}()[^$+*?.!=]/g,"\\$&"):e).join(""),e)}function oe(e,r,s){let l=t(t(r).reduce((e,t)=>(e[t[0]]=1,e),{...e})).join(""),i=n(t(r).filter(e=>1<e.length&&(!s||!s[e[0]])).reduce((e,t)=>((e[t[0]]=e[t[0]]||[]).push(t.substring(1)),e),{})).reduce((e,t)=>(e.push([t[0],t[1].map(e=>ie("",le(e)).source).join("|")]),e),[]).map(e=>["|(",le(e[0]),"(?!(",e[1],")))"]).flat(1);return ie(f,"^(([^",le(l),"]+)",...i,")+")}function ce(e,t,n,r,s,l){return e.replace(/\$([\w_]+)/g,(e,i)=>JSON.stringify("code"===i?t:n[i]||(l.meta?l.meta[i]:void 0)||r[i]||s[i]||l[i]||l.opts[i]||l.cnfg[i]||"$"+i))}function ae(e,t,n){let r=0<n.loc?n.loc:0,s=0<n.row?n.row:0,l=0<n.col?n.col:0,i=null==n.src?"":n.src,o=e.substring(Math.max(0,r-333),r).split("\n"),c=e.substring(r,r+333).split("\n"),a=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"\x1b[34m"+(""+u++).padStart(a," ")+" | \x1b[0m"+(null==e?"":e),h=o.length;return[2<h?p(o[h-3]):null,1<h?p(o[h-2]):null,p(o[h-1]+c[0])," ".repeat(a)+"   "+" ".repeat(l)+"\x1b[31m"+"^".repeat(i.length||1)+" "+t+"\x1b[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")}function ue(e){return{start:function(t,n,r,s,l){try{return e.start(t,n,r,s,l)}catch(i){if("SyntaxError"===i.name){let e=0,t=0,l=0,o="",c=i.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(c){o=c[1],e=parseInt(c[2]),t=n.substring(0,e).replace(/[^\n]/g,"").length;let r=e-1;for(;-1<r&&"\n"!==n.charAt(r);)r--;l=Math.max(n.substring(r,e).length,0)}let a=i.token||{tin:r.token.UK,loc:e,len:o.length,row:i.lineNumber||t,col:i.columnNumber||l,val:void 0,src:o};throw new U(i.code||"json",i.details||{msg:i.message},a,{},i.ctx||{uI:-1,opts:r.options,cnfg:{t:{}},token:a,meta:s,src:()=>n,root:()=>{},plgn:()=>r.internal().plugins,rule:J,xs:-1,v2:a,v1:a,t0:a,t1:a,tC:-1,rs:[],next:()=>a,rsm:{},n:{},log:s?s.log:void 0,F:q(r.internal().config),use:{}})}throw i}}}}function pe(e,t,n,r,s){n={...n};let l=s.opts,i=s.meta,c=ce(l.error[e]||l.error.unknown,e,t,n,r,s);o===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let a=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+c,"  \x1b[34m--\x3e\x1b[0m "+(i&&i.fileName||"<no-file>")+":"+n.row+":"+n.col,ae(s.src(),c,n),ce((l.hint[e]||l.hint.unknown).replace(/^([^ ])/," $1").split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,r,s),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+r.name+"~"+D[r.state]+"; token="+s.cnfg.t[n.tin]+(null==n.why?"":"~"+n.why)+"; plugins="+s.plgn().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:s}};return{...Object.create(u),message:a,code:e,details:t,meta:i,fileName:i?i.fileName:void 0,lineNumber:n.row,columnNumber:n.col}}function he(e,n){let r=t(n.token);r.forEach(t=>z(t,e));let s=r.filter(e=>null!=n.token[e].c);e.sm=s.reduce((t,r)=>(t[n.token[r].c]=e.t[r],t),{});let l=r.filter(e=>i===typeof n.token[e]);e.m=l.reduce((t,r)=>(t[r.substring(1)]=n.token[r].split("").reduce((t,n)=>(t[n]=e.t[r],t),{}),t),{});let o=r.filter(e=>null!=n.token[e].s);if(e.ts=o.reduce((t,r)=>(t[r.substring(1)]=n.token[r].s.split(",").reduce((t,n)=>(t[e.t[n]]=n,t),{}),t),{}),e.vm=n.value.src,e.vs=t(n.value.src).reduce((e,t)=>(e[t[0]]=!0,e),{}),e.cs={},e.esc=t(n.string.escape).reduce((e,t)=>(e[t]=n.string.escape[t],e),{}),e.cs.cs={},e.cmk=[],n.comment.lex){e.cm=n.comment.marker;let r=t(e.cm);r.forEach(t=>{1===t.length?e.cs.cs[t]=t.charCodeAt(0):(e.cs.cs[t[0]]=t.charCodeAt(0),e.cmk.push(t))}),e.cmx=te(r)}e.sc=t(e.sm).join(""),e.cs.dig=ee(n.number.digital),e.cs.mln=ee(n.string.multiline),e.cs.vend=ee(n.space.lex&&e.m.SP,n.line.lex&&e.m.LN,e.sc,n.comment.lex&&e.cs.cs,n.block.lex&&e.cs.bs),e.cs.bs={},e.bmk=[];let c=t(n.block.marker);c.forEach(t=>{e.cs.bs[t[0]]=t.charCodeAt(0),e.bmk.push(t)}),e.bmx=te(c);let a=null!=n.number.sep?new RegExp(n.number.sep,"g"):null;e.re={ns:a,te:oe(ee(n.space.lex&&e.m.SP,n.line.lex&&e.m.LN,e.sc,n.comment.lex&&e.cs.cs,n.block.lex&&e.cs.bs),{...n.comment.lex?e.cm:{},...n.block.lex?n.block.marker:{}},e.sm),nm:new RegExp(["^[-+]?(0(",[n.number.hex?"x[0-9a-fA-F_]+":null,n.number.oct?"o[0-7_]+":null,n.number.bin?"b[01_]+":null].filter(e=>null!=e).join("|"),")|[0-9]+([0-9_]*[0-9])?)","(\\.[0-9]+([0-9_]*[0-9])?)?","([eE][-+]?[0-9]+([0-9_]*[0-9])?)?"].filter(e=>e.replace(/_/g,null==a?"":n.number.sep)).join(""))},e.d=n.debug,t(n.config.modify).forEach(t=>n.config.modify[t](e,n)),n.debug.print.config&&n.debug.get_console().dir(e,{depth:null})}function de(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((n,r,s)=>(n[r]=e(t[s]),n),{})}e.exports.util=G,e.exports.make=X;let me=X();e.exports.Jsonic=me;let fe=me;return delete fe.options,delete fe.use,delete fe.rule,delete fe.lex,delete fe.token,me.Jsonic=me,me.JsonicError=U,me.Lexer=B,me.Parser=H,me.Rule=F,me.RuleSpec=W,me.Alt=Z,me.util=G,me.make=X,e.exports.default=me,e.exports=e.exports.Jsonic,e=e.exports}));