!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.Alt=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const t="object",n="string",r="function",s="unexpected",l="map",o="list",i="elem",c="pair",a="val",u="node",p="",f="unprintable",m="invalid_ascii",d="invalid_unicode",h="invalid_lex_state",g="unterminated",b="lex",v="parse",x="block_indent_",_="error",k="none",y="END_OF_SOURCE",w="imp,map",S="imp,list",C="imp,null",j="end",N="open",A="close",I="rule",O="stack";class T extends SyntaxError{constructor(e,t,n,r,s){let l=re(e,t=Y({},t),n,r,Y({},{rI:s.rI,options:s.options,config:s.config,meta:s.meta,src:()=>s.src(),plugins:()=>s.plugins(),node:s.node,t0:s.t0,t1:s.t1,tI:s.tI,log:s.log,use:s.use}));super(l.message),Object.assign(this,l),q(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=T;class E{constructor(e){this.match={},V("@LTP",e),V("@LTX",e),V("@LCS",e),V("@LML",e),this.end={tin:V("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const t=e.options,n=e.config;let r=e=>V(e,n),l=e=>V(e,n),o=e.F,i=r("@LTP"),c=r("@LTX"),a=r("@LCS"),u=r("@LML"),v=r("#ZZ"),_=r("#SP"),k=r("#CM"),y=r("#NR"),w=r("#ST"),S=r("#TX"),C=r("#VL"),j=r("#LN"),N={tin:v,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},A=0,I=0,O=0,T=i,E=null,L=e.src(),P=L.length,R=null!=e.log?(...t)=>e.log(b,l(N.tin),o(N.src),A,I+":"+O,l(T),{...N},...t):void 0,M=this;function U(t,n,r,s){return M.bad(e,R,t,N,A,n,I,O,r,r,s)}function $(t){let n=M.match[T];if(null!=n)for(let r of n){let n=r({sI:A,rI:I,cI:O,src:L,token:N,ctx:e,rule:t,bad:U});if(n)return A=n.sI?n.sI:A,I=n.rI?n.rI:I,O=n.cI?n.cI:O,T=null==n.state?T:n.state,E=null==n.state_param?E:n.state_param,R&&R(N,r),N}}let B=function(r){N.len=0,N.val=void 0,N.src=void 0,N.row=I,N.use=void 0;let l={},o=0,b=[];e:for(;A<P;){let v=L[A];if(N.loc=A,N.col=O,e.lex=T,i!==T){if(c===T){if($(r))return N;o=A;let e=t.text.hoover?n.cs.hoover_ender:n.cs.text_ender;for(;null!=L[o]&&(!e[L[o]]||n.cmk0.includes(L[o])&&!n.cmk1.includes(L[o+1]));)O++,o++;if(N.len=o-A,N.tin=S,N.val=L.substring(A,o),N.src=N.val,t.text.hoover&&n.m.SP[N.val[N.val.length-1]]){let e=N.val.length-2;for(;0<e&&n.m.SP[N.val[e]];)e--;N.val=N.val.substring(0,e+1),N.src=N.val,O-=N.len-e-1,N.len=N.val.length,A+=N.len}else A=o;return T=i,R&&R(N),N}if(a===T){if($(r))return N;for(o=A;o<P&&!l[L[o]];)o++,O++;return N.val+=L.substring(A,o),N.src=N.val,N.len=N.val.length,A=o,T=i,R&&R(N),N}if(u===T){if($(r))return N;o=A;let e=1,s=E[0],l=E[1],c=E[2],a=!!E[3],u="",f=0,m=s.length,d=l.length;if(a){let e=A-1;for(;-1<e&&n.m.SP[L[e]];)e--;0<(f=A-e-1)&&(u=Object.keys(n.m.SP)[0].repeat(f))}for(o+=s.length;o<P&&0<e;)l[0]===L[o]&&l===L.substring(o,o+d)?(o+=d,O+=d,e--):c&&s[0]===L[o]&&s===L.substring(o,o+m)?(o+=m,O+=d,e++):(t.line.row===L[o]?(I++,O=0):O++,o++);if(N.val=L.substring(A,o),N.src=N.val,N.len=N.val.length,a){N.val=N.val.substring(m,N.val.length-d),null==n.re.block_prefix&&(n.re.block_prefix=Q(p,"^[","%"+t.token["#SP"],"]*","(",t.line.sep_RES,")")),N.val=N.val.replace(n.re.block_prefix,""),null==n.re.block_suffix&&(n.re.block_suffix=Q(p,t.line.sep_RES,"[","%"+t.token["#SP"],"]*$")),N.val=N.val.replace(n.re.block_suffix,"");let e=n.re[x+u]=n.re[x+u]||Q("g","^(","%"+u,")|(","(",t.line.sep_RES,")","%"+u,")");N.val=N.val.replace(e,"$3")}return A=o,T=i,R&&R(N),N}return U(h,A,L[A],{state:T})}if($(r))return N;if(t.space.lex&&n.s.SP[v]){for(N.tin=_,O++,o=A+1;n.m.SP[L[o]];)O++,o++;return N.len=o-A,N.val=L.substring(A,o),N.src=N.val,A=o,R&&R(N),N}if(t.line.lex&&n.s.LN[v]){for(N.tin=j,o=A,O=0;n.m.LN[L[o]];)I+=t.line.row===L[o]?1:0,o++;return N.len=o-A,N.val=L.substring(A,o),N.src=N.val,A=o,R&&R(N),N}if(null!=n.sm[v])return N.tin=n.sm[v],N.len=1,N.src=v,A++,O++,R&&R(N),N;if(t.number.lex&&n.s.NR[v]){for(N.tin=y,o=A;n.cs.digital[L[++o]];);let e=L.substring(A,o);if(null==L[o]||n.cs.value_ender[L[o]]){N.len=o-A;let r=L[A+1];!(1<N.len&&"0"===L[A]&&"."!==L[A+1])||t.number.hex&&"x"===r||t.number.oct&&"o"===r||t.number.bin&&"b"===r?(N.val=+e,null!=n.re.ns&&isNaN(N.val)&&(N.val=+e.replace(n.re.ns,"")),isNaN(N.val)&&(N.val=void 0,o--)):(N.val=void 0,o--)}if(null!=N.val)return N.src=e,O+=N.len,A=o,R&&R(N),N}if(t.block.lex&&n.cs.start_blockmarker[v]){let e=L.substring(A,A+n.bmx);for(let r of n.bmk)if(e.startsWith(r)){N.tin=w,T=u,E=[r,t.string.block[r],null,!0];continue e}}if(t.string.lex&&n.s.ST[v]){N.tin=w,O++;let e=n.cs.multiline[v];b=[];let r="";for(o=A+1;o<P;o++)if(O++,v===(r=L[o])){if(!t.string.escapedouble||v!==L[o+1]){o++;break}b.push(L[o]),o++}else if("\\"===r){o++,O++;let e=n.str.esc[L[o]];if(null!=e)b.push(e);else if("x"===L[o]){o++;let e=parseInt(L.substring(o,o+2),16);if(isNaN(e))return A=o-2,O-=2,U(m,o+2,L.substring(o-2,o+2));let t=String.fromCharCode(e);b.push(t),o+=1,O+=2}else if("u"===L[o]){let e="{"===L[++o]?(o++,1):0,t=e?6:4,n=parseInt(L.substring(o,o+t),16);if(isNaN(n))return A=o-2-e,O-=2,U(d,o+t+1,L.substring(o-2-e,o+t+e));let r=String.fromCodePoint(n);b.push(r),o+=t-1+e,O+=t+e}else b.push(L[o])}else{let s=o,l=v.charCodeAt(0),i="\\".charCodeAt(0),c=L.charCodeAt(o);for(;o<P&&32<=c&&l!==c&&i!==c;)c=L.charCodeAt(++o),O++;if(O--,r=L[o],c<32){if(!e||!n.s.LN[r])return U(f,o,"char-code="+L[o].charCodeAt(0));r===t.line.row&&(I++,O=0),b.push(L.substring(s,o+1))}else b.push(L.substring(s,o)),o--}return v!==r?U(g,o,b.join("")):(N.val=b.join(""),N.src=L.substring(A,o),N.len=o-A,A=o,R&&R(N),N)}if(t.comment.lex&&n.cs.start_commentmarker[v]){let e=L.substring(A,A+n.cmx);for(let r of n.cmk)if(e.startsWith(r)){if(!0!==n.cm[r]){N.tin=k,N.val="",T=u,E=[r,n.cm[r],t.comment.balance];continue e}break}N.tin=k,N.val="",T=a,l=n.m.LN}else{if(t.value.lex&&n.vs[v]){o=A;do{o++}while(null!=L[o]&&!n.cs.value_ender[L[o]]);let e=L.substring(A,o),t=n.vm[e];if(void 0!==t)return N.tin=C,N.val=t,N.src=e,N.len=o-A,O+=N.len,A=o,R&&R(N),N}if(!t.text.lex)return U(s,A,L[A]);T=c}}return N.tin=v,N.loc=P,N.col=O,R&&R(N),N};return B.src=L,B}bad(e,t,n,r,s,l,o,i,c,a,u){return r.why=n,r.tin=V("#BD",e.config),r.loc=s,r.row=o,r.col=i,r.len=l-s,r.val=c,r.src=a,r.use=u,t&&t(V(r.tin,e.config),e.F(r.src),s,o+":"+i,{...r},_,n),r}lex(e,t){if(null==e)return this.match;let n=this.match[e];return null!=t?(null==n&&(n=this.match[e]=[]),n.push(t)):null===t&&(n=this.match[e],delete this.match[e]),n}clone(e){let t=new E(e);return Y(t.match,this.match),t}}var L;e.exports.Lexer=E,function(e){e[e.open=0]="open",e[e.close=1]="close"}(L||(L={}));class P{constructor(e,t,n){this.id=t.rI++,this.name=e.name,this.spec=e,this.node=n,this.state=L.open,this.child=R,this.open=[],this.close=[],this.n={},this.before_open_active=!1!==e.before_open_active,this.after_open_active=!1!==e.after_open_active,this.before_close_active=!1!==e.before_close_active,this.after_close_active=!1!==e.after_close_active}process(e){return this.spec.process(this,e,this.state)}}e.exports.Rule=P;const R={name:k,state:0};class M{constructor(){this.m=[],this.p="",this.r="",this.b=0,this.n=null,this.h=null}}e.exports.Alt=M;const U=new M,$=new M;class B{constructor(e){function t(e){if(null!=e.c&&e.c.n){let t=e.c.n;e.c=(e,n,r)=>{let s=!0;for(let l in t)s=s&&(null==n.n[l]||n.n[l]<=t[l]);return s}}n===typeof e.g&&(e.g=e.g.split(/\s*,\s*/))}this.name="-",this.before_open_active=!0,this.after_open_active=!0,this.before_close_active=!0,this.after_close_active=!0,this.def=e,this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let n of[...this.def.open,...this.def.close])t(n)}process(e,t,n){let r,l="",o=t.F,i=n===L.open,c=i?e:R,a=this.def,p=i?a.open:a.close,f=i?e.before_open_active&&a.before_open:e.before_close_active&&a.before_close;if(f&&(r=f.call(this,e,t))){if(r.err)throw new T(r.err,{...r,state:i?N:A},t.t0,e,t);e.node=r.node||e.node}let m=r&&r.alt?{...$,...r.alt}:0<p.length?this.parse_alts(p,e,t):$;if(m.h&&(m=m.h(m,e,t,c)||m,l+="H"),i?e.open=m.m:e.close=m.m,m.e)throw new T(s,{...m.e.use,state:i?N:A},m.e,e,t);if(m.n)for(let s in m.n)e.n[s]=0===m.n[s]?0:(null==e.n[s]?0:e.n[s])+m.n[s],e.n[s]=0<e.n[s]?e.n[s]:0;m.p?(t.rs.push(e),(c=e.child=new P(t.rsm[m.p],t,e.node)).parent=e,c.n={...e.n},l+="U"):m.r?((c=new P(t.rsm[m.r],t,e.node)).parent=e.parent,c.n={...e.n},l+="R"):(i||(c=t.rs.pop()||R),l+="Z");let d=i?e.after_open_active&&a.after_open:e.after_close_active&&a.after_close;if(d){let n=d.call(this,e,t,c);if(n){if(n.err)throw t.t0.why=l,new T(n.err,{...n,state:i?N:A},t.t0,e,t);c=n.next||c}}c.why=l,t.log&&t.log(u,e.name+"~"+e.id,L[e.state],"w="+l,o(e.node));let h=0,g=m.m.length-(m.b||0);for(;h++<g;)t.next();return L.open===e.state&&(e.state=L.close),c}parse_alts(e,t,n){let r,s=U;s.m=[],s.b=0,s.p="",s.r="",s.n=void 0,s.h=void 0,s.e=void 0;let l,o=0,i=n.config.t;for(o=0;o<e.length;o++){if(l=(l=!(!(l=!(r=e[o]).c||r.c(r,t,n))||null!=r.d)||r.d===n.rs.length)&&(null==r.a||X(r.a,n.rs.slice(-r.a.length).map(e=>e.name).reverse()))){if(s.e=r.e&&r.e(r,t,n)||void 0,null==r.s||0===r.s.length)break;if(r.s[0]===n.t0.tin||r.s[0]===i.AA){if(1===r.s.length){s.m=[n.t0];break}if(r.s[1]===n.t1.tin||r.s[1]===i.AA){s.m=[n.t0,n.t1];break}}}r=null}return null==r&&i.ZZ!==n.t0.tin&&(s.e=n.t0),null!=r&&(s.b=r.b?r.b:s.b,s.p=r.p?r.p:s.p,s.r=r.r?r.r:s.r,s.n=r.n?r.n:s.n,s.h=r.h?r.h:s.h),n.log&&n.log(v,t.name+"~"+t.id,L[t.state],o<e.length?"alt="+o:"no-alt",o<e.length&&r.s?"["+r.s.map(e=>i[e]).join(" ")+"]":"[]",n.tI,"p="+(s.p||""),"r="+(s.r||""),"b="+(s.b||""),s.m.map(e=>i[e.tin]).join(" "),n.F(s.m.map(e=>e.src)),"c:"+(r&&r.c?l:""),"n:"+Object.entries(t.n).join(";"),s),s}}e.exports.RuleSpec=B;class D{constructor(e,t){this.rsm={},this.options=e,this.config=t}init(){let e=this.config.t,t=e.OB,n=e.CB,r=e.OS,s=e.CS,u=e.CL,p=e.CA,f=e.TX,m=e.NR,d=e.ST,h=e.VL,g=e.AA,b=e.ZZ,v=(e,t,n)=>{if(!this.options.rule.finish)return n.t0.src=y,n.t0},x={val:{open:[{s:[t,p],p:l,n:{im:0},g:w},{s:[t],p:l,n:{im:0}},{s:[r],p:o},{s:[p],d:0,p:o,b:1,g:S},{s:[p],b:1,g:S},{s:[f,u],p:l,b:2,n:{im:1},g:w},{s:[d,u],p:l,b:2,n:{im:1},g:w},{s:[m,u],p:l,b:2,n:{im:1},g:w},{s:[h,u],p:l,b:2,n:{im:1},g:w},{s:[f]},{s:[m]},{s:[d]},{s:[h]},{s:[n],a:[c],b:1,g:C},{s:[s],a:[c],b:1,g:C}],close:[{s:[p],d:0,r:i,h:(e,t,n)=>{t.node=[t.node]},g:S},{c:(e,t,n)=>(f===n.t0.tin||m===n.t0.tin||d===n.t0.tin||h===n.t0.tin)&&0===n.rs.length,r:i,h:(e,t,n)=>{t.node=[t.node]},g:S},{s:[g],b:1}],before_close:e=>{e.node=void 0===e.child.node?null==e.open[0]?void 0:e.open[0].val:e.child.node}},map:{before_open:()=>({node:{}}),open:[{s:[n]},{p:c}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[s]},{p:i}],close:[]},pair:{open:[{s:[d,u],p:a},{s:[f,u],p:a},{s:[m,u],p:a},{s:[h,u],p:a},{s:[n],b:1}],close:[{s:[n]},{s:[p],c:{n:{im:1}},r:c},{s:[p],b:1},{s:[d,u],c:{n:{im:1}},r:c,b:2},{s:[f,u],c:{n:{im:1}},r:c,b:2},{s:[m,u],c:{n:{im:1}},r:c,b:2},{s:[h,u],c:{n:{im:1}},r:c,b:2},{s:[d,u],b:2},{s:[f,u],b:2},{s:[m,u],b:2},{s:[h,u],b:2},{s:[s],b:1},{s:[b],e:v,g:j}],before_close:(e,t)=>{let r=e.open[0];if(r&&n!==r.tin){let n=d===r.tin?r.val:r.src,s=e.child.node,l=e.node[n];void 0===s&&u===t.u1.tin&&(s=null),e.node[n]=null==l?s:t.options.map.extend?Y(l,s):s}}},elem:{open:[{s:[t],p:l,n:{im:0}},{s:[r],p:o},{s:[p,p],b:2,g:"null"},{s:[p],g:"null"},{p:a,n:{im:1}}],close:[{s:[p,s]},{s:[p],r:i},{s:[s]},{s:[t],p:l,n:{im:0}},{s:[r],p:o},{s:[f],r:i,b:1},{s:[m],r:i,b:1},{s:[d],r:i,b:1},{s:[h],r:i,b:1},{s:[b],e:v,g:j}],after_open:(e,t,n)=>{e===n&&e.node.push(null)},before_close:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(x).reduce((e,t)=>(e[t]=new B(x[t]),e[t].name=t,e),{})}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];return null===t?delete this.rsm[e]:void 0!==t&&((n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e),n}start(e,t,n,r,l){let o,i=this.options,c=this.config,a={rI:1,options:i,config:c,meta:r||{},src:()=>t,root:()=>o.node,plugins:()=>n.internal().plugins,rule:R,node:void 0,lex:-1,u2:e.end,u1:e.end,t0:e.end,t1:e.end,tI:-2,next:h,rs:[],rsm:this.rsm,log:r&&r.log||void 0,F:F(c),use:{}};null!=l&&(a=Y(a,l)),z(a);let u=e=>V(e,this.config),p=K(e.start(a),V("#BD",this.config),a),f=this.rsm[i.rule.start];if(null==f)return;let m=new P(f,a);o=m;let d=2*Object.keys(this.rsm).length*p.src.length*2*i.rule.maxmul;function h(){let e;a.u2=a.u1,a.u1=a.t0,a.t0=a.t1;do{e=p(m),a.tI++}while(c.ts.IGNORE[e.tin]);return a.t1={...e},a.t0}h(),h();let g=0;for(;R!==m&&g<d;)a.log&&a.log(I,m.name+"~"+m.id,L[m.state],a.rs.length,a.tI,"["+u(a.t0.tin)+" "+u(a.t1.tin)+"]","["+a.F(a.t0.src)+" "+a.F(a.t1.src)+"]",m,a),a.rule=m,m=m.process(a),a.log&&a.log(O,a.rs.length,a.rs.map(e=>e.name+"~"+e.id).join("/"),m,a),g++;if(V("#ZZ",this.config)!==a.t0.tin)throw new T(s,{},a.t0,R,a);return o.node}clone(e,t){let n=new D(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=W(this.rsm[t]),e),{}),n}}e.exports.Parser=D;let J={tokenize:V,make_src_format:F,deep:Y,clone:W,charset:H,longest:G,marr:X,clean_stack:q,make_log:z,wrap_bad_lex:K,extract:te,errinject:ee,make_error_desc:re,build_config:se,wrap_parser:ne,regexp:Q};function Z(e,r){let s,l,o,i,c=Y({},r?{...r.options}:{tag:"-",line:{lex:!0,row:"\n",sep_RES:"\r*\n"},comment:{lex:!0,balance:!0,marker:{"#":!0,"//":!0,"/*":"*/"}},space:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},block:{lex:!0},string:{lex:!0,escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",block:{"'''":"'''"},escapedouble:!1},text:{lex:!0,lex_value:!0,hoover:!0},map:{extend:!0},value:{lex:!0,src:{null:null,true:!0,false:!1}},plugin:{},debug:{get_console:()=>console,maxlen:33,print_config:!1},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:le,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},rule:{start:"val",finish:!0,maxmul:3},config:{modify:{}},parser:{}},e||{}),a=function(e,t,r){if(n===typeof e){let n=a.internal();return(u.parser.start?ne(u.parser):n.parser).start(n.lexer,e,a,t,r)}return e},u=e=>{if(null!=e&&t===typeof e){se(o,Y(c,e));for(let e in c)a.options[e]=c[e];Object.assign(a.token,o.t)}return{...a.options}},p={token:function(e){return V(e,o,a)},options:Y(u,c),parse:a,use:function(e,t){return a.options({plugin:{[e.name]:t||{}}}),a.internal().plugins.push(e),e(a)||a},rule:function(e,t){return a.internal().parser.rule(e,t)},lex:function(e,t){return a.internal().lexer.lex(e,t)},make:function(e){return Z(e,a)},id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+"/"+u.tag,toString:function(){return this.id}};if(Object.defineProperty(p.make,"name",{value:"make"}),r){for(let t in r)a[t]=r[t];a.parent=r;let e=r.internal();se(o=Y({},e.config),c),Object.assign(a.token,o.t),i=[...e.plugins],s=e.lexer.clone(o),l=e.parser.clone(c,o)}else se(o={tI:1,t:{}},c),i=[],s=new E(o),(l=new D(c,o)).init();return Object.assign(a,p),Object.assign(a.token,o.t),Object.defineProperty(a,"internal",{value:function(){return{lexer:s,parser:l,config:o,plugins:i}}}),a}function F(e){return(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.d.maxlen)+(e.d.maxlen<n.length?"...":"")}function V(e,t,r){let s=t.t,l=s[e];return null==l&&n===typeof e&&(s[l=t.tI++]=e,s[e]=l,s[e.substring(1)]=l,null!=r&&Object.assign(r.token,t.t)),l}function Y(e,...n){let s=r===typeof e,l=null!=e&&(t===typeof e||s);for(let o of n){let n=r===typeof o,i=null!=o&&(t===typeof o||n);if(l&&i&&!n&&Array.isArray(e)===Array.isArray(o))for(let t in o)e[t]=Y(e[t],o[t]);else e=void 0===o?e:n?o:i?Y(Array.isArray(o)?[]:{},o):o,s=r===typeof e,l=null!=e&&(t===typeof e||s)}return e}function W(e){return Y(Object.create(Object.getPrototypeOf(e)),e)}function H(...e){return e.filter(e=>!1!==e).map(e=>"object"==typeof e?Object.keys(e).join(""):e).join("").split("").reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{})}function G(e){return e.reduce((e,t)=>e<t.length?t.length:e,0)}function X(e,t){return e.length===t.length&&e.reduce((e,n,r)=>e&&n===t[r],!0)}function q(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function z(e){if("number"==typeof e.log){let n=!1,s=e.log;-1===s&&(s=1,n=!0),e.log=(...l)=>{if(n){let n=l.filter(e=>t!=typeof e).map(e=>r==typeof e?e.name:e).join("\t");e.options.debug.get_console().log(n)}else e.options.debug.get_console().dir(l,{depth:s})}}return e.log}function K(e,t,n){let r=r=>{let l=e(r);if(t===l.tin){let e={};throw null!=l.use&&(e.use=l.use),new T(l.why||s,e,l,r,n)}return l};return r.src=e.src,r}function Q(e,...t){return new RegExp(t.map(e=>"%"===e[0]?e.substring(1).replace(/./g,"\\$&"):e).join(""),e)}function ee(e,t,n,r,s,l){return e.replace(/\$([\w_]+)/g,(e,o)=>JSON.stringify("code"===o?t:n[o]||(l.meta?l.meta[o]:void 0)||r[o]||s[o]||l[o]||l.options[o]||l.config[o]||"$"+o))}function te(e,t,n){let r=0<n.loc?n.loc:0,s=0<n.row?n.row:0,l=0<n.col?n.col:0,o=null==n.src?"":n.src,i=e.substring(Math.max(0,r-333),r).split("\n"),c=e.substring(r,r+333).split("\n"),a=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"\x1b[34m"+(""+u++).padStart(a," ")+" | \x1b[0m"+(null==e?"":e),f=i.length;return[2<f?p(i[f-3]):null,1<f?p(i[f-2]):null,p(i[f-1]+c[0])," ".repeat(a)+"   "+" ".repeat(l)+"\x1b[31m"+"^".repeat(o.length||1)+" "+t+"\x1b[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")}function ne(e){return{start:function(t,n,r,s,l){try{return e.start(t,n,r,s,l)}catch(o){if("SyntaxError"===o.name){let e=0,t=0,l=0,i="",c=o.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(c){i=c[1],e=parseInt(c[2]),t=n.substring(0,e).replace(/[^\n]/g,"").length;let r=e-1;for(;-1<r&&"\n"!==n.charAt(r);)r--;l=Math.max(n.substring(r,e).length,0)}let a=o.token||{tin:r.token.UK,loc:e,len:i.length,row:o.lineNumber||t,col:o.columnNumber||l,val:void 0,src:i};throw new T(o.code||"json",o.details||{msg:o.message},a,{},o.ctx||{rI:-1,options:r.options,config:{t:{}},token:a,meta:s,src:()=>n,root:()=>{},plugins:()=>r.internal().plugins,rule:R,node:void 0,lex:-1,u2:a,u1:a,t0:a,t1:a,tI:-1,rs:[],next:()=>a,rsm:{},n:{},log:s?s.log:void 0,F:F(r.internal().config),use:{}})}throw o}}}}function re(e,t,n,s,l){n={...n};let o=l.options,i=l.meta,c=ee(o.error[e]||o.error.unknown,e,t,n,s,l);r===typeof o.hint&&(o.hint={...o.hint(),...o.hint});let a=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+c,"  \x1b[34m--\x3e\x1b[0m "+(i&&i.fileName||"<no-file>")+":"+n.row+":"+n.col,te(l.src(),c,n),ee((o.hint[e]||o.hint.unknown).replace(/^([^ ])/," $1").split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,s,l),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+s.name+"~"+L[s.state]+"; token="+l.config.t[n.tin]+(null==n.why?"":"~"+n.why)+"; plugins="+l.plugins().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:l}};return{...Object.create(u),message:a,code:e,details:t,meta:i,fileName:i?i.fileName:void 0,lineNumber:n.row,columnNumber:n.col}}function se(e,t){let r=Object.keys(t.token);r.forEach(t=>V(t,e));let s=r.filter(e=>null!=t.token[e].c);e.sm=s.reduce((n,r)=>(n[t.token[r].c]=e.t[r],n),{});let l=r.filter(e=>n===typeof t.token[e]);e.s=l.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.t[r],t),{}),n),{}),e.m=l.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.t[r],t),{}),n),{});let o=r.filter(e=>null!=t.token[e].s);if(e.ts=o.reduce((n,r)=>(n[r.substring(1)]=t.token[r].s.split(",").reduce((t,n)=>(t[e.t[n]]=n,t),{}),n),{}),e.vm=t.value.src,e.vs=Object.keys(t.value.src).reduce((e,t)=>(e[t[0]]=!0,e),{}),e.cs={},e.str={esc:Object.keys(t.string.escape).reduce((e,n)=>(e[n]=t.string.escape[n],e),{})},e.cs.start_commentmarker={},e.cs.cm_single={},e.cmk=[],e.cmk0="",e.cmk1="",t.comment.lex){e.cm=t.comment.marker;let n=Object.keys(e.cm);n.forEach(t=>{1===t.length?(e.cs.start_commentmarker[t]=t.charCodeAt(0),e.cs.cm_single[t]=t.charCodeAt(0)):(e.cs.start_commentmarker[t[0]]=t.charCodeAt(0),e.cmk.push(t),e.cmk0+=t[0],e.cmk1+=t[1])}),e.cmx=G(n)}e.sc=Object.keys(e.sm).join(""),e.cs.digital=H(t.number.digital),e.cs.multiline=H(t.string.multiline),e.cs.value_ender=H(t.space.lex&&e.m.SP,t.line.lex&&e.m.LN,e.sc,t.comment.lex&&e.cs.start_commentmarker),e.cs.text_ender=e.cs.value_ender,e.cs.hoover_ender=H(t.line.lex&&e.m.LN,e.sc,t.comment.lex&&e.cs.start_commentmarker),e.cs.start_blockmarker={},e.bmk=[];let i=Object.keys(t.string.block);i.forEach(t=>{e.cs.start_blockmarker[t[0]]=t.charCodeAt(0),e.bmk.push(t)}),e.bmx=G(i),e.re={ns:null!=t.number.sep?new RegExp(t.number.sep,"g"):null},e.d=t.debug,Object.keys(t.config.modify).forEach(n=>t.config.modify[n](e,t)),t.debug.print_config&&t.debug.get_console().dir(e,{depth:null})}function le(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((n,r,s)=>(n[r]=e(t[s]),n),{})}e.exports.util=J,e.exports.make=Z;let oe=Z();e.exports.Jsonic=oe;let ie=oe;return delete ie.options,delete ie.use,delete ie.rule,delete ie.lex,delete ie.token,oe.Jsonic=oe,oe.JsonicError=T,oe.Lexer=E,oe.Parser=D,oe.Rule=P,oe.RuleSpec=B,oe.Alt=M,oe.util=J,oe.make=Z,e.exports.default=oe,e.exports=e.exports.Jsonic,e=e.exports}));