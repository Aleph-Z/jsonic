!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Jsonic=e()}}((function(){var e={exports:{}};Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.make=e.exports.util=e.exports.RuleSpec=e.exports.Rule=e.exports.Parser=e.exports.Lexer=e.exports.JsonicError=e.exports.Jsonic=void 0;const t="object",n="string",r="function",s="unexpected",o="map",l="list",i="elem",c="pair",a="val",u="node",p="",f="unprintable",m="invalid_ascii",h="invalid_unicode",d="invalid_lex_state",g="unterminated",b="lex",v="parse",x="block_indent_",_="error",k="none",y="END_OF_SOURCE",w="imp,map",S="imp,list",C="imp,null",j="end",N="open",I="close";class A extends SyntaxError{constructor(e,t,n,r,s){let o=te(e,t=F({},t),n,r,F({},{rI:s.rI,options:s.options,config:s.config,meta:s.meta,src:()=>s.src(),plugins:()=>s.plugins(),node:s.node,t0:s.t0,t1:s.t1,tI:s.tI,log:s.log,use:s.use}));super(o.message),Object.assign(this,o),G(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}e.exports.JsonicError=A;class O{constructor(e){this.match={},Z("@LTP",e),Z("@LTX",e),Z("@LCS",e),Z("@LML",e),this.end={tin:Z("#ZZ",e),loc:0,len:0,row:0,col:0,val:void 0,src:void 0}}start(e){const t=e.options,n=e.config;let r=e=>Z(e,n),o=e=>Z(e,n),l=e.F,i=r("@LTP"),c=r("@LTX"),a=r("@LCS"),u=r("@LML"),v=r("#ZZ"),_=r("#SP"),k=r("#CM"),y=r("#NR"),w=r("#ST"),S=r("#TX"),C=r("#VL"),j=r("#LN"),N={tin:v,loc:0,row:0,col:0,len:0,val:void 0,src:void 0},I=0,A=0,O=0,T=i,E=null,L=e.src(),P=L.length,R=null!=e.log?(...t)=>e.log(b,o(N.tin),l(N.src),I,A+":"+O,o(T),{...N},...t):void 0,M=this;function J(t,n,r,s){return M.bad(e,R,t,N,I,n,A,O,r,r,s)}function U(t){let n=M.match[T];if(null!=n){N.loc=I;for(let r of n){let n=r({sI:I,rI:A,cI:O,src:L,token:N,ctx:e,rule:t,bad:J});if(n)return I=n.sI?n.sI:I,A=n.rI?n.rI:A,O=n.cI?n.cI:O,T=null==n.state?T:n.state,E=null==n.state_param?E:n.state_param,R&&R(N,r),N}}}let $=function(r){N.len=0,N.val=void 0,N.src=void 0,N.row=A,N.use=void 0;let o={},l=0,b=[];e:for(;I<P;){let v=L[I];if(e.lex=T,i!==T){if(c===T){if(U(r))return N;let e=t.text.hoover?n.cs.hoover_ender:n.cs.text_ender;for(;null!=L[l]&&(!e[L[l]]||n.cmk0.includes(L[l])&&!n.cmk1.includes(L[l+1]));)O++,l++;if(N.len=l-I,N.tin=S,N.val=L.substring(I,l),N.src=N.val,t.text.hoover&&n.m.SP[N.val[N.val.length-1]]){let e=N.val.length-2;for(;0<e&&n.m.SP[N.val[e]];)e--;N.val=N.val.substring(0,e+1),N.src=N.val,O-=N.len-e-1,N.len=N.val.length,I+=N.len}else I=l;return T=i,R&&R(N),N}if(a===T){if(U(r))return N;for(l=I;l<P&&!o[L[l]];)l++,O++;return N.val+=L.substring(I,l),N.src=N.val,N.len=N.val.length,I=l,T=i,R&&R(N),N}if(u===T){if(U(r))return N;l=I;let e=1,s=E[0],o=E[1],c=E[2],a=!!E[3],u="",f=0,m=s.length,h=o.length;if(a){let e=I-1;for(;-1<e&&n.m.SP[L[e]];)e--;0<(f=I-e-1)&&(u=Object.keys(n.m.SP)[0].repeat(f))}for(l+=s.length;l<P&&0<e;)o[0]===L[l]&&o===L.substring(l,l+h)?(l+=h,O+=h,e--):c&&s[0]===L[l]&&s===L.substring(l,l+m)?(l+=m,O+=h,e++):(t.line.row===L[l]?(A++,O=0):O++,l++);if(N.val=L.substring(I,l),N.src=N.val,N.len=N.val.length,a){N.val=N.val.substring(m,N.val.length-h),null==n.re.block_prefix&&(n.re.block_prefix=z(p,"^[","%"+t.token["#SP"],"]*","(",t.line.sep_RES,")")),N.val=N.val.replace(n.re.block_prefix,""),null==n.re.block_suffix&&(n.re.block_suffix=z(p,t.line.sep_RES,"[","%"+t.token["#SP"],"]*$")),N.val=N.val.replace(n.re.block_suffix,"");let e=n.re[x+u]=n.re[x+u]||z("g","^(","%"+u,")|(","(",t.line.sep_RES,")","%"+u,")");N.val=N.val.replace(e,"$3")}return I=l,T=i,R&&R(N),N}return J(d,I,L[I],{state:T})}{if(U(r))return N;if(t.space.lex&&n.s.SP[v]){for(N.tin=_,N.loc=I,N.col=O++,l=I+1;n.m.SP[L[l]];)O++,l++;return N.len=l-I,N.val=L.substring(I,l),N.src=N.val,I=l,R&&R(N),N}if(t.line.lex&&n.s.LN[v]){for(N.tin=j,N.loc=I,N.col=O,l=I,O=0;n.m.LN[L[l]];)A+=t.line.row===L[l]?1:0,l++;return N.len=l-I,N.val=L.substring(I,l),N.src=N.val,I=l,R&&R(N),N}if(null!=n.sm[v])return N.tin=n.sm[v],N.loc=I,N.col=O++,N.len=1,N.src=v,I++,R&&R(N),N;if(t.number.lex&&n.s.NR[v]){for(N.tin=y,N.loc=I,N.col=O,l=I;n.cs.digital[L[++l]];);let e=L.substring(I,l);if(null==L[l]||n.cs.value_ender[L[l]]){N.len=l-I;let r=L[I+1];!(1<N.len&&"0"===L[I]&&"."!==L[I+1])||t.number.hex&&"x"===r||t.number.oct&&"o"===r||t.number.bin&&"b"===r?(N.val=+e,null!=n.re.ns&&isNaN(N.val)&&(N.val=+e.replace(n.re.ns,"")),isNaN(N.val)&&(N.val=void 0,l--)):(N.val=void 0,l--)}if(null!=N.val)return N.src=e,O+=N.len,I=l,R&&R(N),N}if(t.block.lex&&n.cs.start_blockmarker[v]){let e=L.substring(I,I+n.bmx);for(let r of n.bmk)if(e.startsWith(r)){N.tin=w,N.loc=I,N.col=O,T=u,E=[r,t.string.block[r],null,!0];continue e}}if(t.string.lex&&n.s.ST[v]){N.tin=w,N.loc=I,N.col=O++;let e=n.cs.multiline[v];b=[];let r="";for(l=I+1;l<P;l++)if(O++,v===(r=L[l])){if(!t.string.escapedouble||v!==L[l+1]){l++;break}b.push(L[l]),l++}else if("\\"===r){l++,O++;let e=n.str.esc[L[l]];if(null!=e)b.push(e);else if("x"===L[l]){l++;let e=parseInt(L.substring(l,l+2),16);if(isNaN(e))return I=l-2,O-=2,J(m,l+2,L.substring(l-2,l+2));let t=String.fromCharCode(e);b.push(t),l+=1,O+=2}else if("u"===L[l]){let e="{"===L[++l]?(l++,1):0,t=e?6:4,n=parseInt(L.substring(l,l+t),16);if(isNaN(n))return I=l-2-e,O-=2,J(h,l+t+1,L.substring(l-2-e,l+t+e));let r=String.fromCodePoint(n);b.push(r),l+=t-1+e,O+=t+e}else b.push(L[l])}else{let s=l,o=v.charCodeAt(0),i="\\".charCodeAt(0),c=L.charCodeAt(l);for(;l<P&&32<=c&&o!==c&&i!==c;)c=L.charCodeAt(++l),O++;if(O--,r=L[l],c<32){if(!e||!n.s.LN[r])return J(f,l,"char-code="+L[l].charCodeAt(0));r===t.line.row&&(A++,O=0),b.push(L.substring(s,l+1))}else b.push(L.substring(s,l)),l--}return v!==r?J(g,l,b.join("")):(N.val=b.join(""),N.src=L.substring(I,l),N.len=l-I,I=l,R&&R(N),N)}if(t.comment.lex&&n.cs.start_commentmarker[v]){let e=L.substring(I,I+n.cmx);for(let r of n.cmk)if(e.startsWith(r)){if(!0!==n.cm[r]){N.tin=k,N.loc=I,N.col=O,N.val="",T=u,E=[r,n.cm[r],t.comment.balance];continue e}break}N.tin=k,N.loc=I,N.col=O,N.val="",T=a,o=n.m.LN;continue e}N.loc=I,N.col=O,l=I;do{O++,l++}while(null!=L[l]&&!n.cs.value_ender[L[l]]);let e=L.substring(I,l),s=t.value[e];if(t.text.lex_value&&void 0!==s)return N.tin=C,N.val=s,N.src=e,N.len=l-I,I=l,R&&R(N),N;if(t.text.lex){T=c;continue e}}return J(s,I,L[I])}return N.tin=v,N.loc=P,N.col=O,R&&R(N),N};return $.src=L,$}bad(e,t,n,r,s,o,l,i,c,a,u){return r.why=n,r.tin=Z("#BD",e.config),r.loc=s,r.row=l,r.col=i,r.len=o-s,r.val=c,r.src=a,r.use=u,t&&t(Z(r.tin,e.config),e.F(r.src),s,l+":"+i,{...r},_,n),r}lex(e,t){if(null==e)return this.match;let n=this.match[e];return null!=t?(null==n&&(n=this.match[e]=[]),n.push(t)):null===t&&(n=this.match[e],delete this.match[e]),n}clone(e){let t=new O(e);return F(t.match,this.match),t}}var T;e.exports.Lexer=O,function(e){e[e.open=0]="open",e[e.close=1]="close"}(T||(T={}));class E{constructor(e,t,n){this.id=t.rI++,this.name=e.name,this.spec=e,this.node=n,this.state=T.open,this.child=L,this.open=[],this.close=[],this.n={},this.before_open_active=!1!==e.before_open_active,this.after_open_active=!1!==e.after_open_active,this.before_close_active=!1!==e.before_close_active,this.after_close_active=!1!==e.after_close_active}process(e){return this.spec.process(this,e,this.state)}}e.exports.Rule=E;const L={name:k,state:0};class P{constructor(){this.m=[],this.p="",this.r="",this.b=0,this.n=null,this.h=null}}const R=new P,M=new P;class J{constructor(e){function t(e){if(null!=e.c&&e.c.n){let t=e.c.n;e.c=(e,n,r)=>{let s=!0;for(let o in t)s=s&&(null==n.n[o]||n.n[o]<=t[o]);return s}}n===typeof e.g&&(e.g=e.g.split(/\s*,\s*/))}this.name="-",this.before_open_active=!0,this.after_open_active=!0,this.before_close_active=!0,this.after_close_active=!0,this.def=e,this.def.open=this.def.open||[],this.def.close=this.def.close||[];for(let n of[...this.def.open,...this.def.close])t(n)}process(e,t,n){let r,o="",l=t.F,i=n===T.open,c=i?e:L,a=this.def,p=i?a.open:a.close,f=i?e.before_open_active&&a.before_open:e.before_close_active&&a.before_close;if(f&&(r=f.call(this,e,t))){if(r.err)throw new A(r.err,{...r,state:i?N:I},t.t0,e,t);e.node=r.node||e.node}let m=r&&r.alt?{...M,...r.alt}:0<p.length?this.parse_alts(p,e,t):M;if(m.h&&(m=m.h(m,e,t,c)||m,o+="H"),i?e.open=m.m:e.close=m.m,m.e)throw new A(s,{...m.e.use,state:i?N:I},m.e,e,t);if(m.n)for(let s in m.n)e.n[s]=0===m.n[s]?0:(null==e.n[s]?0:e.n[s])+m.n[s],e.n[s]=0<e.n[s]?e.n[s]:0;m.p?(t.rs.push(e),(c=e.child=new E(t.rsm[m.p],t,e.node)).parent=e,c.n={...e.n},o+="U"):m.r?((c=new E(t.rsm[m.r],t,e.node)).parent=e.parent,c.n={...e.n},o+="R"):(i||(c=t.rs.pop()||L),o+="Z");let h=i?e.after_open_active&&a.after_open:e.after_close_active&&a.after_close;if(h){let n=h.call(this,e,t,c);if(n){if(n.err)throw t.t0.why=o,new A(n.err,{...n,state:i?N:I},t.t0,e,t);c=n.next||c}}c.why=o,t.log&&t.log(u,e.name+"/"+e.id,T[e.state],"w="+o,l(e.node));let d=0,g=m.m.length-(m.b||0);for(;d++<g;)t.next();return T.open===e.state&&(e.state=T.close),c}parse_alts(e,t,n){let r,s=R;s.m=[],s.b=0,s.p="",s.r="",s.n=void 0,s.h=void 0,s.e=void 0;let o,l=0,i=n.config.t;for(l=0;l<e.length;l++){if(o=(o=!(!(o=!(r=e[l]).c||r.c(r,t,n))||null!=r.d)||r.d===n.rs.length)&&(null==r.a||H(r.a,n.rs.slice(-r.a.length).map(e=>e.name).reverse()))){if(s.e=r.e&&r.e(r,t,n)||void 0,null==r.s||0===r.s.length)break;if(r.s[0]===n.t0.tin||r.s[0]===i.AA){if(1===r.s.length){s.m=[n.t0];break}if(r.s[1]===n.t1.tin||r.s[1]===i.AA){s.m=[n.t0,n.t1];break}}}r=null}return null==r&&i.ZZ!==n.t0.tin&&(s.e=n.t0),null!=r&&(s.b=r.b?r.b:s.b,s.p=r.p?r.p:s.p,s.r=r.r?r.r:s.r,s.n=r.n?r.n:s.n,s.h=r.h?r.h:s.h),n.log&&n.log(v,t.name+"/"+t.id,T[t.state],l<e.length?"alt="+l:"no-alt",l<e.length&&r.s?"["+r.s.map(e=>i[e]).join(" ")+"]":"[]",n.tI,"p="+(s.p||""),"r="+(s.r||""),"b="+(s.b||""),s.m.map(e=>i[e.tin]).join(" "),n.F(s.m.map(e=>e.src)),"c:"+(r&&r.c?o:""),"n:"+Object.entries(t.n).join(";"),s),s}}e.exports.RuleSpec=J;class U{constructor(e,t){this.rsm={},this.options=e,this.config=t}init(){let e=this.config.t,t=e.OB,n=e.CB,r=e.OS,s=e.CS,u=e.CL,p=e.CA,f=e.TX,m=e.NR,h=e.ST,d=e.VL,g=e.AA,b=e.ZZ,v=(e,t,n)=>{if(!this.options.rule.finish)return n.t0.src=y,n.t0},x={val:{open:[{s:[t,p],p:o,n:{im:0},g:w},{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[p],d:0,p:l,b:1,g:S},{s:[p],b:1,g:S},{s:[f,u],p:o,b:2,n:{im:1},g:w},{s:[h,u],p:o,b:2,n:{im:1},g:w},{s:[m,u],p:o,b:2,n:{im:1},g:w},{s:[d,u],p:o,b:2,n:{im:1},g:w},{s:[f]},{s:[m]},{s:[h]},{s:[d]},{s:[n],a:[c],b:1,g:C},{s:[s],a:[c],b:1,g:C}],close:[{s:[p],d:0,r:i,h:(e,t,n)=>{t.node=[t.node]},g:S},{c:(e,t,n)=>(f===n.t0.tin||m===n.t0.tin||h===n.t0.tin||d===n.t0.tin)&&0===n.rs.length,r:i,h:(e,t,n)=>{t.node=[t.node]},g:S},{s:[g],b:1}],before_close:e=>{e.node=void 0===e.child.node?null==e.open[0]?void 0:e.open[0].val:e.child.node}},map:{before_open:()=>({node:{}}),open:[{s:[n]},{p:c}],close:[]},list:{before_open:()=>({node:[]}),open:[{s:[s]},{p:i}],close:[]},pair:{open:[{s:[h,u],p:a},{s:[f,u],p:a},{s:[m,u],p:a},{s:[d,u],p:a},{s:[n],b:1}],close:[{s:[n]},{s:[p],c:{n:{im:1}},r:c},{s:[p],n:{im:-1},b:1},{s:[h,u],c:{n:{im:1}},r:c,b:2},{s:[f,u],c:{n:{im:1}},r:c,b:2},{s:[m,u],c:{n:{im:1}},r:c,b:2},{s:[d,u],c:{n:{im:1}},r:c,b:2},{s:[h,u],n:{im:-1},b:2},{s:[f,u],n:{im:-1},b:2},{s:[m,u],n:{im:-1},b:2},{s:[d,u],n:{im:-1},b:2},{s:[s],a:[o,a,i],b:1},{s:[b],e:v,g:j}],before_close:(e,t)=>{let r=e.open[0];if(r&&n!==r.tin){let n=h===r.tin?r.val:r.src,s=e.child.node,o=e.node[n];void 0===s&&u===t.u1.tin&&(s=null),e.node[n]=null==o?s:t.options.map.extend?F(o,s):s}}},elem:{open:[{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[p,p],b:2,g:"null"},{s:[p],g:"null"},{p:a,n:{im:1}}],close:[{s:[p,s]},{s:[p],r:i},{s:[s]},{s:[t],p:o,n:{im:0}},{s:[r],p:l},{s:[f,u],p:o,n:{im:0},b:2},{s:[m,u],p:o,n:{im:0},b:2},{s:[h,u],p:o,n:{im:0},b:2},{s:[d,u],p:o,n:{im:0},b:2},{s:[f],r:i,b:1},{s:[m],r:i,b:1},{s:[h],r:i,b:1},{s:[d],r:i,b:1},{s:[b],e:v,g:j}],after_open:(e,t,n)=>{e===n&&e.node.push(null)},before_close:e=>{void 0!==e.child.node&&e.node.push(e.child.node)}}};this.rsm=Object.keys(x).reduce((e,t)=>(e[t]=new J(x[t]),e[t].name=t,e),{})}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];return null===t?delete this.rsm[e]:void 0!==t&&((n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e),n}start(e,t,n,r,o){let l,i=this.options,c=this.config,a={rI:1,options:i,config:c,meta:r||{},src:()=>t,root:()=>l.node,plugins:()=>n.internal().plugins,rule:L,node:void 0,lex:-1,u2:e.end,u1:e.end,t0:e.end,t1:e.end,tI:-2,next:d,rs:[],rsm:this.rsm,log:r&&r.log||void 0,F:D(c),use:{}};null!=o&&(a=F(a,o)),X(a);let u=e=>Z(e,this.config),p=q(e.start(a),Z("#BD",this.config),a),f=this.rsm[i.rule.start];if(null==f)return;let m=new E(f,a);l=m;let h=2*Object.keys(this.rsm).length*p.src.length*2*i.rule.maxmul;function d(){let e;a.u2=a.u1,a.u1=a.t0,a.t0=a.t1;do{e=p(m),a.tI++}while(c.ts.IGNORE[e.tin]);return a.t1={...e},a.t0}d(),d();let g=0;for(;L!==m&&g<h;)a.log&&a.log("rule",m.name+"/"+m.id,T[m.state],a.rs.length,a.tI,"["+u(a.t0.tin)+" "+u(a.t1.tin)+"]","["+a.F(a.t0.src)+" "+a.F(a.t1.src)+"]",m,a),a.rule=m,m=m.process(a),a.log&&a.log("stack",a.rs.length,a.rs.map(e=>e.name+"/"+e.id).join(";"),m,a),g++;if(Z("#ZZ",this.config)!==a.t0.tin)throw new A(s,{},a.t0,L,a);return l.node}clone(e,t){let n=new U(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=V(this.rsm[t]),e),{}),n}}e.exports.Parser=U;let $={tokenize:Z,make_src_format:D,deep:F,clone:V,charset:Y,longest:W,marr:H,clean_stack:G,make_log:X,wrap_bad_lex:q,extract:Q,errinject:K,make_error_desc:te,build_config:ne,wrap_parser:ee,regexp:z};function B(e,r){let s,o,l,i,c=F({},r?{...r.options}:{tag:"-",line:{lex:!0,row:"\n",sep_RES:"\r*\n"},comment:{lex:!0,balance:!0,marker:{"#":!0,"//":!0,"/*":"*/"}},space:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,digital:"-1023456789._xoeEaAbBcCdDfF+",sep:"_"},block:{lex:!0},string:{lex:!0,escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},multiline:"`",block:{"'''":"'''"},escapedouble:!1},text:{lex:!0,lex_value:!0,hoover:!0},map:{extend:!0},value:{null:null,true:!0,false:!1},plugin:{},debug:{get_console:()=>console,maxlen:33,print_config:!1},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated:"unterminated string: $src"},hint:re,token:{"#OB":{c:"{"},"#CB":{c:"}"},"#OS":{c:"["},"#CS":{c:"]"},"#CL":{c:":"},"#CA":{c:","},"#SP":" \t","#LN":"\n\r","#CM":!0,"#NR":"-0123456789","#ST":"\"'`","#TX":!0,"#VL":!0,"#BD":!0,"#ZZ":!0,"#UK":!0,"#AA":!0,"#IGNORE":{s:"#SP,#LN,#CM"}},rule:{start:"val",finish:!0,maxmul:3},config:{modify:{}},parser:{}},e||{}),a=function(e,t,r){if(n===typeof e){let n=a.internal();return(u.parser.start?ee(u.parser):n.parser).start(n.lexer,e,a,t,r)}return e},u=e=>{if(null!=e&&t===typeof e){ne(l,F(c,e));for(let e in c)a.options[e]=c[e];Object.assign(a.token,l.t)}return{...a.options}},p={token:function(e){return Z(e,l,a)},options:F(u,c),parse:a,use:function(e,t){return a.options({plugin:{[e.name]:t||{}}}),a.internal().plugins.push(e),e(a)||a},rule:function(e,t){return a.internal().parser.rule(e,t)},lex:function(e,t){return a.internal().lexer.lex(e,t)},make:function(e){return B(e,a)},id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+"/"+u.tag,toString:function(){return this.id}};if(Object.defineProperty(p.make,"name",{value:"make"}),Object.assign(p,{internal:()=>({lexer:s,parser:o,config:l,plugins:i})}),r){for(let t in r)a[t]=r[t];a.parent=r;let e=r.internal();ne(l=F({},e.config),c),Object.assign(a.token,l.t),i=[...e.plugins],s=e.lexer.clone(l),o=e.parser.clone(c,l)}else ne(l={tI:1,t:{}},c),i=[],s=new O(l),(o=new U(c,l)).init();return Object.assign(a,p),Object.assign(a.token,l.t),a}function D(e){return(t,n)=>null==t?"":(n=JSON.stringify(t)).substring(0,e.d.maxlen)+(e.d.maxlen<n.length?"...":"")}function Z(e,t,r){let s=t.t,o=s[e];return null==o&&n===typeof e&&(s[o=t.tI++]=e,s[e]=o,s[e.substring(1)]=o,null!=r&&Object.assign(r.token,t.t)),o}function F(e,...n){let s=r===typeof e,o=null!=e&&(t===typeof e||s);for(let l of n){let n=r===typeof l,i=null!=l&&(t===typeof l||n);if(o&&i&&!n&&Array.isArray(e)===Array.isArray(l))for(let t in l)e[t]=F(e[t],l[t]);else e=void 0===l?e:n?l:i?F(Array.isArray(l)?[]:{},l):l,s=r===typeof e,o=null!=e&&(t===typeof e||s)}return e}function V(e){return F(Object.create(Object.getPrototypeOf(e)),e)}function Y(...e){return e.map(e=>"object"==typeof e?Object.keys(e).join(""):e).join("").split("").reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{})}function W(e){return e.reduce((e,t)=>e<t.length?t.length:e,0)}function H(e,t){return e.length===t.length&&e.reduce((e,n,r)=>e&&n===t[r],!0)}function G(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function X(e){if("number"==typeof e.log){let n=!1,s=e.log;-1===s&&(s=1,n=!0),e.log=(...o)=>{if(n){let n=o.filter(e=>t!=typeof e).map(e=>r==typeof e?e.name:e).join("\t");e.options.debug.get_console().log(n)}else e.options.debug.get_console().dir(o,{depth:s})}}return e.log}function q(e,t,n){let r=r=>{let o=e(r);if(t===o.tin){let e={};throw null!=o.use&&(e.use=o.use),new A(o.why||s,e,o,r,n)}return o};return r.src=e.src,r}function z(e,...t){return new RegExp(t.map(e=>"%"===e[0]?e.substring(1).replace(/./g,"\\$&"):e).join(""),e)}function K(e,t,n,r,s,o){return e.replace(/\$([\w_]+)/g,(e,l)=>JSON.stringify("code"===l?t:n[l]||(o.meta?o.meta[l]:void 0)||r[l]||s[l]||o[l]||o.options[l]||o.config[l]||"$"+l))}function Q(e,t,n){let r=0<n.loc?n.loc:0,s=0<n.row?n.row:0,o=0<n.col?n.col:0,l=null==n.src?"":n.src,i=e.substring(Math.max(0,r-333),r).split("\n"),c=e.substring(r,r+333).split("\n"),a=2+(""+(s+2)).length,u=s<2?0:s-2,p=e=>"\x1b[34m"+(""+u++).padStart(a," ")+" | \x1b[0m"+(null==e?"":e),f=i.length;return[2<f?p(i[f-3]):null,1<f?p(i[f-2]):null,p(i[f-1]+c[0])," ".repeat(a)+"   "+" ".repeat(o)+"\x1b[31m"+"^".repeat(l.length||1)+" "+t+"\x1b[0m",p(c[1]),p(c[2])].filter(e=>null!=e).join("\n")}function ee(e){return{start:function(t,n,r,s,o){try{return e.start(t,n,r,s,o)}catch(l){if("SyntaxError"===l.name){let e=0,t=0,o=0,i="",c=l.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(c){i=c[1],e=parseInt(c[2]),t=n.substring(0,e).replace(/[^\n]/g,"").length;let r=e-1;for(;-1<r&&"\n"!==n.charAt(r);)r--;o=Math.max(n.substring(r,e).length,0)}let a=l.token||{tin:r.token.UK,loc:e,len:i.length,row:l.lineNumber||t,col:l.columnNumber||o,val:void 0,src:i};throw new A(l.code||"json",l.details||{msg:l.message},a,{},l.ctx||{rI:-1,options:r.options,config:{t:{}},token:a,meta:s,src:()=>n,root:()=>{},plugins:()=>r.internal().plugins,rule:L,node:void 0,lex:-1,u2:a,u1:a,t0:a,t1:a,tI:-1,rs:[],next:()=>a,rsm:{},n:{},log:s?s.log:void 0,F:D(r.internal().config),use:{}})}throw l}}}}function te(e,t,n,s,o){n={...n};let l=o.options,i=o.meta,c=K(l.error[e]||l.error.unknown,e,t,n,s,o);r===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let a=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+c,"  \x1b[34m--\x3e\x1b[0m "+(i&&i.fileName||"<no-file>")+":"+n.row+":"+n.col,Q(o.src(),c,n),K((l.hint[e]||l.hint.unknown).replace(/^([^ ])/," $1").split("\n").map((e,t)=>(0===t?" ":"  ")+e).join("\n"),e,t,n,s,o),"  \x1b[2mhttps://jsonic.richardrodger.com\x1b[0m","  \x1b[2m--internal: rule="+s.name+"~"+T[s.state]+"; token="+o.config.t[n.tin]+(null==n.why?"":"~"+n.why)+"; plugins="+o.plugins().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:o}};return{...Object.create(u),message:a,code:e,details:t,meta:i,fileName:i?i.fileName:void 0,lineNumber:n.row,columnNumber:n.col}}function ne(e,t){let r=Object.keys(t.token);r.forEach(t=>Z(t,e));let s=r.filter(e=>null!=t.token[e].c);e.sm=s.reduce((n,r)=>(n[t.token[r].c]=e.t[r],n),{});let o=r.filter(e=>n===typeof t.token[e]);e.s=o.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.t[r],t),{}),n),{}),e.m=o.reduce((n,r)=>(n[r.substring(1)]=t.token[r].split("").reduce((t,n)=>(t[n]=e.t[r],t),{}),n),{});let l=r.filter(e=>null!=t.token[e].s);if(e.ts=l.reduce((n,r)=>(n[r.substring(1)]=t.token[r].s.split(",").reduce((t,n)=>(t[e.t[n]]=n,t),{}),n),{}),e.cs={},e.str={esc:Object.keys(t.string.escape).reduce((e,n)=>(e[n]=t.string.escape[n],e),{})},e.cs.start_commentmarker={},e.cs.cm_single={},e.cmk=[],e.cmk0="",e.cmk1="",t.comment.lex){e.cm=t.comment.marker;let n=Object.keys(e.cm);n.forEach(t=>{1===t.length?(e.cs.start_commentmarker[t]=t.charCodeAt(0),e.cs.cm_single[t]=t.charCodeAt(0)):(e.cs.start_commentmarker[t[0]]=t.charCodeAt(0),e.cmk.push(t),e.cmk0+=t[0],e.cmk1+=t[1])}),e.cmx=W(n)}e.sc=Object.keys(e.sm).join(""),e.cs.digital=Y(t.number.digital),e.cs.multiline=Y(t.string.multiline),e.cs.value_ender=Y(e.m.SP,e.m.LN,e.sc,e.cs.start_commentmarker),e.cs.text_ender=e.cs.value_ender,e.cs.hoover_ender=Y(e.m.LN,e.sc,e.cs.start_commentmarker),e.cs.start_blockmarker={},e.bmk=[];let i=Object.keys(t.string.block);i.forEach(t=>{e.cs.start_blockmarker[t[0]]=t.charCodeAt(0),e.bmk.push(t)}),e.bmx=W(i),e.re={ns:null!=t.number.sep?new RegExp(t.number.sep,"g"):null},e.d=t.debug,Object.keys(t.config.modify).forEach(n=>t.config.modify[n](e,t)),t.debug.print_config&&t.debug.get_console().dir(e,{depth:null})}function re(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!|~theCharacter(s) $srcWasNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~stringValuesCannotBeMissingTheirFinalQuoteCharacter,Which\nshouldMatchTheirInitialQuoteCharacter.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated".split("|").reduce((n,r,s)=>(n[r]=e(t[s]),n),{})}e.exports.util=$,e.exports.make=B;let se=B();return e.exports.Jsonic=se,se.use=()=>{throw new Error("Jsonic.use cannot be called directly. Instead write: `Jsonic.make().use(...)`.")},se.Jsonic=se,se.JsonicError=A,se.Lexer=O,se.Parser=U,se.Rule=E,se.RuleSpec=J,se.util=$,se.make=B,e.exports.default=se,e.exports=e.exports.Jsonic,e=e.exports}));